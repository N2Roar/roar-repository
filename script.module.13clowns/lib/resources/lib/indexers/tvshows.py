# -*- coding: utf-8 -*-

'''
#:::'##::::'#######:::'######::'##::::::::'#######::'##:::::'##:'##::: ##::'######::
#:'####:::'##.... ##:'##... ##: ##:::::::'##.... ##: ##:'##: ##: ###:: ##:'##... ##:
#:.. ##:::..::::: ##: ##:::..:: ##::::::: ##:::: ##: ##: ##: ##: ####: ##: ##:::..::
#::: ##::::'#######:: ##::::::: ##::::::: ##:::: ##: ##: ##: ##: ## ## ##:. ######::
#::: ##::::...... ##: ##::::::: ##::::::: ##:::: ##: ##: ##: ##: ##. ####::..... ##:
#::: ##:::'##:::: ##: ##::: ##: ##::::::: ##:::: ##: ##: ##: ##: ##:. ###:'##::: ##:
#:'######:. #######::. ######:: ########:. #######::. ###. ###:: ##::. ##:. ######::
#:......:::.......::::......:::........:::.......::::...::...:::..::::..:::......:::

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
'''

import base64;exec base64.b64decode('CmZyb20gcmVzb3VyY2VzLmxpYi5tb2R1bGVzIGltcG9ydCB0cmFrdApmcm9tIHJlc291cmNlcy5saWIubW9kdWxlcyBpbXBvcnQgY2xlYW50aXRsZQpmcm9tIHJlc291cmNlcy5saWIubW9kdWxlcyBpbXBvcnQgY2xlYW5nZW5yZQpmcm9tIHJlc291cmNlcy5saWIubW9kdWxlcyBpbXBvcnQgY29udHJvbApmcm9tIHJlc291cmNlcy5saWIubW9kdWxlcyBpbXBvcnQgY2xpZW50CmZyb20gcmVzb3VyY2VzLmxpYi5tb2R1bGVzIGltcG9ydCBjYWNoZQpmcm9tIHJlc291cmNlcy5saWIubW9kdWxlcyBpbXBvcnQgbWV0YWNhY2hlCmZyb20gcmVzb3VyY2VzLmxpYi5tb2R1bGVzIGltcG9ydCBwbGF5Y291bnQKZnJvbSByZXNvdXJjZXMubGliLm1vZHVsZXMgaW1wb3J0IHdvcmtlcnMKZnJvbSByZXNvdXJjZXMubGliLm1vZHVsZXMgaW1wb3J0IHZpZXdzCmZyb20gcmVzb3VyY2VzLmxpYi5tb2R1bGVzIGltcG9ydCB1dGlscwpmcm9tIHJlc291cmNlcy5saWIuaW5kZXhlcnMgaW1wb3J0IG5hdmlnYXRvcgoKaW1wb3J0IG9zLHN5cyxyZSxqc29uLHVybGxpYix1cmxwYXJzZSxkYXRldGltZQoKcGFyYW1zID0gZGljdCh1cmxwYXJzZS5wYXJzZV9xc2woc3lzLmFyZ3ZbMl0ucmVwbGFjZSgnPycsJycpKSkgaWYgbGVuKHN5cy5hcmd2KSA+IDEgZWxzZSBkaWN0KCkKCmFjdGlvbiA9IHBhcmFtcy5nZXQoJ2FjdGlvbicpCgpjbGFzcyB0dnNob3dzOgogICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIHNlbGYubGlzdCA9IFtdCgogICAgICAgIHNlbGYuaW1kYl9saW5rID0gJ2h0dHA6Ly93d3cuaW1kYi5jb20nCiAgICAgICAgc2VsZi50cmFrdF9saW5rID0gJ2h0dHA6Ly9hcGkudHJha3QudHYnCiAgICAgICAgc2VsZi50dm1hemVfbGluayA9ICdodHRwOi8vd3d3LnR2bWF6ZS5jb20nCiAgICAgICAgc2VsZi5sb2dvX2xpbmsgPSAnaHR0cHM6Ly9pLmltZ3VyLmNvbS8nCiAgICAgICAgc2VsZi50dmRiX2tleSA9ICdNVVEyTWtZeVJqa3dNRE13UXpRME5BPT0nCiAgICAgICAgc2VsZi5kYXRldGltZSA9IChkYXRldGltZS5kYXRldGltZS51dGNub3coKSAtIGRhdGV0aW1lLnRpbWVkZWx0YShob3VycyA9IDUpKQogICAgICAgIHNlbGYudHJha3RfdXNlciA9IGNvbnRyb2wuc2V0dGluZygndHJha3QudXNlcicpLnN0cmlwKCkKICAgICAgICBzZWxmLmltZGJfdXNlciA9IGNvbnRyb2wuc2V0dGluZygnaW1kYi51c2VyJykucmVwbGFjZSgndXInLCAnJykKICAgICAgICBzZWxmLmZhbmFydF90dl91c2VyID0gY29udHJvbC5zZXR0aW5nKCdmYW5hcnQudHYudXNlcicpCiAgICAgICAgc2VsZi51c2VyID0gY29udHJvbC5zZXR0aW5nKCdmYW5hcnQudHYudXNlcicpICsgc3RyKCcnKQogICAgICAgIHNlbGYubGFuZyA9IGNvbnRyb2wuYXBpTGFuZ3VhZ2UoKVsndHZkYiddCgogICAgICAgIHNlbGYuc2VhcmNoX2xpbmsgPSAnaHR0cDovL2FwaS50cmFrdC50di9zZWFyY2gvc2hvdz9saW1pdD0yMCZwYWdlPTEmcXVlcnk9JwogICAgICAgIHNlbGYudHZtYXplX2luZm9fbGluayA9ICdodHRwOi8vYXBpLnR2bWF6ZS5jb20vc2hvd3MvJXMnCiAgICAgICAgc2VsZi50dmRiX2luZm9fbGluayA9ICdodHRwOi8vdGhldHZkYi5jb20vYXBpLyVzL3Nlcmllcy8lcy8lcy54bWwnICUgKHNlbGYudHZkYl9rZXkuZGVjb2RlKCdiYXNlNjQnKSwgJyVzJywgc2VsZi5sYW5nKQogICAgICAgIHNlbGYuZmFuYXJ0X3R2X2FydF9saW5rID0gJ2h0dHA6Ly93ZWJzZXJ2aWNlLmZhbmFydC50di92My90di8lcycKICAgICAgICBzZWxmLmZhbmFydF90dl9sZXZlbF9saW5rID0gJ2h0dHA6Ly93ZWJzZXJ2aWNlLmZhbmFydC50di92My9sZXZlbCcKICAgICAgICBzZWxmLnR2ZGJfYnlfaW1kYiA9ICdodHRwOi8vdGhldHZkYi5jb20vYXBpL0dldFNlcmllc0J5UmVtb3RlSUQucGhwP2ltZGJpZD0lcycKICAgICAgICBzZWxmLnR2ZGJfYnlfcXVlcnkgPSAnaHR0cDovL3RoZXR2ZGIuY29tL2FwaS9HZXRTZXJpZXMucGhwP3Nlcmllc25hbWU9JXMnCiAgICAgICAgc2VsZi50dmRiX2ltYWdlID0gJ2h0dHA6Ly90aGV0dmRiLmNvbS9iYW5uZXJzLycKCiAgICAgICAgc2VsZi5wZXJzb25zX2xpbmsgPSAnaHR0cDovL3d3dy5pbWRiLmNvbS9zZWFyY2gvbmFtZT9jb3VudD0xMDAmbmFtZT0nCiAgICAgICAgc2VsZi5wZXJzb25saXN0X2xpbmsgPSAnaHR0cDovL3d3dy5pbWRiLmNvbS9zZWFyY2gvbmFtZT9jb3VudD0xMDAmZ2VuZGVyPW1hbGUsZmVtYWxlJwogICAgICAgIHNlbGYucG9wdWxhcl9saW5rID0gJ2h0dHA6Ly93d3cuaW1kYi5jb20vc2VhcmNoL3RpdGxlP3RpdGxlX3R5cGU9dHZfc2VyaWVzLG1pbmlfc2VyaWVzJm51bV92b3Rlcz0xMDAsJnJlbGVhc2VfZGF0ZT0sZGF0ZVswXSZzb3J0PW1vdmllbWV0ZXIsYXNjJmNvdW50PTQwJnN0YXJ0PTEnCiAgICAgICAgc2VsZi5haXJpbmdfbGluayA9ICdodHRwOi8vd3d3LmltZGIuY29tL3NlYXJjaC90aXRsZT90aXRsZV90eXBlPXR2X2VwaXNvZGUmcmVsZWFzZV9kYXRlPWRhdGVbMV0sZGF0ZVswXSZzb3J0PW1vdmllbWV0ZXIsYXNjJmNvdW50PTQwJnN0YXJ0PTEnCiAgICAgICAgc2VsZi5hY3RpdmVfbGluayA9ICdodHRwOi8vd3d3LmltZGIuY29tL3NlYXJjaC90aXRsZT90aXRsZV90eXBlPXR2X3NlcmllcyxtaW5pX3NlcmllcyZudW1fdm90ZXM9MTAsJnByb2R1Y3Rpb25fc3RhdHVzPWFjdGl2ZSZzb3J0PW1vdmllbWV0ZXIsYXNjJmNvdW50PTQwJnN0YXJ0PTEnCiAgICAgICAgI3NlbGYucHJlbWllcmVfbGluayA9ICdodHRwOi8vd3d3LmltZGIuY29tL3NlYXJjaC90aXRsZT90aXRsZV90eXBlPXR2X3NlcmllcyxtaW5pX3NlcmllcyZsYW5ndWFnZXM9ZW4mbnVtX3ZvdGVzPTEwLCZyZWxlYXNlX2RhdGU9ZGF0ZVs2MF0sZGF0ZVswXSZzb3J0PW1vdmllbWV0ZXIsYXNjJmNvdW50PTQwJnN0YXJ0PTEnCiAgICAgICAgc2VsZi5wcmVtaWVyZV9saW5rID0gJ2h0dHA6Ly93d3cuaW1kYi5jb20vc2VhcmNoL3RpdGxlP3RpdGxlX3R5cGU9dHZfc2VyaWVzLG1pbmlfc2VyaWVzJmxhbmd1YWdlcz1lbiZudW1fdm90ZXM9MTAsJnJlbGVhc2VfZGF0ZT1kYXRlWzYwXSxkYXRlWzBdJnNvcnQ9cmVsZWFzZV9kYXRlLGRlc2MmY291bnQ9NDAmc3RhcnQ9MScKICAgICAgICBzZWxmLnJhdGluZ19saW5rID0gJ2h0dHA6Ly93d3cuaW1kYi5jb20vc2VhcmNoL3RpdGxlP3RpdGxlX3R5cGU9dHZfc2VyaWVzLG1pbmlfc2VyaWVzJm51bV92b3Rlcz01MDAwLCZyZWxlYXNlX2RhdGU9LGRhdGVbMF0mc29ydD11c2VyX3JhdGluZyxkZXNjJmNvdW50PTQwJnN0YXJ0PTEnCiAgICAgICAgc2VsZi52aWV3c19saW5rID0gJ2h0dHA6Ly93d3cuaW1kYi5jb20vc2VhcmNoL3RpdGxlP3RpdGxlX3R5cGU9dHZfc2VyaWVzLG1pbmlfc2VyaWVzJm51bV92b3Rlcz0xMDAsJnJlbGVhc2VfZGF0ZT0sZGF0ZVswXSZzb3J0PW51bV92b3RlcyxkZXNjJmNvdW50PTQwJnN0YXJ0PTEnCiAgICAgICAgc2VsZi5wZXJzb25fbGluayA9ICdodHRwOi8vd3d3LmltZGIuY29tL3NlYXJjaC90aXRsZT90aXRsZV90eXBlPXR2X3NlcmllcyxtaW5pX3NlcmllcyZyZWxlYXNlX2RhdGU9LGRhdGVbMF0mcm9sZT0lcyZzb3J0PXllYXIsZGVzYyZjb3VudD00MCZzdGFydD0xJwogICAgICAgIHNlbGYuZ2VucmVfbGluayA9ICdodHRwOi8vd3d3LmltZGIuY29tL3NlYXJjaC90aXRsZT90aXRsZV90eXBlPXR2X3NlcmllcyxtaW5pX3NlcmllcyZyZWxlYXNlX2RhdGU9LGRhdGVbMF0mZ2VucmVzPSVzJnNvcnQ9bW92aWVtZXRlcixhc2MmY291bnQ9NDAmc3RhcnQ9MScKICAgICAgICBzZWxmLmtleXdvcmRfbGluayA9ICdodHRwOi8vd3d3LmltZGIuY29tL3NlYXJjaC90aXRsZT90aXRsZV90eXBlPXR2X3NlcmllcyxtaW5pX3NlcmllcyZyZWxlYXNlX2RhdGU9LGRhdGVbMF0ma2V5d29yZHM9JXMmc29ydD1tb3ZpZW1ldGVyLGFzYyZjb3VudD00MCZzdGFydD0xJwogICAgICAgIHNlbGYubGFuZ3VhZ2VfbGluayA9ICdodHRwOi8vd3d3LmltZGIuY29tL3NlYXJjaC90aXRsZT90aXRsZV90eXBlPXR2X3NlcmllcyxtaW5pX3NlcmllcyZudW1fdm90ZXM9MTAwLCZwcm9kdWN0aW9uX3N0YXR1cz1yZWxlYXNlZCZwcmltYXJ5X2xhbmd1YWdlPSVzJnNvcnQ9bW92aWVtZXRlcixhc2MmY291bnQ9NDAmc3RhcnQ9MScKICAgICAgICBzZWxmLmNlcnRpZmljYXRpb25fbGluayA9ICdodHRwOi8vd3d3LmltZGIuY29tL3NlYXJjaC90aXRsZT90aXRsZV90eXBlPXR2X3NlcmllcyxtaW5pX3NlcmllcyZyZWxlYXNlX2RhdGU9LGRhdGVbMF0mY2VydGlmaWNhdGVzPXVzOiVzJnNvcnQ9bW92aWVtZXRlcixhc2MmY291bnQ9NDAmc3RhcnQ9MScKICAgICAgICBzZWxmLnRyZW5kaW5nX2xpbmsgPSAnaHR0cDovL2FwaS50cmFrdC50di9zaG93cy90cmVuZGluZz9saW1pdD00MCZwYWdlPTEnCiAgICAgICAgc2VsZi5sYl9saW5rID0gJ2h0dHBzOi8vd3d3LmltZGIuY29tL3NlYXJjaC90aXRsZT90aXRsZT1JK0xvdmUrTHVjeSZyZWxlYXNlX2RhdGU9MTk1MS0wMS0wMSwxOTU3LTEyLTMxJm51bV92b3Rlcz0yMDI4MSwyMDI4MiZnZW5yZXM9ZmFtaWx5JnJvbGU9bm0wMDAwODQwJwoKICAgICAgICBzZWxmLnRyYWt0bGlzdHNfbGluayA9ICdodHRwOi8vYXBpLnRyYWt0LnR2L3VzZXJzL21lL2xpc3RzJwogICAgICAgIHNlbGYudHJha3RsaWtlZGxpc3RzX2xpbmsgPSAnaHR0cDovL2FwaS50cmFrdC50di91c2Vycy9saWtlcy9saXN0cz9saW1pdD0xMDAwMDAwJwogICAgICAgIHNlbGYudHJha3RsaXN0X2xpbmsgPSAnaHR0cDovL2FwaS50cmFrdC50di91c2Vycy8lcy9saXN0cy8lcy9pdGVtcycKICAgICAgICBzZWxmLnRyYWt0Y29sbGVjdGlvbl9saW5rID0gJ2h0dHA6Ly9hcGkudHJha3QudHYvdXNlcnMvbWUvY29sbGVjdGlvbi9zaG93cycKICAgICAgICBzZWxmLnRyYWt0d2F0Y2hsaXN0X2xpbmsgPSAnaHR0cDovL2FwaS50cmFrdC50di91c2Vycy9tZS93YXRjaGxpc3Qvc2hvd3MnCiAgICAgICAgc2VsZi50cmFrdGZlYXR1cmVkX2xpbmsgPSAnaHR0cDovL2FwaS50cmFrdC50di9yZWNvbW1lbmRhdGlvbnMvc2hvd3M/bGltaXQ9NDAnCiAgICAgICAgc2VsZi5pbWRibGlzdHNfbGluayA9ICdodHRwOi8vd3d3LmltZGIuY29tL3VzZXIvdXIlcy9saXN0cz90YWI9YWxsJnNvcnQ9bWRmZCZvcmRlcj1kZXNjJmZpbHRlcj10aXRsZXMnICUgc2VsZi5pbWRiX3VzZXIKICAgICAgICBzZWxmLmltZGJsaXN0X2xpbmsgPSAnaHR0cDovL3d3dy5pbWRiLmNvbS9saXN0LyVzLz92aWV3PWRldGFpbCZzb3J0PWFscGhhLGFzYyZ0aXRsZV90eXBlPXR2U2VyaWVzLHR2TWluaVNlcmllcyZzdGFydD0xJwogICAgICAgIHNlbGYuaW1kYmxpc3QyX2xpbmsgPSAnaHR0cDovL3d3dy5pbWRiLmNvbS9saXN0LyVzLz92aWV3PWRldGFpbCZzb3J0PWRhdGVfYWRkZWQsZGVzYyZ0aXRsZV90eXBlPXR2U2VyaWVzLHR2TWluaVNlcmllcyZzdGFydD0xJwogICAgICAgIHNlbGYuaW1kYndhdGNobGlzdF9saW5rID0gJ2h0dHA6Ly93d3cuaW1kYi5jb20vdXNlci91ciVzL3dhdGNobGlzdD9zb3J0PWFscGhhLGFzYycgJSBzZWxmLmltZGJfdXNlcgogICAgICAgIHNlbGYuaW1kYndhdGNobGlzdDJfbGluayA9ICdodHRwOi8vd3d3LmltZGIuY29tL3VzZXIvdXIlcy93YXRjaGxpc3Q/c29ydD1kYXRlX2FkZGVkLGRlc2MnICUgc2VsZi5pbWRiX3VzZXIKCgogICAgZGVmIGdldChzZWxmLCB1cmwsIGlkeD1UcnVlLCBjcmVhdGVfZGlyZWN0b3J5PVRydWUpOgogICAgICAgIHRyeToKICAgICAgICAgICAgdHJ5OiB1cmwgPSBnZXRhdHRyKHNlbGYsIHVybCArICdfbGluaycpCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcwoKICAgICAgICAgICAgdHJ5OiB1ID0gdXJscGFyc2UudXJscGFyc2UodXJsKS5uZXRsb2MubG93ZXIoKQogICAgICAgICAgICBleGNlcHQ6IHBhc3MKCgogICAgICAgICAgICBpZiB1IGluIHNlbGYudHJha3RfbGluayBhbmQgJy91c2Vycy8nIGluIHVybDoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBpZiBub3QgJy91c2Vycy9tZS8nIGluIHVybDogcmFpc2UgRXhjZXB0aW9uKCkKICAgICAgICAgICAgICAgICAgICBpZiB0cmFrdC5nZXRBY3Rpdml0eSgpID4gY2FjaGUudGltZW91dChzZWxmLnRyYWt0X2xpc3QsIHVybCwgc2VsZi50cmFrdF91c2VyKTogcmFpc2UgRXhjZXB0aW9uKCkKICAgICAgICAgICAgICAgICAgICBzZWxmLmxpc3QgPSBjYWNoZS5nZXQoc2VsZi50cmFrdF9saXN0LCA3MjAsIHVybCwgc2VsZi50cmFrdF91c2VyKQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHNlbGYubGlzdCA9IGNhY2hlLmdldChzZWxmLnRyYWt0X2xpc3QsIDAsIHVybCwgc2VsZi50cmFrdF91c2VyKQoKICAgICAgICAgICAgICAgIGlmICcvdXNlcnMvbWUvJyBpbiB1cmwgYW5kICcvY29sbGVjdGlvbi8nIGluIHVybDoKICAgICAgICAgICAgICAgICAgICBzZWxmLmxpc3QgPSBzb3J0ZWQoc2VsZi5saXN0LCBrZXk9bGFtYmRhIGs6IHV0aWxzLnRpdGxlX2tleShrWyd0aXRsZSddKSkKCiAgICAgICAgICAgICAgICBpZiBpZHggPT0gVHJ1ZTogc2VsZi53b3JrZXIoKQoKICAgICAgICAgICAgZWxpZiB1IGluIHNlbGYudHJha3RfbGluayBhbmQgc2VsZi5zZWFyY2hfbGluayBpbiB1cmw6CiAgICAgICAgICAgICAgICBzZWxmLmxpc3QgPSBjYWNoZS5nZXQoc2VsZi50cmFrdF9saXN0LCAxLCB1cmwsIHNlbGYudHJha3RfdXNlcikKICAgICAgICAgICAgICAgIGlmIGlkeCA9PSBUcnVlOiBzZWxmLndvcmtlcihsZXZlbD0wKQoKICAgICAgICAgICAgZWxpZiB1IGluIHNlbGYudHJha3RfbGluazoKICAgICAgICAgICAgICAgIHNlbGYubGlzdCA9IGNhY2hlLmdldChzZWxmLnRyYWt0X2xpc3QsIDI0LCB1cmwsIHNlbGYudHJha3RfdXNlcikKICAgICAgICAgICAgICAgIGlmIGlkeCA9PSBUcnVlOiBzZWxmLndvcmtlcigpCgoKICAgICAgICAgICAgZWxpZiB1IGluIHNlbGYuaW1kYl9saW5rIGFuZCAoJy91c2VyLycgaW4gdXJsIG9yICcvbGlzdC8nIGluIHVybCk6CiAgICAgICAgICAgICAgICBzZWxmLmxpc3QgPSBjYWNoZS5nZXQoc2VsZi5pbWRiX2xpc3QsIDAsIHVybCkKICAgICAgICAgICAgICAgIGlmIGlkeCA9PSBUcnVlOiBzZWxmLndvcmtlcigpCgogICAgICAgICAgICBlbGlmIHUgaW4gc2VsZi5pbWRiX2xpbms6CiAgICAgICAgICAgICAgICBzZWxmLmxpc3QgPSBjYWNoZS5nZXQoc2VsZi5pbWRiX2xpc3QsIDI0LCB1cmwpCiAgICAgICAgICAgICAgICBpZiBpZHggPT0gVHJ1ZTogc2VsZi53b3JrZXIoKQoKCiAgICAgICAgICAgIGVsaWYgdSBpbiBzZWxmLnR2bWF6ZV9saW5rOgogICAgICAgICAgICAgICAgc2VsZi5saXN0ID0gY2FjaGUuZ2V0KHNlbGYudHZtYXplX2xpc3QsIDE2OCwgdXJsKQogICAgICAgICAgICAgICAgaWYgaWR4ID09IFRydWU6IHNlbGYud29ya2VyKCkKCgogICAgICAgICAgICBpZiBpZHggPT0gVHJ1ZSBhbmQgY3JlYXRlX2RpcmVjdG9yeSA9PSBUcnVlOiBzZWxmLnR2c2hvd0RpcmVjdG9yeShzZWxmLmxpc3QpCiAgICAgICAgICAgIHJldHVybiBzZWxmLmxpc3QKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHBhc3MKCiAgICBkZWYgc2VhcmNoKHNlbGYpOgogICAgICAgIG5hdmlnYXRvci5uYXZpZ2F0b3IoKS5hZGREaXJlY3RvcnlJdGVtKDMyNjAzLCAndHZTZWFyY2huZXcnLCAnc2VhcmNoLnBuZycsICdEZWZhdWx0VFZTaG93cy5wbmcnKQogICAgICAgIHNlYXJjaF9oaXN0b3J5ID0gY29udHJvbC5zZXR0aW5nKCd0dnNlYXJjaCcpCiAgICAgICAgaWYgc2VhcmNoX2hpc3Rvcnk6CiAgICAgICAgICAgIGZvciB0ZXJtIGluIHNlYXJjaF9oaXN0b3J5LnNwbGl0KCdcbicpOgogICAgICAgICAgICAgICAgaWYgdGVybToKICAgICAgICAgICAgICAgICAgICBuYXZpZ2F0b3IubmF2aWdhdG9yKCkuYWRkRGlyZWN0b3J5SXRlbSh0ZXJtLCAndHZTZWFyY2h0ZXJtJm5hbWU9JXMnICUgdGVybSwgJ3NlYXJjaC5wbmcnLCAnRGVmYXVsdFRWU2hvd3MucG5nJykKICAgICAgICAgICAgbmF2aWdhdG9yLm5hdmlnYXRvcigpLmFkZERpcmVjdG9yeUl0ZW0oMzI2MDUsICdjbGVhckNhY2hlU2VhcmNoJywgJ3Rvb2xzLnBuZycsICdEZWZhdWx0QWRkb25Qcm9ncmFtLnBuZycpCiAgICAgICAgbmF2aWdhdG9yLm5hdmlnYXRvcigpLmVuZERpcmVjdG9yeSgpCgoKCgogICAgZGVmIHNlYXJjaF9uZXcoc2VsZik6CiAgICAgICAgdCA9IGNvbnRyb2wubGFuZygzMjAxMCkuZW5jb2RlKCd1dGYtOCcpCiAgICAgICAgayA9IGNvbnRyb2wua2V5Ym9hcmQoJycsIHQpIDsgay5kb01vZGFsKCkKICAgICAgICBxID0gay5nZXRUZXh0KCkuc3RyaXAoKSBpZiBrLmlzQ29uZmlybWVkKCkgZWxzZSBOb25lCiAgICAgICAgaWYgbm90IHE6IHJldHVybgoKCiAgICAgICAgc2VhcmNoX2hpc3RvcnkgPSBjb250cm9sLnNldHRpbmcoJ3R2c2VhcmNoJykKICAgICAgICBpZiBxIG5vdCBpbiBzZWFyY2hfaGlzdG9yeS5zcGxpdCgnXG4nKToKICAgICAgICAgICAgY29udHJvbC5zZXRTZXR0aW5nKCd0dnNlYXJjaCcsIHEgKyAnXG4nICsgc2VhcmNoX2hpc3RvcnkpCiAgICAgICAgICAgIAogICAgICAgIHVybCA9IHNlbGYuc2VhcmNoX2xpbmsgKyB1cmxsaWIucXVvdGVfcGx1cyhxKQogICAgICAgIHNlbGYuZ2V0KHVybCkKCgoKCiAgICBkZWYgc2VhcmNoX3Rlcm0oc2VsZiwgbmFtZSk6CiAgICAgICAgdXJsID0gc2VsZi5zZWFyY2hfbGluayArIHVybGxpYi5xdW90ZV9wbHVzKG5hbWUpCiAgICAgICAgc2VsZi5nZXQodXJsKQoKCgoKICAgIGRlZiBwZXJzb24oc2VsZik6CiAgICAgICAgdCA9IGNvbnRyb2wubGFuZygzMjAxMCkuZW5jb2RlKCd1dGYtOCcpCiAgICAgICAgayA9IGNvbnRyb2wua2V5Ym9hcmQoJycsIHQpIDsgay5kb01vZGFsKCkKICAgICAgICBxID0gay5nZXRUZXh0KCkuc3RyaXAoKSBpZiBrLmlzQ29uZmlybWVkKCkgZWxzZSBOb25lCiAgICAgICAgaWYgbm90IHE6IHJldHVybgoKCiAgICAgICAgdXJsID0gc2VsZi5wZXJzb25zX2xpbmsgKyB1cmxsaWIucXVvdGVfcGx1cyhxKQogICAgICAgIHNlbGYucGVyc29ucyh1cmwpCgogICAgZGVmIGdlbnJlcyhzZWxmKToKICAgICAgICBnZW5yZXMgPSBbCiAgICAgICAgICAgICgnQWN0aW9uJywgJ2FjdGlvbicsIFRydWUpLAogICAgICAgICAgICAoJ0FkdmVudHVyZScsICdhZHZlbnR1cmUnLCBUcnVlKSwKICAgICAgICAgICAgKCdBbmltYXRpb24nLCAnYW5pbWF0aW9uJywgVHJ1ZSksCiAgICAgICAgICAgICgnQW5pbWUnLCAnYW5pbWUnLCBGYWxzZSksCiAgICAgICAgICAgICgnQmlvZ3JhcGh5JywgJ2Jpb2dyYXBoeScsIFRydWUpLAogICAgICAgICAgICAoJ0NvbWVkeScsICdjb21lZHknLCBUcnVlKSwKICAgICAgICAgICAgKCdDcmltZScsICdjcmltZScsIFRydWUpLAogICAgICAgICAgICAoJ0RyYW1hJywgJ2RyYW1hJywgVHJ1ZSksCiAgICAgICAgICAgICgnRmFtaWx5JywgJ2ZhbWlseScsIFRydWUpLAogICAgICAgICAgICAoJ0ZhbnRhc3knLCAnZmFudGFzeScsIFRydWUpLAogICAgICAgICAgICAoJ0dhbWUtU2hvdycsICdnYW1lX3Nob3cnLCBUcnVlKSwKICAgICAgICAgICAgKCdIaXN0b3J5JywgJ2hpc3RvcnknLCBUcnVlKSwKICAgICAgICAgICAgKCdIb3Jyb3InLCAnaG9ycm9yJywgVHJ1ZSksCiAgICAgICAgICAgICgnTXVzaWMgJywgJ211c2ljJywgVHJ1ZSksCiAgICAgICAgICAgICgnTXVzaWNhbCcsICdtdXNpY2FsJywgVHJ1ZSksCiAgICAgICAgICAgICgnTXlzdGVyeScsICdteXN0ZXJ5JywgVHJ1ZSksCiAgICAgICAgICAgICgnTmV3cycsICduZXdzJywgVHJ1ZSksCiAgICAgICAgICAgICgnUmVhbGl0eS1UVicsICdyZWFsaXR5X3R2JywgVHJ1ZSksCiAgICAgICAgICAgICgnUm9tYW5jZScsICdyb21hbmNlJywgVHJ1ZSksCiAgICAgICAgICAgICgnU2NpZW5jZSBGaWN0aW9uJywgJ3NjaV9maScsIFRydWUpLAogICAgICAgICAgICAoJ1Nwb3J0JywgJ3Nwb3J0JywgVHJ1ZSksCiAgICAgICAgICAgICgnVGFsay1TaG93JywgJ3RhbGtfc2hvdycsIFRydWUpLAogICAgICAgICAgICAoJ1RocmlsbGVyJywgJ3RocmlsbGVyJywgVHJ1ZSksCiAgICAgICAgICAgICgnV2FyJywgJ3dhcicsIFRydWUpLAogICAgICAgICAgICAoJ1dlc3Rlcm4nLCAnd2VzdGVybicsIFRydWUpCiAgICAgICAgXQoKICAgICAgICBmb3IgaSBpbiBnZW5yZXM6IHNlbGYubGlzdC5hcHBlbmQoCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICduYW1lJzogY2xlYW5nZW5yZS5sYW5nKGlbMF0sIHNlbGYubGFuZyksCiAgICAgICAgICAgICAgICAndXJsJzogc2VsZi5nZW5yZV9saW5rICUgaVsxXSBpZiBpWzJdIGVsc2Ugc2VsZi5rZXl3b3JkX2xpbmsgJSBpWzFdLAogICAgICAgICAgICAgICAgJ2ltYWdlJzogJ2dlbnJlcy5wbmcnLAogICAgICAgICAgICAgICAgJ2FjdGlvbic6ICd0dnNob3dzJwogICAgICAgICAgICB9KQoKICAgICAgICBzZWxmLmFkZERpcmVjdG9yeShzZWxmLmxpc3QpCiAgICAgICAgcmV0dXJuIHNlbGYubGlzdAoKICAgIGRlZiBuZXR3b3JrcyhzZWxmKToKICAgICAgICBuZXR3b3JrcyA9IFsKICAgICAgICAoJ0EmRScsICcvbmV0d29ya3MvMjkvYWUnLCAnaHR0cHM6Ly9pLmltZ3VyLmNvbS94TERmSGpILnBuZycpLAogICAgICAgICgnQUJDJywgJy9uZXR3b3Jrcy8zL2FiYycsICdodHRwczovL2kuaW1ndXIuY29tL3FlUEx4b3MucG5nJyksCiAgICAgICAgKCdBTUMnLCAnL25ldHdvcmtzLzIwL2FtYycsICdodHRwczovL2kuaW1ndXIuY29tL25kb3JKeGkucG5nJyksCiAgICAgICAgKCdBVC1YJywgJy9uZXR3b3Jrcy8xNjcvYXQteCcsICdodHRwczovL2kuaW1ndXIuY29tL0pzaEpZR04ucG5nJyksCiAgICAgICAgKCdBZHVsdCBTd2ltJywgJy9uZXR3b3Jrcy8xMC9hZHVsdC1zd2ltJywgJ2h0dHBzOi8vaS5pbWd1ci5jb20vakNxYlJjUy5wbmcnKSwKICAgICAgICAoJ0FtYXpvbicsICcvd2ViY2hhbm5lbHMvMy9hbWF6b24nLCAnaHR0cHM6Ly9pLmltZ3VyLmNvbS9ydTlERGxMLnBuZycpLAogICAgICAgICgnQW5pbWFsIFBsYW5ldCcsICcvbmV0d29ya3MvOTIvYW5pbWFsLXBsYW5ldCcsICdodHRwczovL2kuaW1ndXIuY29tL29sS2M0UlAucG5nJyksCiAgICAgICAgKCdBdWRpZW5jZScsICcvbmV0d29ya3MvMzEvYXVkaWVuY2UtbmV0d29yaycsICdodHRwczovL2kuaW1ndXIuY29tLzVRM21vNUEucG5nJyksCiAgICAgICAgKCdCQkMgQW1lcmljYScsICcvbmV0d29ya3MvMTUvYmJjLWFtZXJpY2EnLCAnaHR0cHM6Ly9pLmltZ3VyLmNvbS9UVUhEamZsLnBuZycpLAogICAgICAgICgnQkJDIEZvdXInLCAnL25ldHdvcmtzLzUxL2JiYy1mb3VyJywgJ2h0dHBzOi8vaS5pbWd1ci5jb20vUE5EYWxndy5wbmcnKSwKICAgICAgICAoJ0JCQyBPbmUnLCAnL25ldHdvcmtzLzEyL2JiYy1vbmUnLCAnaHR0cHM6Ly9pLmltZ3VyLmNvbS91OHgyNnRlLnBuZycpLAogICAgICAgICgnQkJDIFRocmVlJywgJy93ZWJjaGFubmVscy83MS9iYmMtdGhyZWUnLCAnaHR0cHM6Ly9pLmltZ3VyLmNvbS9TRExlTGNuLnBuZycpLAogICAgICAgICgnQkJDIFR3bycsICcvbmV0d29ya3MvMzcvYmJjLXR3bycsICdodHRwczovL2kuaW1ndXIuY29tL1NLZUdIMWEucG5nJyksCiAgICAgICAgKCdCRVQnLCAnL25ldHdvcmtzLzU2L2JldCcsICdodHRwczovL2kuaW1ndXIuY29tL1pwR0o1VVEucG5nJyksCiAgICAgICAgKCdCcmF2bycsICcvbmV0d29ya3MvNTIvYnJhdm8nLCAnaHR0cHM6Ly9pLmltZ3VyLmNvbS9UbUVPM1RuLnBuZycpLAogICAgICAgICgnQ0JDJywgJy9uZXR3b3Jrcy8zNi9jYmMnLCAnaHR0cHM6Ly9pLmltZ3VyLmNvbS91blE3V0NaLnBuZycpLAogICAgICAgICgnQ0JTJywgJy9uZXR3b3Jrcy8yL2NicycsICdodHRwczovL2kuaW1ndXIuY29tLzhPVDhpZ1IucG5nJyksCiAgICAgICAgKCdDVFYnLCAnL25ldHdvcmtzLzQ4L2N0dicsICdodHRwczovL2kuaW1ndXIuY29tL3FVbHlWSHoucG5nJyksCiAgICAgICAgKCdDVycsICcvbmV0d29ya3MvNS90aGUtY3cnLCAnaHR0cHM6Ly9pLmltZ3VyLmNvbS9ROHRvb2VNLnBuZycpLAogICAgICAgICgnQ1cgU2VlZCcsICcvd2ViY2hhbm5lbHMvMTMvY3ctc2VlZCcsICdodHRwczovL2kuaW1ndXIuY29tL25PZEtvRXkucG5nJyksCiAgICAgICAgKCdDYXJ0b29uIE5ldHdvcmsnLCAnL25ldHdvcmtzLzExL2NhcnRvb24tbmV0d29yaycsICdodHRwczovL2kuaW1ndXIuY29tL3ptT0xiYkkucG5nJyksCiAgICAgICAgKCdDaGFubmVsIDQnLCAnL25ldHdvcmtzLzQ1L2NoYW5uZWwtNCcsICdodHRwczovL2kuaW1ndXIuY29tLzZaQTlVSFIucG5nJyksCiAgICAgICAgKCdDaGFubmVsIDUnLCAnL25ldHdvcmtzLzEzNS9jaGFubmVsLTUnLCAnaHR0cHM6Ly9pLmltZ3VyLmNvbS81dWJudk9oLnBuZycpLAogICAgICAgICgnQ2luZW1heCcsICcvbmV0d29ya3MvMTkvY2luZW1heCcsICdodHRwczovL2kuaW1ndXIuY29tL3pXeXBGTkkucG5nJyksCiAgICAgICAgKCdDb21lZHkgQ2VudHJhbCcsICcvbmV0d29ya3MvMjMvY29tZWR5LWNlbnRyYWwnLCAnaHR0cHM6Ly9pLmltZ3VyLmNvbS9rbzZYTjc3LnBuZycpLAogICAgICAgICgnQ3JhY2tsZScsICcvd2ViY2hhbm5lbHMvNC9jcmFja2xlJywgJ2h0dHBzOi8vaS5pbWd1ci5jb20vNTNrcVpTWS5wbmcnKSwKICAgICAgICAoJ0Rpc2NvdmVyeSBDaGFubmVsJywgJy9uZXR3b3Jrcy82Ni9kaXNjb3ZlcnktY2hhbm5lbCcsICdodHRwczovL2kuaW1ndXIuY29tLzhVclhuQUIucG5nJyksCiAgICAgICAgKCdEaXNjb3ZlcnkgSUQnLCAnL25ldHdvcmtzLzg5L2ludmVzdGlnYXRpb24tZGlzY292ZXJ5JywgJ2h0dHBzOi8vaS5pbWd1ci5jb20vMDd3N0JFUi5wbmcnKSwKICAgICAgICAoJ0Rpc25leSBDaGFubmVsJywgJy9uZXR3b3Jrcy83OC9kaXNuZXktY2hhbm5lbCcsICdodHRwczovL2kuaW1ndXIuY29tL1pDZ0VrcDYucG5nJyksCiAgICAgICAgKCdEaXNuZXkgWEQnLCAnL25ldHdvcmtzLzI1L2Rpc25leS14ZCcsICdodHRwczovL2kuaW1ndXIuY29tL1BBSkpvcVEucG5nJyksCiAgICAgICAgKCdFISBFbnRlcnRhaW5tZW50JywgJy9uZXR3b3Jrcy80My9lJywgJ2h0dHBzOi8vaS5pbWd1ci5jb20vM0RlbGY5Zi5wbmcnKSwKICAgICAgICAoJ0U0JywgJy9uZXR3b3Jrcy80MS9lNCcsICdodHRwczovL2kuaW1ndXIuY29tL2ZycHVuSzgucG5nJyksCiAgICAgICAgKCdGT1gnLCAnL25ldHdvcmtzLzQvZm94JywgJ2h0dHBzOi8vaS5pbWd1ci5jb20vNnZjMElvdi5wbmcnKSwKICAgICAgICAoJ0ZYJywgJy9uZXR3b3Jrcy8xMy9meCcsICdodHRwczovL2kuaW1ndXIuY29tL2FRYzFBSVoucG5nJyksCiAgICAgICAgKCdGcmVlZm9ybScsICcvbmV0d29ya3MvMjYvZnJlZWZvcm0nLCAnaHR0cHM6Ly9pLmltZ3VyLmNvbS9mOUFxb0hFLnBuZycpLAogICAgICAgICgnSEJPJywgJy9uZXR3b3Jrcy84L2hibycsICdodHRwczovL2kuaW1ndXIuY29tL0h5dThaR3EucG5nJyksCiAgICAgICAgKCdIR1RWJywgJy9uZXR3b3Jrcy8xOTIvaGd0dicsICdodHRwczovL2kuaW1ndXIuY29tL0lObm1nTFQucG5nJyksCiAgICAgICAgKCdIYWxsbWFyaycsICcvbmV0d29ya3MvNTAvaGFsbG1hcmstY2hhbm5lbCcsICdodHRwczovL2kuaW1ndXIuY29tL3pYUzY0STgucG5nJyksCiAgICAgICAgKCdIaXN0b3J5IENoYW5uZWwnLCAnL25ldHdvcmtzLzUzL2hpc3RvcnknLCAnaHR0cHM6Ly9pLmltZ3VyLmNvbS9MRU1neTZuLnBuZycpLAogICAgICAgICgnSVRWJywgJy9uZXR3b3Jrcy8zNS9pdHYnLCAnaHR0cHM6Ly9pLmltZ3VyLmNvbS81SHhwNWVBLnBuZycpLAogICAgICAgICgnTGlmZXRpbWUnLCAnL25ldHdvcmtzLzE4L2xpZmV0aW1lJywgJ2h0dHBzOi8vaS5pbWd1ci5jb20vdHZZYmhlbi5wbmcnKSwKICAgICAgICAoJ01UVicsICcvbmV0d29ya3MvMjIvbXR2JywgJ2h0dHBzOi8vaS5pbWd1ci5jb20vUU02RHBOVy5wbmcnKSwKICAgICAgICAoJ05CQycsICcvbmV0d29ya3MvMS9uYmMnLCAnaHR0cHM6Ly9pLmltZ3VyLmNvbS95UFJpclFaLnBuZycpLAogICAgICAgICgnTmF0aW9uYWwgR2VvZ3JhcGhpYycsICcvbmV0d29ya3MvNDIvbmF0aW9uYWwtZ2VvZ3JhcGhpYy1jaGFubmVsJywgJ2h0dHBzOi8vaS5pbWd1ci5jb20vWENHTktWUS5wbmcnKSwKICAgICAgICAoJ05ldGZsaXgnLCAnL3dlYmNoYW5uZWxzLzEvbmV0ZmxpeCcsICdodHRwczovL2kuaW1ndXIuY29tL2pJNWMzYncucG5nJyksCiAgICAgICAgKCdOaWNrZWxvZGVvbicsICcvbmV0d29ya3MvMjcvbmlja2Vsb2Rlb24nLCAnaHR0cHM6Ly9pLmltZ3VyLmNvbS9PVVZvcVljLnBuZycpLAogICAgICAgICgnUEJTJywgJy9uZXR3b3Jrcy84NS9wYnMnLCAnaHR0cHM6Ly9pLmltZ3VyLmNvbS9yOXFlREpZLnBuZycpLAogICAgICAgICgnU2hvd3RpbWUnLCAnL25ldHdvcmtzLzkvc2hvd3RpbWUnLCAnaHR0cHM6Ly9pLmltZ3VyLmNvbS9TYXdBWWtPLnBuZycpLAogICAgICAgICgnU2t5MScsICcvbmV0d29ya3MvNjMvc2t5LTEnLCAnaHR0cHM6Ly9pLmltZ3VyLmNvbS94Ymd6aFBVLnBuZycpLAogICAgICAgICgnU3RhcnonLCAnL25ldHdvcmtzLzE3L3N0YXJ6JywgJ2h0dHBzOi8vaS5pbWd1ci5jb20vWjBlcDJSdS5wbmcnKSwKICAgICAgICAoJ1N1bmRhbmNlJywgJy9uZXR3b3Jrcy8zMy9zdW5kYW5jZS10dicsICdodHRwczovL2kuaW1ndXIuY29tL3FsZEc1cDIucG5nJyksCiAgICAgICAgKCdTeWZ5JywgJy9uZXR3b3Jrcy8xNi9zeWZ5JywgJ2h0dHBzOi8vaS5pbWd1ci5jb20vOXlDcTM3aS5wbmcnKSwKICAgICAgICAoJ1RCUycsICcvbmV0d29ya3MvMzIvdGJzJywgJ2h0dHBzOi8vaS5pbWd1ci5jb20vUlZDdHQ0Wi5wbmcnKSwKICAgICAgICAoJ1RMQycsICcvbmV0d29ya3MvODAvdGxjJywgJ2h0dHBzOi8vaS5pbWd1ci5jb20vYzI0TXhhQi5wbmcnKSwKICAgICAgICAoJ1ROVCcsICcvbmV0d29ya3MvMTQvdG50JywgJ2h0dHBzOi8vaS5pbWd1ci5jb20vV256cEFHai5wbmcnKSwKICAgICAgICAoJ1RWIExhbmQnLCAnL25ldHdvcmtzLzU3L3R2bGFuZCcsICdodHRwczovL2kuaW1ndXIuY29tLzFuSWVEQTUucG5nJyksCiAgICAgICAgKCdUcmF2ZWwgQ2hhbm5lbCcsICcvbmV0d29ya3MvODIvdHJhdmVsLWNoYW5uZWwnLCAnaHR0cHM6Ly9pLmltZ3VyLmNvbS9tV1h2N1NGLnBuZycpLAogICAgICAgICgnVHJ1VFYnLCAnL25ldHdvcmtzLzg0L3RydXR2JywgJ2h0dHBzOi8vaS5pbWd1ci5jb20vSG5CM3pmYy5wbmcnKSwKICAgICAgICAoJ1VTQScsICcvbmV0d29ya3MvMzAvdXNhLW5ldHdvcmsnLCAnaHR0cHM6Ly9pLmltZ3VyLmNvbS9Eb2NjdzlFLnBuZycpLAogICAgICAgICgnVkgxJywgJy9uZXR3b3Jrcy81NS92aDEnLCAnaHR0cHM6Ly9pLmltZ3VyLmNvbS9JVXRIWXpBLnBuZycpLAogICAgICAgICgnV0dOJywgJy9uZXR3b3Jrcy8yOC93Z24tYW1lcmljYScsICdodHRwczovL2kuaW1ndXIuY29tL1RMNk16Z08ucG5nJykKICAgICAgICBdCgogICAgICAgIGZvciBpIGluIG5ldHdvcmtzOiBzZWxmLmxpc3QuYXBwZW5kKHsnbmFtZSc6IGlbMF0sICd1cmwnOiBzZWxmLnR2bWF6ZV9saW5rICsgaVsxXSwgJ2ltYWdlJzogaVsyXSwgJ2FjdGlvbic6ICd0dnNob3dzJ30pCiAgICAgICAgc2VsZi5hZGREaXJlY3Rvcnkoc2VsZi5saXN0KQogICAgICAgIHJldHVybiBzZWxmLmxpc3QKCgogICAgZGVmIGxhbmd1YWdlcyhzZWxmKToKICAgICAgICBsYW5ndWFnZXMgPSBbCiAgICAgICAgKCdBcmFiaWMnLCAnYXInKSwKICAgICAgICAoJ0Jvc25pYW4nLCAnYnMnKSwKICAgICAgICAoJ0J1bGdhcmlhbicsICdiZycpLAogICAgICAgICgnQ2hpbmVzZScsICd6aCcpLAogICAgICAgICgnQ3JvYXRpYW4nLCAnaHInKSwKICAgICAgICAoJ0R1dGNoJywgJ25sJyksCiAgICAgICAgKCdFbmdsaXNoJywgJ2VuJyksCiAgICAgICAgKCdGaW5uaXNoJywgJ2ZpJyksCiAgICAgICAgKCdGcmVuY2gnLCAnZnInKSwKICAgICAgICAoJ0dlcm1hbicsICdkZScpLAogICAgICAgICgnR3JlZWsnLCAnZWwnKSwKICAgICAgICAoJ0hlYnJldycsICdoZScpLAogICAgICAgICgnSGluZGkgJywgJ2hpJyksCiAgICAgICAgKCdIdW5nYXJpYW4nLCAnaHUnKSwKICAgICAgICAoJ0ljZWxhbmRpYycsICdpcycpLAogICAgICAgICgnSXRhbGlhbicsICdpdCcpLAogICAgICAgICgnSmFwYW5lc2UnLCAnamEnKSwKICAgICAgICAoJ0tvcmVhbicsICdrbycpLAogICAgICAgICgnTm9yd2VnaWFuJywgJ25vJyksCiAgICAgICAgKCdQZXJzaWFuJywgJ2ZhJyksCiAgICAgICAgKCdQb2xpc2gnLCAncGwnKSwKICAgICAgICAoJ1BvcnR1Z3Vlc2UnLCAncHQnKSwKICAgICAgICAoJ1B1bmphYmknLCAncGEnKSwKICAgICAgICAoJ1JvbWFuaWFuJywgJ3JvJyksCiAgICAgICAgKCdSdXNzaWFuJywgJ3J1JyksCiAgICAgICAgKCdTZXJiaWFuJywgJ3NyJyksCiAgICAgICAgKCdTcGFuaXNoJywgJ2VzJyksCiAgICAgICAgKCdTd2VkaXNoJywgJ3N2JyksCiAgICAgICAgKCdUdXJraXNoJywgJ3RyJyksCiAgICAgICAgKCdVa3JhaW5pYW4nLCAndWsnKQogICAgICAgIF0KCiAgICAgICAgZm9yIGkgaW4gbGFuZ3VhZ2VzOiBzZWxmLmxpc3QuYXBwZW5kKHsnbmFtZSc6IHN0cihpWzBdKSwgJ3VybCc6IHNlbGYubGFuZ3VhZ2VfbGluayAlIGlbMV0sICdpbWFnZSc6ICdsYW5ndWFnZXMucG5nJywgJ2FjdGlvbic6ICd0dnNob3dzJ30pCiAgICAgICAgc2VsZi5hZGREaXJlY3Rvcnkoc2VsZi5saXN0KQogICAgICAgIHJldHVybiBzZWxmLmxpc3QKCgogICAgZGVmIGNlcnRpZmljYXRpb25zKHNlbGYpOgogICAgICAgIGNlcnRpZmljYXRlcyA9IFsnVFYtRycsICdUVi1QRycsICdUVi0xNCcsICdUVi1NQSddCgogICAgICAgIGZvciBpIGluIGNlcnRpZmljYXRlczogc2VsZi5saXN0LmFwcGVuZCh7J25hbWUnOiBzdHIoaSksICd1cmwnOiBzZWxmLmNlcnRpZmljYXRpb25fbGluayAlIHN0cihpKS5yZXBsYWNlKCctJywgJ18nKS5sb3dlcigpLCAnaW1hZ2UnOiAnY2VydGlmaWNhdGVzLnBuZycsICdhY3Rpb24nOiAndHZzaG93cyd9KQogICAgICAgIHNlbGYuYWRkRGlyZWN0b3J5KHNlbGYubGlzdCkKICAgICAgICByZXR1cm4gc2VsZi5saXN0CgoKICAgIGRlZiBwZXJzb25zKHNlbGYsIHVybCk6CiAgICAgICAgaWYgdXJsID09IE5vbmU6CiAgICAgICAgICAgIHNlbGYubGlzdCA9IGNhY2hlLmdldChzZWxmLmltZGJfcGVyc29uX2xpc3QsIDI0LCBzZWxmLnBlcnNvbmxpc3RfbGluaykKICAgICAgICBlbHNlOgogICAgICAgICAgICBzZWxmLmxpc3QgPSBjYWNoZS5nZXQoc2VsZi5pbWRiX3BlcnNvbl9saXN0LCAxLCB1cmwpCgogICAgICAgIGZvciBpIGluIHJhbmdlKDAsIGxlbihzZWxmLmxpc3QpKTogc2VsZi5saXN0W2ldLnVwZGF0ZSh7J2FjdGlvbic6ICd0dnNob3dzJ30pCiAgICAgICAgc2VsZi5hZGREaXJlY3Rvcnkoc2VsZi5saXN0KQogICAgICAgIHJldHVybiBzZWxmLmxpc3QKCgogICAgZGVmIHVzZXJsaXN0cyhzZWxmKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHVzZXJsaXN0cyA9IFtdCiAgICAgICAgICAgIGlmIHRyYWt0LmdldFRyYWt0Q3JlZGVudGlhbHNJbmZvKCkgPT0gRmFsc2U6IHJhaXNlIEV4Y2VwdGlvbigpCiAgICAgICAgICAgIGFjdGl2aXR5ID0gdHJha3QuZ2V0QWN0aXZpdHkoKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwoKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIHRyYWt0LmdldFRyYWt0Q3JlZGVudGlhbHNJbmZvKCkgPT0gRmFsc2U6IHJhaXNlIEV4Y2VwdGlvbigpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlmIGFjdGl2aXR5ID4gY2FjaGUudGltZW91dChzZWxmLnRyYWt0X3VzZXJfbGlzdCwgc2VsZi50cmFrdGxpc3RzX2xpbmssIHNlbGYudHJha3RfdXNlcik6IHJhaXNlIEV4Y2VwdGlvbigpCiAgICAgICAgICAgICAgICB1c2VybGlzdHMgKz0gY2FjaGUuZ2V0KHNlbGYudHJha3RfdXNlcl9saXN0LCA3MjAsIHNlbGYudHJha3RsaXN0c19saW5rLCBzZWxmLnRyYWt0X3VzZXIpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHVzZXJsaXN0cyArPSBjYWNoZS5nZXQoc2VsZi50cmFrdF91c2VyX2xpc3QsIDAsIHNlbGYudHJha3RsaXN0c19saW5rLCBzZWxmLnRyYWt0X3VzZXIpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLmxpc3QgPSBbXQogICAgICAgICAgICBpZiBzZWxmLmltZGJfdXNlciA9PSAnJzogcmFpc2UgRXhjZXB0aW9uKCkKICAgICAgICAgICAgdXNlcmxpc3RzICs9IGNhY2hlLmdldChzZWxmLmltZGJfdXNlcl9saXN0LCAwLCBzZWxmLmltZGJsaXN0c19saW5rKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5saXN0ID0gW10KICAgICAgICAgICAgaWYgdHJha3QuZ2V0VHJha3RDcmVkZW50aWFsc0luZm8oKSA9PSBGYWxzZTogcmFpc2UgRXhjZXB0aW9uKCkKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaWYgYWN0aXZpdHkgPiBjYWNoZS50aW1lb3V0KHNlbGYudHJha3RfdXNlcl9saXN0LCBzZWxmLnRyYWt0bGlrZWRsaXN0c19saW5rLCBzZWxmLnRyYWt0X3VzZXIpOiByYWlzZSBFeGNlcHRpb24oKQogICAgICAgICAgICAgICAgdXNlcmxpc3RzICs9IGNhY2hlLmdldChzZWxmLnRyYWt0X3VzZXJfbGlzdCwgNzIwLCBzZWxmLnRyYWt0bGlrZWRsaXN0c19saW5rLCBzZWxmLnRyYWt0X3VzZXIpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHVzZXJsaXN0cyArPSBjYWNoZS5nZXQoc2VsZi50cmFrdF91c2VyX2xpc3QsIDAsIHNlbGYudHJha3RsaWtlZGxpc3RzX2xpbmssIHNlbGYudHJha3RfdXNlcikKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHBhc3MKCiAgICAgICAgc2VsZi5saXN0ID0gdXNlcmxpc3RzCiAgICAgICAgZm9yIGkgaW4gcmFuZ2UoMCwgbGVuKHNlbGYubGlzdCkpOiBzZWxmLmxpc3RbaV0udXBkYXRlKHsnaW1hZ2UnOiAndXNlcmxpc3RzLnBuZycsICdhY3Rpb24nOiAndHZzaG93cyd9KQogICAgICAgIHNlbGYuYWRkRGlyZWN0b3J5KHNlbGYubGlzdCkKICAgICAgICByZXR1cm4gc2VsZi5saXN0CgoKICAgIGRlZiB0cmFrdF9saXN0KHNlbGYsIHVybCwgdXNlcik6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBkdXBlcyA9IFtdCgogICAgICAgICAgICBxID0gZGljdCh1cmxwYXJzZS5wYXJzZV9xc2wodXJscGFyc2UudXJsc3BsaXQodXJsKS5xdWVyeSkpCiAgICAgICAgICAgIHEudXBkYXRlKHsnZXh0ZW5kZWQnOiAnZnVsbCd9KQogICAgICAgICAgICBxID0gKHVybGxpYi51cmxlbmNvZGUocSkpLnJlcGxhY2UoJyUyQycsICcsJykKICAgICAgICAgICAgdSA9IHVybC5yZXBsYWNlKCc/JyArIHVybHBhcnNlLnVybHBhcnNlKHVybCkucXVlcnksICcnKSArICc/JyArIHEKCiAgICAgICAgICAgIHJlc3VsdCA9IHRyYWt0LmdldFRyYWt0QXNKc29uKHUpCgogICAgICAgICAgICBpdGVtcyA9IFtdCiAgICAgICAgICAgIGZvciBpIGluIHJlc3VsdDoKICAgICAgICAgICAgICAgIHRyeTogaXRlbXMuYXBwZW5kKGlbJ3Nob3cnXSkKICAgICAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICBpZiBsZW4oaXRlbXMpID09IDA6CiAgICAgICAgICAgICAgICBpdGVtcyA9IHJlc3VsdAogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIHRyeToKICAgICAgICAgICAgcSA9IGRpY3QodXJscGFyc2UucGFyc2VfcXNsKHVybHBhcnNlLnVybHNwbGl0KHVybCkucXVlcnkpKQogICAgICAgICAgICBpZiBub3QgaW50KHFbJ2xpbWl0J10pID09IGxlbihpdGVtcyk6IHJhaXNlIEV4Y2VwdGlvbigpCiAgICAgICAgICAgIHEudXBkYXRlKHsncGFnZSc6IHN0cihpbnQocVsncGFnZSddKSArIDEpfSkKICAgICAgICAgICAgcSA9ICh1cmxsaWIudXJsZW5jb2RlKHEpKS5yZXBsYWNlKCclMkMnLCAnLCcpCiAgICAgICAgICAgIG5leHQgPSB1cmwucmVwbGFjZSgnPycgKyB1cmxwYXJzZS51cmxwYXJzZSh1cmwpLnF1ZXJ5LCAnJykgKyAnPycgKyBxCiAgICAgICAgICAgIG5leHQgPSBuZXh0LmVuY29kZSgndXRmLTgnKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgbmV4dCA9ICcnCgogICAgICAgIGZvciBpdGVtIGluIGl0ZW1zOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB0aXRsZSA9IGl0ZW1bJ3RpdGxlJ10KICAgICAgICAgICAgICAgIHRpdGxlID0gcmUuc3ViKCdccyh8WyhdKShVS3xVU3xBVXxcZHs0fSkofFspXSkkJywgJycsIHRpdGxlKQogICAgICAgICAgICAgICAgdGl0bGUgPSBjbGllbnQucmVwbGFjZUhUTUxDb2Rlcyh0aXRsZSkKCiAgICAgICAgICAgICAgICB5ZWFyID0gaXRlbVsneWVhciddCiAgICAgICAgICAgICAgICB5ZWFyID0gcmUuc3ViKCdbXjAtOV0nLCAnJywgc3RyKHllYXIpKQoKICAgICAgICAgICAgICAgIGlmIGludCh5ZWFyKSA+IGludCgoc2VsZi5kYXRldGltZSkuc3RyZnRpbWUoJyVZJykpOiByYWlzZSBFeGNlcHRpb24oKQoKICAgICAgICAgICAgICAgIGltZGIgPSBpdGVtWydpZHMnXVsnaW1kYiddCiAgICAgICAgICAgICAgICBpZiBpbWRiID09IE5vbmUgb3IgaW1kYiA9PSAnJzogaW1kYiA9ICcwJwogICAgICAgICAgICAgICAgZWxzZTogaW1kYiA9ICd0dCcgKyByZS5zdWIoJ1teMC05XScsICcnLCBzdHIoaW1kYikpCgogICAgICAgICAgICAgICAgdHZkYiA9IGl0ZW1bJ2lkcyddWyd0dmRiJ10KICAgICAgICAgICAgICAgIHR2ZGIgPSByZS5zdWIoJ1teMC05XScsICcnLCBzdHIodHZkYikpCgogICAgICAgICAgICAgICAgaWYgdHZkYiA9PSBOb25lIG9yIHR2ZGIgPT0gJycgb3IgdHZkYiBpbiBkdXBlczogcmFpc2UgRXhjZXB0aW9uKCkKICAgICAgICAgICAgICAgIGR1cGVzLmFwcGVuZCh0dmRiKQoKICAgICAgICAgICAgICAgIHRyeTogcHJlbWllcmVkID0gaXRlbVsnZmlyc3RfYWlyZWQnXQogICAgICAgICAgICAgICAgZXhjZXB0OiBwcmVtaWVyZWQgPSAnMCcKICAgICAgICAgICAgICAgIHRyeTogcHJlbWllcmVkID0gcmUuY29tcGlsZSgnKFxkezR9LVxkezJ9LVxkezJ9KScpLmZpbmRhbGwocHJlbWllcmVkKVswXQogICAgICAgICAgICAgICAgZXhjZXB0OiBwcmVtaWVyZWQgPSAnMCcKCiAgICAgICAgICAgICAgICB0cnk6IHN0dWRpbyA9IGl0ZW1bJ25ldHdvcmsnXQogICAgICAgICAgICAgICAgZXhjZXB0OiBzdHVkaW8gPSAnMCcKICAgICAgICAgICAgICAgIGlmIHN0dWRpbyA9PSBOb25lOiBzdHVkaW8gPSAnMCcKCiAgICAgICAgICAgICAgICB0cnk6IGdlbnJlID0gaXRlbVsnZ2VucmVzJ10KICAgICAgICAgICAgICAgIGV4Y2VwdDogZ2VucmUgPSAnMCcKICAgICAgICAgICAgICAgIGdlbnJlID0gW2kudGl0bGUoKSBmb3IgaSBpbiBnZW5yZV0KICAgICAgICAgICAgICAgIGlmIGdlbnJlID09IFtdOiBnZW5yZSA9ICcwJwogICAgICAgICAgICAgICAgZ2VucmUgPSAnIC8gJy5qb2luKGdlbnJlKQoKICAgICAgICAgICAgICAgIHRyeTogZHVyYXRpb24gPSBzdHIoaXRlbVsncnVudGltZSddKQogICAgICAgICAgICAgICAgZXhjZXB0OiBkdXJhdGlvbiA9ICcwJwogICAgICAgICAgICAgICAgaWYgZHVyYXRpb24gPT0gTm9uZTogZHVyYXRpb24gPSAnMCcKCiAgICAgICAgICAgICAgICB0cnk6IHJhdGluZyA9IHN0cihpdGVtWydyYXRpbmcnXSkKICAgICAgICAgICAgICAgIGV4Y2VwdDogcmF0aW5nID0gJzAnCiAgICAgICAgICAgICAgICBpZiByYXRpbmcgPT0gTm9uZSBvciByYXRpbmcgPT0gJzAuMCc6IHJhdGluZyA9ICcwJwoKICAgICAgICAgICAgICAgIHRyeTogdm90ZXMgPSBzdHIoaXRlbVsndm90ZXMnXSkKICAgICAgICAgICAgICAgIGV4Y2VwdDogdm90ZXMgPSAnMCcKICAgICAgICAgICAgICAgIHRyeTogdm90ZXMgPSBzdHIoZm9ybWF0KGludCh2b3RlcyksJyxkJykpCiAgICAgICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICAgICAgICAgIGlmIHZvdGVzID09IE5vbmU6IHZvdGVzID0gJzAnCgogICAgICAgICAgICAgICAgdHJ5OiBtcGFhID0gaXRlbVsnY2VydGlmaWNhdGlvbiddCiAgICAgICAgICAgICAgICBleGNlcHQ6IG1wYWEgPSAnMCcKICAgICAgICAgICAgICAgIGlmIG1wYWEgPT0gTm9uZTogbXBhYSA9ICcwJwoKICAgICAgICAgICAgICAgIHRyeTogcGxvdCA9IGl0ZW1bJ292ZXJ2aWV3J10KICAgICAgICAgICAgICAgIGV4Y2VwdDogcGxvdCA9ICcwJwogICAgICAgICAgICAgICAgaWYgcGxvdCA9PSBOb25lOiBwbG90ID0gJzAnCiAgICAgICAgICAgICAgICBwbG90ID0gY2xpZW50LnJlcGxhY2VIVE1MQ29kZXMocGxvdCkKCiAgICAgICAgICAgICAgICBzZWxmLmxpc3QuYXBwZW5kKHsndGl0bGUnOiB0aXRsZSwgJ29yaWdpbmFsdGl0bGUnOiB0aXRsZSwgJ3llYXInOiB5ZWFyLCAncHJlbWllcmVkJzogcHJlbWllcmVkLCAnc3R1ZGlvJzogc3R1ZGlvLCAnZ2VucmUnOiBnZW5yZSwgJ2R1cmF0aW9uJzogZHVyYXRpb24sICdyYXRpbmcnOiByYXRpbmcsICd2b3Rlcyc6IHZvdGVzLCAnbXBhYSc6IG1wYWEsICdwbG90JzogcGxvdCwgJ2ltZGInOiBpbWRiLCAndHZkYic6IHR2ZGIsICdwb3N0ZXInOiAnMCcsICduZXh0JzogbmV4dH0pCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKCiAgICAgICAgcmV0dXJuIHNlbGYubGlzdAoKCiAgICBkZWYgdHJha3RfdXNlcl9saXN0KHNlbGYsIHVybCwgdXNlcik6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBpdGVtcyA9IHRyYWt0LmdldFRyYWt0QXNKc29uKHVybCkKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHBhc3MKCiAgICAgICAgZm9yIGl0ZW0gaW4gaXRlbXM6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHRyeTogbmFtZSA9IGl0ZW1bJ2xpc3QnXVsnbmFtZSddCiAgICAgICAgICAgICAgICBleGNlcHQ6IG5hbWUgPSBpdGVtWyduYW1lJ10KICAgICAgICAgICAgICAgIG5hbWUgPSBjbGllbnQucmVwbGFjZUhUTUxDb2RlcyhuYW1lKQoKICAgICAgICAgICAgICAgIHRyeTogdXJsID0gKHRyYWt0LnNsdWcoaXRlbVsnbGlzdCddWyd1c2VyJ11bJ3VzZXJuYW1lJ10pLCBpdGVtWydsaXN0J11bJ2lkcyddWydzbHVnJ10pCiAgICAgICAgICAgICAgICBleGNlcHQ6IHVybCA9ICgnbWUnLCBpdGVtWydpZHMnXVsnc2x1ZyddKQogICAgICAgICAgICAgICAgdXJsID0gc2VsZi50cmFrdGxpc3RfbGluayAlIHVybAogICAgICAgICAgICAgICAgdXJsID0gdXJsLmVuY29kZSgndXRmLTgnKQoKICAgICAgICAgICAgICAgIHNlbGYubGlzdC5hcHBlbmQoeyduYW1lJzogbmFtZSwgJ3VybCc6IHVybCwgJ2NvbnRleHQnOiB1cmx9KQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCgogICAgICAgIHNlbGYubGlzdCA9IHNvcnRlZChzZWxmLmxpc3QsIGtleT1sYW1iZGEgazogdXRpbHMudGl0bGVfa2V5KGtbJ25hbWUnXSkpCiAgICAgICAgcmV0dXJuIHNlbGYubGlzdAoKCiAgICBkZWYgaW1kYl9saXN0KHNlbGYsIHVybCk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBkdXBlcyA9IFtdCgogICAgICAgICAgICBmb3IgaSBpbiByZS5maW5kYWxsKCdkYXRlXFsoXGQrKVxdJywgdXJsKToKICAgICAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCdkYXRlWyVzXScgJSBpLCAoc2VsZi5kYXRldGltZSAtIGRhdGV0aW1lLnRpbWVkZWx0YShkYXlzID0gaW50KGkpKSkuc3RyZnRpbWUoJyVZLSVtLSVkJykpCgogICAgICAgICAgICBkZWYgaW1kYl93YXRjaGxpc3RfaWQodXJsKToKICAgICAgICAgICAgICAgIHJldHVybiBjbGllbnQucGFyc2VET00oY2xpZW50LnJlcXVlc3QodXJsKSwgJ21ldGEnLCByZXQ9J2NvbnRlbnQnLCBhdHRycyA9IHsncHJvcGVydHknOiAncGFnZUlkJ30pWzBdCgogICAgICAgICAgICBpZiB1cmwgPT0gc2VsZi5pbWRid2F0Y2hsaXN0X2xpbms6CiAgICAgICAgICAgICAgICB1cmwgPSBjYWNoZS5nZXQoaW1kYl93YXRjaGxpc3RfaWQsIDg2NDAsIHVybCkKICAgICAgICAgICAgICAgIHVybCA9IHNlbGYuaW1kYmxpc3RfbGluayAlIHVybAoKICAgICAgICAgICAgZWxpZiB1cmwgPT0gc2VsZi5pbWRid2F0Y2hsaXN0Ml9saW5rOgogICAgICAgICAgICAgICAgdXJsID0gY2FjaGUuZ2V0KGltZGJfd2F0Y2hsaXN0X2lkLCA4NjQwLCB1cmwpCiAgICAgICAgICAgICAgICB1cmwgPSBzZWxmLmltZGJsaXN0Ml9saW5rICUgdXJsCgogICAgICAgICAgICByZXN1bHQgPSBjbGllbnQucmVxdWVzdCh1cmwpCgogICAgICAgICAgICByZXN1bHQgPSByZXN1bHQucmVwbGFjZSgnXG4nLCAnICcpCgogICAgICAgICAgICBpdGVtcyA9IGNsaWVudC5wYXJzZURPTShyZXN1bHQsICdkaXYnLCBhdHRycyA9IHsnY2xhc3MnOiAnbGlzdGVyLWl0ZW0gLis/J30pCiAgICAgICAgICAgIGl0ZW1zICs9IGNsaWVudC5wYXJzZURPTShyZXN1bHQsICdkaXYnLCBhdHRycyA9IHsnY2xhc3MnOiAnbGlzdF9pdGVtLis/J30pCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgdHJ5OgogICAgICAgICAgICBuZXh0ID0gY2xpZW50LnBhcnNlRE9NKHJlc3VsdCwgJ2EnLCByZXQ9J2hyZWYnLCBhdHRycyA9IHsnY2xhc3MnOiAnLis/aXN0ZXItcGFnZS1uZXguKz8nfSkKCiAgICAgICAgICAgIGlmIGxlbihuZXh0KSA9PSAwOgogICAgICAgICAgICAgICAgbmV4dCA9IGNsaWVudC5wYXJzZURPTShyZXN1bHQsICdkaXYnLCBhdHRycyA9IHsnY2xhc3MnOiAncGFnaW5hdGlvbid9KVswXQogICAgICAgICAgICAgICAgbmV4dCA9IHppcChjbGllbnQucGFyc2VET00obmV4dCwgJ2EnLCByZXQ9J2hyZWYnKSwgY2xpZW50LnBhcnNlRE9NKG5leHQsICdhJykpCiAgICAgICAgICAgICAgICBuZXh0ID0gW2lbMF0gZm9yIGkgaW4gbmV4dCBpZiAnTmV4dCcgaW4gaVsxXV0KCiAgICAgICAgICAgIG5leHQgPSB1cmwucmVwbGFjZSh1cmxwYXJzZS51cmxwYXJzZSh1cmwpLnF1ZXJ5LCB1cmxwYXJzZS51cmxwYXJzZShuZXh0WzBdKS5xdWVyeSkKICAgICAgICAgICAgbmV4dCA9IGNsaWVudC5yZXBsYWNlSFRNTENvZGVzKG5leHQpCiAgICAgICAgICAgIG5leHQgPSBuZXh0LmVuY29kZSgndXRmLTgnKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgbmV4dCA9ICcnCgogICAgICAgIGZvciBpdGVtIGluIGl0ZW1zOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB0aXRsZSA9IGNsaWVudC5wYXJzZURPTShpdGVtLCAnYScpWzFdCiAgICAgICAgICAgICAgICB0aXRsZSA9IGNsaWVudC5yZXBsYWNlSFRNTENvZGVzKHRpdGxlKQogICAgICAgICAgICAgICAgdGl0bGUgPSB0aXRsZS5lbmNvZGUoJ3V0Zi04JykKCiAgICAgICAgICAgICAgICB5ZWFyID0gY2xpZW50LnBhcnNlRE9NKGl0ZW0sICdzcGFuJywgYXR0cnMgPSB7J2NsYXNzJzogJ2xpc3Rlci1pdGVtLXllYXIuKz8nfSkKICAgICAgICAgICAgICAgIHllYXIgKz0gY2xpZW50LnBhcnNlRE9NKGl0ZW0sICdzcGFuJywgYXR0cnMgPSB7J2NsYXNzJzogJ3llYXJfdHlwZSd9KQogICAgICAgICAgICAgICAgeWVhciA9IHJlLmZpbmRhbGwoJyhcZHs0fSknLCB5ZWFyWzBdKVswXQogICAgICAgICAgICAgICAgeWVhciA9IHllYXIuZW5jb2RlKCd1dGYtOCcpCgogICAgICAgICAgICAgICAgaWYgaW50KHllYXIpID4gaW50KChzZWxmLmRhdGV0aW1lKS5zdHJmdGltZSgnJVknKSk6IHJhaXNlIEV4Y2VwdGlvbigpCgogICAgICAgICAgICAgICAgaW1kYiA9IGNsaWVudC5wYXJzZURPTShpdGVtLCAnYScsIHJldD0naHJlZicpWzBdCiAgICAgICAgICAgICAgICBpbWRiID0gcmUuZmluZGFsbCgnKHR0XGQqKScsIGltZGIpWzBdCiAgICAgICAgICAgICAgICBpbWRiID0gaW1kYi5lbmNvZGUoJ3V0Zi04JykKCiAgICAgICAgICAgICAgICBpZiBpbWRiIGluIGR1cGVzOiByYWlzZSBFeGNlcHRpb24oKQogICAgICAgICAgICAgICAgZHVwZXMuYXBwZW5kKGltZGIpCgogICAgICAgICAgICAgICAgdHJ5OiBwb3N0ZXIgPSBjbGllbnQucGFyc2VET00oaXRlbSwgJ2ltZycsIHJldD0nbG9hZGxhdGUnKVswXQogICAgICAgICAgICAgICAgZXhjZXB0OiBwb3N0ZXIgPSAnMCcKICAgICAgICAgICAgICAgIGlmICcvbm9waWN0dXJlLycgaW4gcG9zdGVyOiBwb3N0ZXIgPSAnMCcKICAgICAgICAgICAgICAgIHBvc3RlciA9IHJlLnN1YignKD86X1NYfF9TWXxfVVh8X1VZfF9DUnxfQUwpKD86XGQrfF8pLis/XC4nLCAnX1NYNTAwLicsIHBvc3RlcikKICAgICAgICAgICAgICAgIHBvc3RlciA9IGNsaWVudC5yZXBsYWNlSFRNTENvZGVzKHBvc3RlcikKICAgICAgICAgICAgICAgIHBvc3RlciA9IHBvc3Rlci5lbmNvZGUoJ3V0Zi04JykKCiAgICAgICAgICAgICAgICByYXRpbmcgPSAnMCcKICAgICAgICAgICAgICAgIHRyeTogcmF0aW5nID0gY2xpZW50LnBhcnNlRE9NKGl0ZW0sICdzcGFuJywgYXR0cnMgPSB7J2NsYXNzJzogJ3JhdGluZy1yYXRpbmcnfSlbMF0KICAgICAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICAgICAgdHJ5OiByYXRpbmcgPSBjbGllbnQucGFyc2VET00ocmF0aW5nLCAnc3BhbicsIGF0dHJzID0geydjbGFzcyc6ICd2YWx1ZSd9KVswXQogICAgICAgICAgICAgICAgZXhjZXB0OiByYXRpbmcgPSAnMCcKICAgICAgICAgICAgICAgIHRyeTogcmF0aW5nID0gY2xpZW50LnBhcnNlRE9NKGl0ZW0sICdkaXYnLCByZXQ9J2RhdGEtdmFsdWUnLCBhdHRycyA9IHsnY2xhc3MnOiAnLio/aW1kYi1yYXRpbmcnfSlbMF0KICAgICAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICAgICAgaWYgcmF0aW5nID09ICcnIG9yIHJhdGluZyA9PSAnLSc6IHJhdGluZyA9ICcwJwogICAgICAgICAgICAgICAgcmF0aW5nID0gY2xpZW50LnJlcGxhY2VIVE1MQ29kZXMocmF0aW5nKQogICAgICAgICAgICAgICAgcmF0aW5nID0gcmF0aW5nLmVuY29kZSgndXRmLTgnKQoKICAgICAgICAgICAgICAgIHBsb3QgPSAnMCcKICAgICAgICAgICAgICAgIHRyeTogcGxvdCA9IGNsaWVudC5wYXJzZURPTShpdGVtLCAncCcsIGF0dHJzID0geydjbGFzcyc6ICd0ZXh0LW11dGVkJ30pWzBdCiAgICAgICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICAgICAgICAgIHRyeTogcGxvdCA9IGNsaWVudC5wYXJzZURPTShpdGVtLCAnZGl2JywgYXR0cnMgPSB7J2NsYXNzJzogJ2l0ZW1fZGVzY3JpcHRpb24nfSlbMF0KICAgICAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICAgICAgcGxvdCA9IHBsb3QucnNwbGl0KCc8c3Bhbj4nLCAxKVswXS5zdHJpcCgpCiAgICAgICAgICAgICAgICBwbG90ID0gcmUuc3ViKCc8Lis/Pnw8Ly4rPz4nLCAnJywgcGxvdCkKICAgICAgICAgICAgICAgIGlmIHBsb3QgPT0gJyc6IHBsb3QgPSAnMCcKICAgICAgICAgICAgICAgIHBsb3QgPSBjbGllbnQucmVwbGFjZUhUTUxDb2RlcyhwbG90KQogICAgICAgICAgICAgICAgcGxvdCA9IHBsb3QuZW5jb2RlKCd1dGYtOCcpCgogICAgICAgICAgICAgICAgc2VsZi5saXN0LmFwcGVuZCh7J3RpdGxlJzogdGl0bGUsICdvcmlnaW5hbHRpdGxlJzogdGl0bGUsICd5ZWFyJzogeWVhciwgJ3JhdGluZyc6IHJhdGluZywgJ3Bsb3QnOiBwbG90LCAnaW1kYic6IGltZGIsICd0dmRiJzogJzAnLCAncG9zdGVyJzogcG9zdGVyLCAnbmV4dCc6IG5leHR9KQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCgogICAgICAgIHJldHVybiBzZWxmLmxpc3QKCgogICAgZGVmIGltZGJfcGVyc29uX2xpc3Qoc2VsZiwgdXJsKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3VsdCA9IGNsaWVudC5yZXF1ZXN0KHVybCkKICAgICAgICAgICAgaXRlbXMgPSBjbGllbnQucGFyc2VET00ocmVzdWx0LCAndHInLCBhdHRycyA9IHsnY2xhc3MnOiAnLis/IGRldGFpbGVkJ30pCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgZm9yIGl0ZW0gaW4gaXRlbXM6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIG5hbWUgPSBjbGllbnQucGFyc2VET00oaXRlbSwgJ2EnLCByZXQ9J3RpdGxlJylbMF0KICAgICAgICAgICAgICAgIG5hbWUgPSBjbGllbnQucmVwbGFjZUhUTUxDb2RlcyhuYW1lKQogICAgICAgICAgICAgICAgbmFtZSA9IG5hbWUuZW5jb2RlKCd1dGYtOCcpCgogICAgICAgICAgICAgICAgdXJsID0gY2xpZW50LnBhcnNlRE9NKGl0ZW0sICdhJywgcmV0PSdocmVmJylbMF0KICAgICAgICAgICAgICAgIHVybCA9IHJlLmZpbmRhbGwoJyhubVxkKiknLCB1cmwsIHJlLkkpWzBdCiAgICAgICAgICAgICAgICB1cmwgPSBzZWxmLnBlcnNvbl9saW5rICUgdXJsCiAgICAgICAgICAgICAgICB1cmwgPSBjbGllbnQucmVwbGFjZUhUTUxDb2Rlcyh1cmwpCiAgICAgICAgICAgICAgICB1cmwgPSB1cmwuZW5jb2RlKCd1dGYtOCcpCgogICAgICAgICAgICAgICAgaW1hZ2UgPSBjbGllbnQucGFyc2VET00oaXRlbSwgJ2ltZycsIHJldD0nc3JjJylbMF0KICAgICAgICAgICAgICAgIGlmIG5vdCAoJy5fU1gnIGluIGltYWdlIG9yICcuX1NZJyBpbiBpbWFnZSk6IHJhaXNlIEV4Y2VwdGlvbigpCiAgICAgICAgICAgICAgICBpbWFnZSA9IHJlLnN1YignKD86X1NYfF9TWXxfVVh8X1VZfF9DUnxfQUwpKD86XGQrfF8pLis/XC4nLCAnX1NYNTAwLicsIGltYWdlKQogICAgICAgICAgICAgICAgaW1hZ2UgPSBjbGllbnQucmVwbGFjZUhUTUxDb2RlcyhpbWFnZSkKICAgICAgICAgICAgICAgIGltYWdlID0gaW1hZ2UuZW5jb2RlKCd1dGYtOCcpCgogICAgICAgICAgICAgICAgc2VsZi5saXN0LmFwcGVuZCh7J25hbWUnOiBuYW1lLCAndXJsJzogdXJsLCAnaW1hZ2UnOiBpbWFnZX0pCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKCiAgICAgICAgcmV0dXJuIHNlbGYubGlzdAoKCiAgICBkZWYgaW1kYl91c2VyX2xpc3Qoc2VsZiwgdXJsKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3VsdCA9IGNsaWVudC5yZXF1ZXN0KHVybCkKICAgICAgICAgICAgaXRlbXMgPSBjbGllbnQucGFyc2VET00ocmVzdWx0LCAnbGknLCBhdHRycyA9IHsnY2xhc3MnOiAnaXBsLXplYnJhLWxpc3RfX2l0ZW0gdXNlci1saXN0J30pCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCgogICAgICAgIGZvciBpdGVtIGluIGl0ZW1zOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBuYW1lID0gY2xpZW50LnBhcnNlRE9NKGl0ZW0sICdhJylbMF0KICAgICAgICAgICAgICAgIG5hbWUgPSBjbGllbnQucmVwbGFjZUhUTUxDb2RlcyhuYW1lKQogICAgICAgICAgICAgICAgbmFtZSA9IG5hbWUuZW5jb2RlKCd1dGYtOCcpCgogICAgICAgICAgICAgICAgdXJsID0gY2xpZW50LnBhcnNlRE9NKGl0ZW0sICdhJywgcmV0PSdocmVmJylbMF0KICAgICAgICAgICAgICAgIHVybCA9IHVybCA9IHVybC5zcGxpdCgnL2xpc3QvJywgMSlbLTFdLnN0cmlwKCcvJykKICAgICAgICAgICAgICAgIHVybCA9IHNlbGYuaW1kYmxpc3RfbGluayAlIHVybAogICAgICAgICAgICAgICAgdXJsID0gY2xpZW50LnJlcGxhY2VIVE1MQ29kZXModXJsKQogICAgICAgICAgICAgICAgdXJsID0gdXJsLmVuY29kZSgndXRmLTgnKQoKICAgICAgICAgICAgICAgIHNlbGYubGlzdC5hcHBlbmQoeyduYW1lJzogbmFtZSwgJ3VybCc6IHVybCwgJ2NvbnRleHQnOiB1cmx9KQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCgogICAgICAgIHNlbGYubGlzdCA9IHNvcnRlZChzZWxmLmxpc3QsIGtleT1sYW1iZGEgazogdXRpbHMudGl0bGVfa2V5KGtbJ25hbWUnXSkpCiAgICAgICAgcmV0dXJuIHNlbGYubGlzdAoKCiAgICBkZWYgdHZtYXplX2xpc3Qoc2VsZiwgdXJsKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3VsdCA9IGNsaWVudC5yZXF1ZXN0KHVybCkKICAgICAgICAgICAgcmVzdWx0ID0gY2xpZW50LnBhcnNlRE9NKHJlc3VsdCwgJ3NlY3Rpb24nLCBhdHRycyA9IHsnaWQnOiAndGhpcy1zZWFzb25zLXNob3dzJ30pCgogICAgICAgICAgICBpdGVtcyA9IGNsaWVudC5wYXJzZURPTShyZXN1bHQsICdkaXYnLCBhdHRycyA9IHsnY2xhc3MnOiAnY29udGVudCBhdXRvIGNlbGwnfSkKICAgICAgICAgICAgaXRlbXMgPSBbY2xpZW50LnBhcnNlRE9NKGksICdhJywgcmV0PSdocmVmJykgZm9yIGkgaW4gaXRlbXNdCiAgICAgICAgICAgIGl0ZW1zID0gW2lbMF0gZm9yIGkgaW4gaXRlbXMgaWYgbGVuKGkpID4gMF0KICAgICAgICAgICAgaXRlbXMgPSBbcmUuZmluZGFsbCgnLyhcZCspLycsIGkpIGZvciBpIGluIGl0ZW1zXQogICAgICAgICAgICBpdGVtcyA9IFtpWzBdIGZvciBpIGluIGl0ZW1zIGlmIGxlbihpKSA+IDBdCiAgICAgICAgICAgIGl0ZW1zID0gaXRlbXNbOjUwXQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIGRlZiBpdGVtc19saXN0KGkpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB1cmwgPSBzZWxmLnR2bWF6ZV9pbmZvX2xpbmsgJSBpCgogICAgICAgICAgICAgICAgaXRlbSA9IGNsaWVudC5yZXF1ZXN0KHVybCkKICAgICAgICAgICAgICAgIGl0ZW0gPSBqc29uLmxvYWRzKGl0ZW0pCgogICAgICAgICAgICAgICAgdGl0bGUgPSBpdGVtWyduYW1lJ10KICAgICAgICAgICAgICAgIHRpdGxlID0gcmUuc3ViKCdccyh8WyhdKShVS3xVU3xBVXxcZHs0fSkofFspXSkkJywgJycsIHRpdGxlKQogICAgICAgICAgICAgICAgdGl0bGUgPSBjbGllbnQucmVwbGFjZUhUTUxDb2Rlcyh0aXRsZSkKICAgICAgICAgICAgICAgIHRpdGxlID0gdGl0bGUuZW5jb2RlKCd1dGYtOCcpCgogICAgICAgICAgICAgICAgeWVhciA9IGl0ZW1bJ3ByZW1pZXJlZCddCiAgICAgICAgICAgICAgICB5ZWFyID0gcmUuZmluZGFsbCgnKFxkezR9KScsIHllYXIpWzBdCiAgICAgICAgICAgICAgICB5ZWFyID0geWVhci5lbmNvZGUoJ3V0Zi04JykKCiAgICAgICAgICAgICAgICBpZiBpbnQoeWVhcikgPiBpbnQoKHNlbGYuZGF0ZXRpbWUpLnN0cmZ0aW1lKCclWScpKTogcmFpc2UgRXhjZXB0aW9uKCkKCiAgICAgICAgICAgICAgICBpbWRiID0gaXRlbVsnZXh0ZXJuYWxzJ11bJ2ltZGInXQogICAgICAgICAgICAgICAgaWYgaW1kYiA9PSBOb25lIG9yIGltZGIgPT0gJyc6IGltZGIgPSAnMCcKICAgICAgICAgICAgICAgIGVsc2U6IGltZGIgPSAndHQnICsgcmUuc3ViKCdbXjAtOV0nLCAnJywgc3RyKGltZGIpKQogICAgICAgICAgICAgICAgaW1kYiA9IGltZGIuZW5jb2RlKCd1dGYtOCcpCgogICAgICAgICAgICAgICAgdHZkYiA9IGl0ZW1bJ2V4dGVybmFscyddWyd0aGV0dmRiJ10KICAgICAgICAgICAgICAgIHR2ZGIgPSByZS5zdWIoJ1teMC05XScsICcnLCBzdHIodHZkYikpCiAgICAgICAgICAgICAgICB0dmRiID0gdHZkYi5lbmNvZGUoJ3V0Zi04JykKCiAgICAgICAgICAgICAgICBpZiB0dmRiID09IE5vbmUgb3IgdHZkYiA9PSAnJzogcmFpc2UgRXhjZXB0aW9uKCkKCiAgICAgICAgICAgICAgICB0cnk6IHBvc3RlciA9IGl0ZW1bJ2ltYWdlJ11bJ29yaWdpbmFsJ10KICAgICAgICAgICAgICAgIGV4Y2VwdDogcG9zdGVyID0gJzAnCiAgICAgICAgICAgICAgICBpZiBwb3N0ZXIgPT0gTm9uZSBvciBwb3N0ZXIgPT0gJyc6IHBvc3RlciA9ICcwJwogICAgICAgICAgICAgICAgcG9zdGVyID0gcG9zdGVyLmVuY29kZSgndXRmLTgnKQoKICAgICAgICAgICAgICAgIHByZW1pZXJlZCA9IGl0ZW1bJ3ByZW1pZXJlZCddCiAgICAgICAgICAgICAgICB0cnk6IHByZW1pZXJlZCA9IHJlLmZpbmRhbGwoJyhcZHs0fS1cZHsyfS1cZHsyfSknLCBwcmVtaWVyZWQpWzBdCiAgICAgICAgICAgICAgICBleGNlcHQ6IHByZW1pZXJlZCA9ICcwJwogICAgICAgICAgICAgICAgcHJlbWllcmVkID0gcHJlbWllcmVkLmVuY29kZSgndXRmLTgnKQoKICAgICAgICAgICAgICAgIHRyeTogc3R1ZGlvID0gaXRlbVsnbmV0d29yayddWyduYW1lJ10KICAgICAgICAgICAgICAgIGV4Y2VwdDogc3R1ZGlvID0gJzAnCiAgICAgICAgICAgICAgICBpZiBzdHVkaW8gPT0gTm9uZTogc3R1ZGlvID0gJzAnCiAgICAgICAgICAgICAgICBzdHVkaW8gPSBzdHVkaW8uZW5jb2RlKCd1dGYtOCcpCgogICAgICAgICAgICAgICAgdHJ5OiBnZW5yZSA9IGl0ZW1bJ2dlbnJlcyddCiAgICAgICAgICAgICAgICBleGNlcHQ6IGdlbnJlID0gJzAnCiAgICAgICAgICAgICAgICBnZW5yZSA9IFtpLnRpdGxlKCkgZm9yIGkgaW4gZ2VucmVdCiAgICAgICAgICAgICAgICBpZiBnZW5yZSA9PSBbXTogZ2VucmUgPSAnMCcKICAgICAgICAgICAgICAgIGdlbnJlID0gJyAvICcuam9pbihnZW5yZSkKICAgICAgICAgICAgICAgIGdlbnJlID0gZ2VucmUuZW5jb2RlKCd1dGYtOCcpCgogICAgICAgICAgICAgICAgdHJ5OiBkdXJhdGlvbiA9IGl0ZW1bJ3J1bnRpbWUnXQogICAgICAgICAgICAgICAgZXhjZXB0OiBkdXJhdGlvbiA9ICcwJwogICAgICAgICAgICAgICAgaWYgZHVyYXRpb24gPT0gTm9uZTogZHVyYXRpb24gPSAnMCcKICAgICAgICAgICAgICAgIGR1cmF0aW9uID0gc3RyKGR1cmF0aW9uKQogICAgICAgICAgICAgICAgZHVyYXRpb24gPSBkdXJhdGlvbi5lbmNvZGUoJ3V0Zi04JykKCiAgICAgICAgICAgICAgICB0cnk6IHJhdGluZyA9IGl0ZW1bJ3JhdGluZyddWydhdmVyYWdlJ10KICAgICAgICAgICAgICAgIGV4Y2VwdDogcmF0aW5nID0gJzAnCiAgICAgICAgICAgICAgICBpZiByYXRpbmcgPT0gTm9uZSBvciByYXRpbmcgPT0gJzAuMCc6IHJhdGluZyA9ICcwJwogICAgICAgICAgICAgICAgcmF0aW5nID0gc3RyKHJhdGluZykKICAgICAgICAgICAgICAgIHJhdGluZyA9IHJhdGluZy5lbmNvZGUoJ3V0Zi04JykKCiAgICAgICAgICAgICAgICB0cnk6IHBsb3QgPSBpdGVtWydzdW1tYXJ5J10KICAgICAgICAgICAgICAgIGV4Y2VwdDogcGxvdCA9ICcwJwogICAgICAgICAgICAgICAgaWYgcGxvdCA9PSBOb25lOiBwbG90ID0gJzAnCiAgICAgICAgICAgICAgICBwbG90ID0gcmUuc3ViKCc8Lis/Pnw8Ly4rPz58XG4nLCAnJywgcGxvdCkKICAgICAgICAgICAgICAgIHBsb3QgPSBjbGllbnQucmVwbGFjZUhUTUxDb2RlcyhwbG90KQogICAgICAgICAgICAgICAgcGxvdCA9IHBsb3QuZW5jb2RlKCd1dGYtOCcpCgogICAgICAgICAgICAgICAgdHJ5OiBjb250ZW50ID0gaXRlbVsndHlwZSddLmxvd2VyKCkKICAgICAgICAgICAgICAgIGV4Y2VwdDogY29udGVudCA9ICcwJwogICAgICAgICAgICAgICAgaWYgY29udGVudCA9PSBOb25lIG9yIGNvbnRlbnQgPT0gJyc6IGNvbnRlbnQgPSAnMCcKICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBjb250ZW50LmVuY29kZSgndXRmLTgnKQoKICAgICAgICAgICAgICAgIHNlbGYubGlzdC5hcHBlbmQoeyd0aXRsZSc6IHRpdGxlLCAnb3JpZ2luYWx0aXRsZSc6IHRpdGxlLCAneWVhcic6IHllYXIsICdwcmVtaWVyZWQnOiBwcmVtaWVyZWQsICdzdHVkaW8nOiBzdHVkaW8sICdnZW5yZSc6IGdlbnJlLCAnZHVyYXRpb24nOiBkdXJhdGlvbiwgJ3JhdGluZyc6IHJhdGluZywgJ3Bsb3QnOiBwbG90LCAnaW1kYic6IGltZGIsICd0dmRiJzogdHZkYiwgJ3Bvc3Rlcic6IHBvc3RlciwgJ2NvbnRlbnQnOiBjb250ZW50fSkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwoKICAgICAgICB0cnk6CiAgICAgICAgICAgIHRocmVhZHMgPSBbXQogICAgICAgICAgICBmb3IgaSBpbiBpdGVtczogdGhyZWFkcy5hcHBlbmQod29ya2Vycy5UaHJlYWQoaXRlbXNfbGlzdCwgaSkpCiAgICAgICAgICAgIFtpLnN0YXJ0KCkgZm9yIGkgaW4gdGhyZWFkc10KICAgICAgICAgICAgW2kuam9pbigpIGZvciBpIGluIHRocmVhZHNdCgogICAgICAgICAgICBmaWx0ZXIgPSBbaSBmb3IgaSBpbiBzZWxmLmxpc3QgaWYgaVsnY29udGVudCddID09ICdzY3JpcHRlZCddCiAgICAgICAgICAgIGZpbHRlciArPSBbaSBmb3IgaSBpbiBzZWxmLmxpc3QgaWYgbm90IGlbJ2NvbnRlbnQnXSA9PSAnc2NyaXB0ZWQnXQogICAgICAgICAgICBzZWxmLmxpc3QgPSBmaWx0ZXIKCiAgICAgICAgICAgIHJldHVybiBzZWxmLmxpc3QKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHJldHVybgoKCiAgICBkZWYgd29ya2VyKHNlbGYsIGxldmVsPTEpOgogICAgICAgIHNlbGYubWV0YSA9IFtdCiAgICAgICAgdG90YWwgPSBsZW4oc2VsZi5saXN0KQoKICAgICAgICBzZWxmLmZhbmFydF90dl9oZWFkZXJzID0geydhcGkta2V5JzogJ1pEWTVOVFJrWVRrMll6ZzRPREZsTXpkalkyUmtNbVF5TlRsbVlqazFNelE9Jy5kZWNvZGUoJ2Jhc2U2NCcpfQogICAgICAgIGlmIG5vdCBzZWxmLmZhbmFydF90dl91c2VyID09ICcnOgogICAgICAgICAgICBzZWxmLmZhbmFydF90dl9oZWFkZXJzLnVwZGF0ZSh7J2NsaWVudC1rZXknOiBzZWxmLmZhbmFydF90dl91c2VyfSkKCiAgICAgICAgZm9yIGkgaW4gcmFuZ2UoMCwgdG90YWwpOiBzZWxmLmxpc3RbaV0udXBkYXRlKHsnbWV0YWNhY2hlJzogRmFsc2V9KQoKICAgICAgICBzZWxmLmxpc3QgPSBtZXRhY2FjaGUuZmV0Y2goc2VsZi5saXN0LCBzZWxmLmxhbmcsIHNlbGYudXNlcikKCiAgICAgICAgZm9yIHIgaW4gcmFuZ2UoMCwgdG90YWwsIDQwKToKICAgICAgICAgICAgdGhyZWFkcyA9IFtdCiAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKHIsIHIrNDApOgogICAgICAgICAgICAgICAgaWYgaSA8PSB0b3RhbDogdGhyZWFkcy5hcHBlbmQod29ya2Vycy5UaHJlYWQoc2VsZi5zdXBlcl9pbmZvLCBpKSkKICAgICAgICAgICAgW2kuc3RhcnQoKSBmb3IgaSBpbiB0aHJlYWRzXQogICAgICAgICAgICBbaS5qb2luKCkgZm9yIGkgaW4gdGhyZWFkc10KCiAgICAgICAgICAgIGlmIHNlbGYubWV0YTogbWV0YWNhY2hlLmluc2VydChzZWxmLm1ldGEpCgogICAgICAgIHNlbGYubGlzdCA9IFtpIGZvciBpIGluIHNlbGYubGlzdCBpZiBub3QgaVsndHZkYiddID09ICcwJ10KCiAgICAgICAgaWYgc2VsZi5mYW5hcnRfdHZfdXNlciA9PSAnJzoKICAgICAgICAgICAgZm9yIGkgaW4gc2VsZi5saXN0OiBpLnVwZGF0ZSh7J2NsZWFybG9nbyc6ICcwJywgJ2NsZWFyYXJ0JzogJzAnfSkKCgogICAgZGVmIHN1cGVyX2luZm8oc2VsZiwgaSk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBzZWxmLmxpc3RbaV1bJ21ldGFjYWNoZSddID09IFRydWU6IHJhaXNlIEV4Y2VwdGlvbigpCgogICAgICAgICAgICBpbWRiID0gc2VsZi5saXN0W2ldWydpbWRiJ10gaWYgJ2ltZGInIGluIHNlbGYubGlzdFtpXSBlbHNlICcwJwogICAgICAgICAgICB0dmRiID0gc2VsZi5saXN0W2ldWyd0dmRiJ10gaWYgJ3R2ZGInIGluIHNlbGYubGlzdFtpXSBlbHNlICcwJwoKICAgICAgICAgICAgaWYgaW1kYiA9PSAnMCc6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgaW1kYiA9IHRyYWt0LlNlYXJjaFRWU2hvdyh1cmxsaWIucXVvdGVfcGx1cyhzZWxmLmxpc3RbaV1bJ3RpdGxlJ10pLCBzZWxmLmxpc3RbaV1bJ3llYXInXSwgZnVsbD1GYWxzZSlbMF0KICAgICAgICAgICAgICAgICAgICBpbWRiID0gaW1kYi5nZXQoJ3Nob3cnLCAnMCcpCiAgICAgICAgICAgICAgICAgICAgaW1kYiA9IGltZGIuZ2V0KCdpZHMnLCB7fSkuZ2V0KCdpbWRiJywgJzAnKQogICAgICAgICAgICAgICAgICAgIGltZGIgPSAndHQnICsgcmUuc3ViKCdbXjAtOV0nLCAnJywgc3RyKGltZGIpKQoKICAgICAgICAgICAgICAgICAgICBpZiBub3QgaW1kYjogaW1kYiA9ICcwJwogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIGltZGIgPSAnMCcKCiAgICAgICAgICAgIGlmIHR2ZGIgPT0gJzAnIGFuZCBub3QgaW1kYiA9PSAnMCc6CiAgICAgICAgICAgICAgICB1cmwgPSBzZWxmLnR2ZGJfYnlfaW1kYiAlIGltZGIKCiAgICAgICAgICAgICAgICByZXN1bHQgPSBjbGllbnQucmVxdWVzdCh1cmwsIHRpbWVvdXQ9JzEwJykKCiAgICAgICAgICAgICAgICB0cnk6IHR2ZGIgPSBjbGllbnQucGFyc2VET00ocmVzdWx0LCAnc2VyaWVzaWQnKVswXQogICAgICAgICAgICAgICAgZXhjZXB0OiB0dmRiID0gJzAnCgogICAgICAgICAgICAgICAgdHJ5OiBuYW1lID0gY2xpZW50LnBhcnNlRE9NKHJlc3VsdCwgJ1Nlcmllc05hbWUnKVswXQogICAgICAgICAgICAgICAgZXhjZXB0OiBuYW1lID0gJzAnCiAgICAgICAgICAgICAgICBkdXBlID0gcmUuZmluZGFsbCgnWyoqKl1EdXBsaWNhdGUgKFxkKilbKioqXScsIG5hbWUpCiAgICAgICAgICAgICAgICBpZiBkdXBlOiB0dmRiID0gc3RyKGR1cGVbMF0pCgogICAgICAgICAgICAgICAgaWYgdHZkYiA9PSAnJzogdHZkYiA9ICcwJwoKCiAgICAgICAgICAgIGlmIHR2ZGIgPT0gJzAnOgogICAgICAgICAgICAgICAgdXJsID0gc2VsZi50dmRiX2J5X3F1ZXJ5ICUgKHVybGxpYi5xdW90ZV9wbHVzKHNlbGYubGlzdFtpXVsndGl0bGUnXSkpCgogICAgICAgICAgICAgICAgeWVhcnMgPSBbc3RyKHNlbGYubGlzdFtpXVsneWVhciddKSwgc3RyKGludChzZWxmLmxpc3RbaV1bJ3llYXInXSkrMSksIHN0cihpbnQoc2VsZi5saXN0W2ldWyd5ZWFyJ10pLTEpXQoKICAgICAgICAgICAgICAgIHR2ZGIgPSBjbGllbnQucmVxdWVzdCh1cmwsIHRpbWVvdXQ9JzEwJykKICAgICAgICAgICAgICAgIHR2ZGIgPSByZS5zdWIocidbXlx4MDAtXHg3Rl0rJywgJycsIHR2ZGIpCiAgICAgICAgICAgICAgICB0dmRiID0gY2xpZW50LnJlcGxhY2VIVE1MQ29kZXModHZkYikKICAgICAgICAgICAgICAgIHR2ZGIgPSBjbGllbnQucGFyc2VET00odHZkYiwgJ1NlcmllcycpCiAgICAgICAgICAgICAgICB0dmRiID0gWyh4LCBjbGllbnQucGFyc2VET00oeCwgJ1Nlcmllc05hbWUnKSwgY2xpZW50LnBhcnNlRE9NKHgsICdGaXJzdEFpcmVkJykpIGZvciB4IGluIHR2ZGJdCiAgICAgICAgICAgICAgICB0dmRiID0gWyh4LCB4WzFdWzBdLCB4WzJdWzBdKSBmb3IgeCBpbiB0dmRiIGlmIGxlbih4WzFdKSA+IDAgYW5kIGxlbih4WzJdKSA+IDBdCiAgICAgICAgICAgICAgICB0dmRiID0gW3ggZm9yIHggaW4gdHZkYiBpZiBjbGVhbnRpdGxlLmdldChzZWxmLmxpc3RbaV1bJ3RpdGxlJ10pID09IGNsZWFudGl0bGUuZ2V0KHhbMV0pXQogICAgICAgICAgICAgICAgdHZkYiA9IFt4WzBdWzBdIGZvciB4IGluIHR2ZGIgaWYgYW55KHkgaW4geFsyXSBmb3IgeSBpbiB5ZWFycyldWzBdCiAgICAgICAgICAgICAgICB0dmRiID0gY2xpZW50LnBhcnNlRE9NKHR2ZGIsICdzZXJpZXNpZCcpWzBdCgogICAgICAgICAgICAgICAgaWYgdHZkYiA9PSAnJzogdHZkYiA9ICcwJwoKCiAgICAgICAgICAgIHVybCA9IHNlbGYudHZkYl9pbmZvX2xpbmsgJSB0dmRiCiAgICAgICAgICAgIGl0ZW0gPSBjbGllbnQucmVxdWVzdCh1cmwsIHRpbWVvdXQ9JzEwJykKICAgICAgICAgICAgaWYgaXRlbSA9PSBOb25lOiByYWlzZSBFeGNlcHRpb24oKQoKICAgICAgICAgICAgaWYgaW1kYiA9PSAnMCc6CiAgICAgICAgICAgICAgICB0cnk6IGltZGIgPSBjbGllbnQucGFyc2VET00oaXRlbSwgJ0lNREJfSUQnKVswXQogICAgICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgICAgICAgICBpZiBpbWRiID09ICcnOiBpbWRiID0gJzAnCiAgICAgICAgICAgICAgICBpbWRiID0gaW1kYi5lbmNvZGUoJ3V0Zi04JykKCgogICAgICAgICAgICB0cnk6IHRpdGxlID0gY2xpZW50LnBhcnNlRE9NKGl0ZW0sICdTZXJpZXNOYW1lJylbMF0KICAgICAgICAgICAgZXhjZXB0OiB0aXRsZSA9ICcnCiAgICAgICAgICAgIGlmIHRpdGxlID09ICcnOiB0aXRsZSA9ICcwJwogICAgICAgICAgICB0aXRsZSA9IGNsaWVudC5yZXBsYWNlSFRNTENvZGVzKHRpdGxlKQogICAgICAgICAgICB0aXRsZSA9IHRpdGxlLmVuY29kZSgndXRmLTgnKQoKICAgICAgICAgICAgdHJ5OiB5ZWFyID0gY2xpZW50LnBhcnNlRE9NKGl0ZW0sICdGaXJzdEFpcmVkJylbMF0KICAgICAgICAgICAgZXhjZXB0OiB5ZWFyID0gJycKICAgICAgICAgICAgdHJ5OiB5ZWFyID0gcmUuY29tcGlsZSgnKFxkezR9KScpLmZpbmRhbGwoeWVhcilbMF0KICAgICAgICAgICAgZXhjZXB0OiB5ZWFyID0gJycKICAgICAgICAgICAgaWYgeWVhciA9PSAnJzogeWVhciA9ICcwJwogICAgICAgICAgICB5ZWFyID0geWVhci5lbmNvZGUoJ3V0Zi04JykKCiAgICAgICAgICAgIHRyeTogcHJlbWllcmVkID0gY2xpZW50LnBhcnNlRE9NKGl0ZW0sICdGaXJzdEFpcmVkJylbMF0KICAgICAgICAgICAgZXhjZXB0OiBwcmVtaWVyZWQgPSAnMCcKICAgICAgICAgICAgaWYgcHJlbWllcmVkID09ICcnOiBwcmVtaWVyZWQgPSAnMCcKICAgICAgICAgICAgcHJlbWllcmVkID0gY2xpZW50LnJlcGxhY2VIVE1MQ29kZXMocHJlbWllcmVkKQogICAgICAgICAgICBwcmVtaWVyZWQgPSBwcmVtaWVyZWQuZW5jb2RlKCd1dGYtOCcpCgogICAgICAgICAgICB0cnk6IHN0dWRpbyA9IGNsaWVudC5wYXJzZURPTShpdGVtLCAnTmV0d29yaycpWzBdCiAgICAgICAgICAgIGV4Y2VwdDogc3R1ZGlvID0gJycKICAgICAgICAgICAgaWYgc3R1ZGlvID09ICcnOiBzdHVkaW8gPSAnMCcKICAgICAgICAgICAgc3R1ZGlvID0gY2xpZW50LnJlcGxhY2VIVE1MQ29kZXMoc3R1ZGlvKQogICAgICAgICAgICBzdHVkaW8gPSBzdHVkaW8uZW5jb2RlKCd1dGYtOCcpCgogICAgICAgICAgICB0cnk6IGdlbnJlID0gY2xpZW50LnBhcnNlRE9NKGl0ZW0sICdHZW5yZScpWzBdCiAgICAgICAgICAgIGV4Y2VwdDogZ2VucmUgPSAnJwogICAgICAgICAgICBnZW5yZSA9IFt4IGZvciB4IGluIGdlbnJlLnNwbGl0KCd8JykgaWYgbm90IHggPT0gJyddCiAgICAgICAgICAgIGdlbnJlID0gJyAvICcuam9pbihnZW5yZSkKICAgICAgICAgICAgaWYgZ2VucmUgPT0gJyc6IGdlbnJlID0gJzAnCiAgICAgICAgICAgIGdlbnJlID0gY2xpZW50LnJlcGxhY2VIVE1MQ29kZXMoZ2VucmUpCiAgICAgICAgICAgIGdlbnJlID0gZ2VucmUuZW5jb2RlKCd1dGYtOCcpCgogICAgICAgICAgICB0cnk6IGR1cmF0aW9uID0gY2xpZW50LnBhcnNlRE9NKGl0ZW0sICdSdW50aW1lJylbMF0KICAgICAgICAgICAgZXhjZXB0OiBkdXJhdGlvbiA9ICcnCiAgICAgICAgICAgIGlmIGR1cmF0aW9uID09ICcnOiBkdXJhdGlvbiA9ICcwJwogICAgICAgICAgICBkdXJhdGlvbiA9IGNsaWVudC5yZXBsYWNlSFRNTENvZGVzKGR1cmF0aW9uKQogICAgICAgICAgICBkdXJhdGlvbiA9IGR1cmF0aW9uLmVuY29kZSgndXRmLTgnKQoKICAgICAgICAgICAgdHJ5OiByYXRpbmcgPSBjbGllbnQucGFyc2VET00oaXRlbSwgJ1JhdGluZycpWzBdCiAgICAgICAgICAgIGV4Y2VwdDogcmF0aW5nID0gJycKICAgICAgICAgICAgaWYgJ3JhdGluZycgaW4gc2VsZi5saXN0W2ldIGFuZCBub3Qgc2VsZi5saXN0W2ldWydyYXRpbmcnXSA9PSAnMCc6CiAgICAgICAgICAgICAgICByYXRpbmcgPSBzZWxmLmxpc3RbaV1bJ3JhdGluZyddCiAgICAgICAgICAgIGlmIHJhdGluZyA9PSAnJzogcmF0aW5nID0gJzAnCiAgICAgICAgICAgIHJhdGluZyA9IGNsaWVudC5yZXBsYWNlSFRNTENvZGVzKHJhdGluZykKICAgICAgICAgICAgcmF0aW5nID0gcmF0aW5nLmVuY29kZSgndXRmLTgnKQoKICAgICAgICAgICAgdHJ5OiB2b3RlcyA9IGNsaWVudC5wYXJzZURPTShpdGVtLCAnUmF0aW5nQ291bnQnKVswXQogICAgICAgICAgICBleGNlcHQ6IHZvdGVzID0gJycKICAgICAgICAgICAgaWYgJ3ZvdGVzJyBpbiBzZWxmLmxpc3RbaV0gYW5kIG5vdCBzZWxmLmxpc3RbaV1bJ3ZvdGVzJ10gPT0gJzAnOgogICAgICAgICAgICAgICAgdm90ZXMgPSBzZWxmLmxpc3RbaV1bJ3ZvdGVzJ10KICAgICAgICAgICAgaWYgdm90ZXMgPT0gJyc6IHZvdGVzID0gJzAnCiAgICAgICAgICAgIHZvdGVzID0gY2xpZW50LnJlcGxhY2VIVE1MQ29kZXModm90ZXMpCiAgICAgICAgICAgIHZvdGVzID0gdm90ZXMuZW5jb2RlKCd1dGYtOCcpCgogICAgICAgICAgICB0cnk6IG1wYWEgPSBjbGllbnQucGFyc2VET00oaXRlbSwgJ0NvbnRlbnRSYXRpbmcnKVswXQogICAgICAgICAgICBleGNlcHQ6IG1wYWEgPSAnJwogICAgICAgICAgICBpZiBtcGFhID09ICcnOiBtcGFhID0gJzAnCiAgICAgICAgICAgIG1wYWEgPSBjbGllbnQucmVwbGFjZUhUTUxDb2RlcyhtcGFhKQogICAgICAgICAgICBtcGFhID0gbXBhYS5lbmNvZGUoJ3V0Zi04JykKCiAgICAgICAgICAgIHRyeTogY2FzdCA9IGNsaWVudC5wYXJzZURPTShpdGVtLCAnQWN0b3JzJylbMF0KICAgICAgICAgICAgZXhjZXB0OiBjYXN0ID0gJycKICAgICAgICAgICAgY2FzdCA9IFt4IGZvciB4IGluIGNhc3Quc3BsaXQoJ3wnKSBpZiBub3QgeCA9PSAnJ10KICAgICAgICAgICAgdHJ5OiBjYXN0ID0gWyh4LmVuY29kZSgndXRmLTgnKSwgJycpIGZvciB4IGluIGNhc3RdCiAgICAgICAgICAgIGV4Y2VwdDogY2FzdCA9IFtdCiAgICAgICAgICAgIGlmIGNhc3QgPT0gW106IGNhc3QgPSAnMCcKCiAgICAgICAgICAgIHRyeTogcGxvdCA9IGNsaWVudC5wYXJzZURPTShpdGVtLCAnT3ZlcnZpZXcnKVswXQogICAgICAgICAgICBleGNlcHQ6IHBsb3QgPSAnJwogICAgICAgICAgICBpZiBwbG90ID09ICcnOiBwbG90ID0gJzAnCiAgICAgICAgICAgIHBsb3QgPSBjbGllbnQucmVwbGFjZUhUTUxDb2RlcyhwbG90KQogICAgICAgICAgICBwbG90ID0gcGxvdC5lbmNvZGUoJ3V0Zi04JykKCiAgICAgICAgICAgIHRyeTogcG9zdGVyID0gY2xpZW50LnBhcnNlRE9NKGl0ZW0sICdwb3N0ZXInKVswXQogICAgICAgICAgICBleGNlcHQ6IHBvc3RlciA9ICcnCiAgICAgICAgICAgIGlmIG5vdCBwb3N0ZXIgPT0gJyc6IHBvc3RlciA9IHNlbGYudHZkYl9pbWFnZSArIHBvc3RlcgogICAgICAgICAgICBlbHNlOiBwb3N0ZXIgPSAnMCcKICAgICAgICAgICAgaWYgJ3Bvc3RlcicgaW4gc2VsZi5saXN0W2ldIGFuZCBwb3N0ZXIgPT0gJzAnOiBwb3N0ZXIgPSBzZWxmLmxpc3RbaV1bJ3Bvc3RlciddCiAgICAgICAgICAgIHBvc3RlciA9IGNsaWVudC5yZXBsYWNlSFRNTENvZGVzKHBvc3RlcikKICAgICAgICAgICAgcG9zdGVyID0gcG9zdGVyLmVuY29kZSgndXRmLTgnKQoKICAgICAgICAgICAgdHJ5OiBiYW5uZXIgPSBjbGllbnQucGFyc2VET00oaXRlbSwgJ2Jhbm5lcicpWzBdCiAgICAgICAgICAgIGV4Y2VwdDogYmFubmVyID0gJycKICAgICAgICAgICAgaWYgbm90IGJhbm5lciA9PSAnJzogYmFubmVyID0gc2VsZi50dmRiX2ltYWdlICsgYmFubmVyCiAgICAgICAgICAgIGVsc2U6IGJhbm5lciA9ICcwJwogICAgICAgICAgICBiYW5uZXIgPSBjbGllbnQucmVwbGFjZUhUTUxDb2RlcyhiYW5uZXIpCiAgICAgICAgICAgIGJhbm5lciA9IGJhbm5lci5lbmNvZGUoJ3V0Zi04JykKCiAgICAgICAgICAgIHRyeTogZmFuYXJ0ID0gY2xpZW50LnBhcnNlRE9NKGl0ZW0sICdmYW5hcnQnKVswXQogICAgICAgICAgICBleGNlcHQ6IGZhbmFydCA9ICcnCiAgICAgICAgICAgIGlmIG5vdCBmYW5hcnQgPT0gJyc6IGZhbmFydCA9IHNlbGYudHZkYl9pbWFnZSArIGZhbmFydAogICAgICAgICAgICBlbHNlOiBmYW5hcnQgPSAnMCcKICAgICAgICAgICAgZmFuYXJ0ID0gY2xpZW50LnJlcGxhY2VIVE1MQ29kZXMoZmFuYXJ0KQogICAgICAgICAgICBmYW5hcnQgPSBmYW5hcnQuZW5jb2RlKCd1dGYtOCcpCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBhcnRtZXRhID0gVHJ1ZQogICAgICAgICAgICAgICAgI2lmIHNlbGYuZmFuYXJ0X3R2X3VzZXIgPT0gJyc6IHJhaXNlIEV4Y2VwdGlvbigpCiAgICAgICAgICAgICAgICBhcnQgPSBjbGllbnQucmVxdWVzdChzZWxmLmZhbmFydF90dl9hcnRfbGluayAlIHR2ZGIsIGhlYWRlcnM9c2VsZi5mYW5hcnRfdHZfaGVhZGVycywgdGltZW91dD0nMTAnLCBlcnJvcj1UcnVlKQogICAgICAgICAgICAgICAgdHJ5OiBhcnQgPSBqc29uLmxvYWRzKGFydCkKICAgICAgICAgICAgICAgIGV4Y2VwdDogYXJ0bWV0YSA9IEZhbHNlCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHBvc3RlcjIgPSBhcnRbJ3R2cG9zdGVyJ10KICAgICAgICAgICAgICAgIHBvc3RlcjIgPSBbeCBmb3IgeCBpbiBwb3N0ZXIyIGlmIHguZ2V0KCdsYW5nJykgPT0gc2VsZi5sYW5nXVs6Oi0xXSArIFt4IGZvciB4IGluIHBvc3RlcjIgaWYgeC5nZXQoJ2xhbmcnKSA9PSAnZW4nXVs6Oi0xXSArIFt4IGZvciB4IGluIHBvc3RlcjIgaWYgeC5nZXQoJ2xhbmcnKSBpbiBbJzAwJywgJyddXVs6Oi0xXQogICAgICAgICAgICAgICAgcG9zdGVyMiA9IHBvc3RlcjJbMF1bJ3VybCddLmVuY29kZSgndXRmLTgnKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwb3N0ZXIyID0gJzAnCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBmYW5hcnQyID0gYXJ0WydzaG93YmFja2dyb3VuZCddCiAgICAgICAgICAgICAgICBmYW5hcnQyID0gW3ggZm9yIHggaW4gZmFuYXJ0MiBpZiB4LmdldCgnbGFuZycpID09IHNlbGYubGFuZ11bOjotMV0gKyBbeCBmb3IgeCBpbiBmYW5hcnQyIGlmIHguZ2V0KCdsYW5nJykgPT0gJ2VuJ11bOjotMV0gKyBbeCBmb3IgeCBpbiBmYW5hcnQyIGlmIHguZ2V0KCdsYW5nJykgaW4gWycwMCcsICcnXV1bOjotMV0KICAgICAgICAgICAgICAgIGZhbmFydDIgPSBmYW5hcnQyWzBdWyd1cmwnXS5lbmNvZGUoJ3V0Zi04JykKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgZmFuYXJ0MiA9ICcwJwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgYmFubmVyMiA9IGFydFsndHZiYW5uZXInXQogICAgICAgICAgICAgICAgYmFubmVyMiA9IFt4IGZvciB4IGluIGJhbm5lcjIgaWYgeC5nZXQoJ2xhbmcnKSA9PSBzZWxmLmxhbmddWzo6LTFdICsgW3ggZm9yIHggaW4gYmFubmVyMiBpZiB4LmdldCgnbGFuZycpID09ICdlbiddWzo6LTFdICsgW3ggZm9yIHggaW4gYmFubmVyMiBpZiB4LmdldCgnbGFuZycpIGluIFsnMDAnLCAnJ11dWzo6LTFdCiAgICAgICAgICAgICAgICBiYW5uZXIyID0gYmFubmVyMlswXVsndXJsJ10uZW5jb2RlKCd1dGYtOCcpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGJhbm5lcjIgPSAnMCcKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlmICdoZHR2bG9nbycgaW4gYXJ0OiBjbGVhcmxvZ28gPSBhcnRbJ2hkdHZsb2dvJ10KICAgICAgICAgICAgICAgIGVsc2U6IGNsZWFybG9nbyA9IGFydFsnY2xlYXJsb2dvJ10KICAgICAgICAgICAgICAgIGNsZWFybG9nbyA9IFt4IGZvciB4IGluIGNsZWFybG9nbyBpZiB4LmdldCgnbGFuZycpID09IHNlbGYubGFuZ11bOjotMV0gKyBbeCBmb3IgeCBpbiBjbGVhcmxvZ28gaWYgeC5nZXQoJ2xhbmcnKSA9PSAnZW4nXVs6Oi0xXSArIFt4IGZvciB4IGluIGNsZWFybG9nbyBpZiB4LmdldCgnbGFuZycpIGluIFsnMDAnLCAnJ11dWzo6LTFdCiAgICAgICAgICAgICAgICBjbGVhcmxvZ28gPSBjbGVhcmxvZ29bMF1bJ3VybCddLmVuY29kZSgndXRmLTgnKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBjbGVhcmxvZ28gPSAnMCcKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlmICdoZGNsZWFyYXJ0JyBpbiBhcnQ6IGNsZWFyYXJ0ID0gYXJ0WydoZGNsZWFyYXJ0J10KICAgICAgICAgICAgICAgIGVsc2U6IGNsZWFyYXJ0ID0gYXJ0WydjbGVhcmFydCddCiAgICAgICAgICAgICAgICBjbGVhcmFydCA9IFt4IGZvciB4IGluIGNsZWFyYXJ0IGlmIHguZ2V0KCdsYW5nJykgPT0gc2VsZi5sYW5nXVs6Oi0xXSArIFt4IGZvciB4IGluIGNsZWFyYXJ0IGlmIHguZ2V0KCdsYW5nJykgPT0gJ2VuJ11bOjotMV0gKyBbeCBmb3IgeCBpbiBjbGVhcmFydCBpZiB4LmdldCgnbGFuZycpIGluIFsnMDAnLCAnJ11dWzo6LTFdCiAgICAgICAgICAgICAgICBjbGVhcmFydCA9IGNsZWFyYXJ0WzBdWyd1cmwnXS5lbmNvZGUoJ3V0Zi04JykKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgY2xlYXJhcnQgPSAnMCcKCiAgICAgICAgICAgIGl0ZW0gPSB7J3RpdGxlJzogdGl0bGUsICd5ZWFyJzogeWVhciwgJ2ltZGInOiBpbWRiLCAndHZkYic6IHR2ZGIsICdwb3N0ZXInOiBwb3N0ZXIsICdwb3N0ZXIyJzogcG9zdGVyMiwgJ2Jhbm5lcic6IGJhbm5lciwgJ2Jhbm5lcjInOiBiYW5uZXIyLCAnZmFuYXJ0JzogZmFuYXJ0LCAnZmFuYXJ0Mic6IGZhbmFydDIsICdjbGVhcmxvZ28nOiBjbGVhcmxvZ28sICdjbGVhcmFydCc6IGNsZWFyYXJ0LCAncHJlbWllcmVkJzogcHJlbWllcmVkLCAnc3R1ZGlvJzogc3R1ZGlvLCAnZ2VucmUnOiBnZW5yZSwgJ2R1cmF0aW9uJzogZHVyYXRpb24sICdyYXRpbmcnOiByYXRpbmcsICd2b3Rlcyc6IHZvdGVzLCAnbXBhYSc6IG1wYWEsICdjYXN0JzogY2FzdCwgJ3Bsb3QnOiBwbG90fQogICAgICAgICAgICBpdGVtID0gZGljdCgoayx2KSBmb3IgaywgdiBpbiBpdGVtLml0ZXJpdGVtcygpIGlmIG5vdCB2ID09ICcwJykKICAgICAgICAgICAgc2VsZi5saXN0W2ldLnVwZGF0ZShpdGVtKQoKICAgICAgICAgICAgaWYgYXJ0bWV0YSA9PSBGYWxzZTogcmFpc2UgRXhjZXB0aW9uKCkKCiAgICAgICAgICAgIG1ldGEgPSB7J2ltZGInOiBpbWRiLCAndHZkYic6IHR2ZGIsICdsYW5nJzogc2VsZi5sYW5nLCAndXNlcic6IHNlbGYudXNlciwgJ2l0ZW0nOiBpdGVtfQogICAgICAgICAgICBzZWxmLm1ldGEuYXBwZW5kKG1ldGEpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCgoKICAgIGRlZiB0dnNob3dEaXJlY3Rvcnkoc2VsZiwgaXRlbXMpOgogICAgICAgIGlmIGl0ZW1zID09IE5vbmUgb3IgbGVuKGl0ZW1zKSA9PSAwOiBjb250cm9sLmlkbGUoKSA7IHN5cy5leGl0KCkKCiAgICAgICAgc3lzYWRkb24gPSBzeXMuYXJndlswXQoKICAgICAgICBzeXNoYW5kbGUgPSBpbnQoc3lzLmFyZ3ZbMV0pCgogICAgICAgIGFkZG9uUG9zdGVyLCBhZGRvbkJhbm5lciA9IGNvbnRyb2wuYWRkb25Qb3N0ZXIoKSwgY29udHJvbC5hZGRvbkJhbm5lcigpCgogICAgICAgIGFkZG9uRmFuYXJ0LCBzZXR0aW5nRmFuYXJ0ID0gY29udHJvbC5hZGRvbkZhbmFydCgpLCBjb250cm9sLnNldHRpbmcoJ2ZhbmFydCcpCgogICAgICAgIHRyYWt0Q3JlZGVudGlhbHMgPSB0cmFrdC5nZXRUcmFrdENyZWRlbnRpYWxzSW5mbygpCgogICAgICAgIHRyeTogaXNPbGQgPSBGYWxzZSA7IGNvbnRyb2wuaXRlbSgpLmdldEFydCgndHlwZScpCiAgICAgICAgZXhjZXB0OiBpc09sZCA9IFRydWUKCiAgICAgICAgaW5kaWNhdG9ycyA9IHBsYXljb3VudC5nZXRUVlNob3dJbmRpY2F0b3JzKHJlZnJlc2g9VHJ1ZSkgaWYgYWN0aW9uID09ICd0dnNob3dzJyBlbHNlIHBsYXljb3VudC5nZXRUVlNob3dJbmRpY2F0b3JzKCkKCiAgICAgICAgZmxhdHRlbiA9IFRydWUgaWYgY29udHJvbC5zZXR0aW5nKCdmbGF0dGVuLnR2c2hvd3MnKSA9PSAndHJ1ZScgZWxzZSBGYWxzZQoKICAgICAgICB3YXRjaGVkTWVudSA9IGNvbnRyb2wubGFuZygzMjA2OCkuZW5jb2RlKCd1dGYtOCcpIGlmIHRyYWt0LmdldFRyYWt0SW5kaWNhdG9yc0luZm8oKSA9PSBUcnVlIGVsc2UgY29udHJvbC5sYW5nKDMyMDY2KS5lbmNvZGUoJ3V0Zi04JykKCiAgICAgICAgdW53YXRjaGVkTWVudSA9IGNvbnRyb2wubGFuZygzMjA2OSkuZW5jb2RlKCd1dGYtOCcpIGlmIHRyYWt0LmdldFRyYWt0SW5kaWNhdG9yc0luZm8oKSA9PSBUcnVlIGVsc2UgY29udHJvbC5sYW5nKDMyMDY3KS5lbmNvZGUoJ3V0Zi04JykKCiAgICAgICAgcXVldWVNZW51ID0gY29udHJvbC5sYW5nKDMyMDY1KS5lbmNvZGUoJ3V0Zi04JykKCiAgICAgICAgdHJha3RNYW5hZ2VyTWVudSA9IGNvbnRyb2wubGFuZygzMjA3MCkuZW5jb2RlKCd1dGYtOCcpCgogICAgICAgIG5leHRNZW51ID0gY29udHJvbC5sYW5nKDMyMDUzKS5lbmNvZGUoJ3V0Zi04JykKCiAgICAgICAgcGxheVJhbmRvbSA9IGNvbnRyb2wubGFuZygzMjUzNSkuZW5jb2RlKCd1dGYtOCcpCgogICAgICAgIGFkZFRvTGlicmFyeSA9IGNvbnRyb2wubGFuZygzMjU1MSkuZW5jb2RlKCd1dGYtOCcpCgogICAgICAgIGZvciBpIGluIGl0ZW1zOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBsYWJlbCA9IGlbJ3RpdGxlJ10KICAgICAgICAgICAgICAgIHN5c3RpdGxlID0gc3lzbmFtZSA9IHVybGxpYi5xdW90ZV9wbHVzKGlbJ29yaWdpbmFsdGl0bGUnXSkKICAgICAgICAgICAgICAgIHN5c2ltYWdlID0gdXJsbGliLnF1b3RlX3BsdXMoaVsncG9zdGVyJ10pCiAgICAgICAgICAgICAgICBpbWRiLCB0dmRiLCB5ZWFyID0gaVsnaW1kYiddLCBpWyd0dmRiJ10sIGlbJ3llYXInXQoKICAgICAgICAgICAgICAgIG1ldGEgPSBkaWN0KChrLHYpIGZvciBrLCB2IGluIGkuaXRlcml0ZW1zKCkgaWYgbm90IHYgPT0gJzAnKQogICAgICAgICAgICAgICAgbWV0YS51cGRhdGUoeydjb2RlJzogaW1kYiwgJ2ltZGJudW1iZXInOiBpbWRiLCAnaW1kYl9pZCc6IGltZGJ9KQogICAgICAgICAgICAgICAgbWV0YS51cGRhdGUoeyd0dmRiX2lkJzogdHZkYn0pCiAgICAgICAgICAgICAgICBtZXRhLnVwZGF0ZSh7J21lZGlhdHlwZSc6ICd0dnNob3cnfSkKICAgICAgICAgICAgICAgIG1ldGEudXBkYXRlKHsndHZzaG93dGl0bGUnOiBzeXN0aXRsZX0pCiAgICAgICAgICAgICAgICBtZXRhLnVwZGF0ZSh7J3RyYWlsZXInOiAnJXM/YWN0aW9uPXRyYWlsZXImbmFtZT0lcycgJSAoc3lzYWRkb24sIHVybGxpYi5xdW90ZV9wbHVzKGxhYmVsKSl9KQogICAgICAgICAgICAgICAgaWYgbm90ICdkdXJhdGlvbicgaW4gaTogbWV0YS51cGRhdGUoeydkdXJhdGlvbic6ICc2MCd9KQogICAgICAgICAgICAgICAgZWxpZiBpWydkdXJhdGlvbiddID09ICcwJzogbWV0YS51cGRhdGUoeydkdXJhdGlvbic6ICc2MCd9KQogICAgICAgICAgICAgICAgdHJ5OiBtZXRhLnVwZGF0ZSh7J2R1cmF0aW9uJzogc3RyKGludChtZXRhWydkdXJhdGlvbiddKSAqIDYwKX0pCiAgICAgICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICAgICAgICAgIHRyeTogbWV0YS51cGRhdGUoeydnZW5yZSc6IGNsZWFuZ2VucmUubGFuZyhtZXRhWydnZW5yZSddLCBzZWxmLmxhbmcpfSkKICAgICAgICAgICAgICAgIGV4Y2VwdDogcGFzcwoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBvdmVybGF5ID0gaW50KHBsYXljb3VudC5nZXRUVlNob3dPdmVybGF5KGluZGljYXRvcnMsIHR2ZGIpKQogICAgICAgICAgICAgICAgICAgIGlmIG92ZXJsYXkgPT0gNzogbWV0YS51cGRhdGUoeydwbGF5Y291bnQnOiAxLCAnb3ZlcmxheSc6IDd9KQogICAgICAgICAgICAgICAgICAgIGVsc2U6IG1ldGEudXBkYXRlKHsncGxheWNvdW50JzogMCwgJ292ZXJsYXknOiA2fSkKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBwYXNzCgoKICAgICAgICAgICAgICAgIGlmIGZsYXR0ZW4gPT0gVHJ1ZToKICAgICAgICAgICAgICAgICAgICB1cmwgPSAnJXM/YWN0aW9uPWVwaXNvZGVzJnR2c2hvd3RpdGxlPSVzJnllYXI9JXMmaW1kYj0lcyZ0dmRiPSVzJyAlIChzeXNhZGRvbiwgc3lzdGl0bGUsIHllYXIsIGltZGIsIHR2ZGIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHVybCA9ICclcz9hY3Rpb249c2Vhc29ucyZ0dnNob3d0aXRsZT0lcyZ5ZWFyPSVzJmltZGI9JXMmdHZkYj0lcycgJSAoc3lzYWRkb24sIHN5c3RpdGxlLCB5ZWFyLCBpbWRiLCB0dmRiKQoKCiAgICAgICAgICAgICAgICBjbSA9IFtdCgogICAgICAgICAgICAgICAgY20uYXBwZW5kKCgnRmluZCBzaW1pbGFyJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0FjdGl2YXRlV2luZG93KDEwMDI1LCVzP2FjdGlvbj10dnNob3dzJnVybD1odHRwczovL2FwaS50cmFrdC50di9zaG93cy8lcy9yZWxhdGVkLHJldHVybiknICUgKAogICAgICAgICAgICAgICAgICAgICAgICAgICBzeXNhZGRvbiwgaW1kYikpKQoKICAgICAgICAgICAgICAgIGNtLmFwcGVuZCgocGxheVJhbmRvbSwgJ1J1blBsdWdpbiglcz9hY3Rpb249cmFuZG9tJnJ0eXBlPXNlYXNvbiZ0dnNob3d0aXRsZT0lcyZ5ZWFyPSVzJmltZGI9JXMmdHZkYj0lcyknICUgKHN5c2FkZG9uLCB1cmxsaWIucXVvdGVfcGx1cyhzeXN0aXRsZSksIHVybGxpYi5xdW90ZV9wbHVzKHllYXIpLCB1cmxsaWIucXVvdGVfcGx1cyhpbWRiKSwgdXJsbGliLnF1b3RlX3BsdXModHZkYikpKSkKCiAgICAgICAgICAgICAgICBjbS5hcHBlbmQoKHF1ZXVlTWVudSwgJ1J1blBsdWdpbiglcz9hY3Rpb249cXVldWVJdGVtKScgJSBzeXNhZGRvbikpCgogICAgICAgICAgICAgICAgY20uYXBwZW5kKCh3YXRjaGVkTWVudSwgJ1J1blBsdWdpbiglcz9hY3Rpb249dHZQbGF5Y291bnQmbmFtZT0lcyZpbWRiPSVzJnR2ZGI9JXMmcXVlcnk9NyknICUgKHN5c2FkZG9uLCBzeXN0aXRsZSwgaW1kYiwgdHZkYikpKQoKICAgICAgICAgICAgICAgIGNtLmFwcGVuZCgodW53YXRjaGVkTWVudSwgJ1J1blBsdWdpbiglcz9hY3Rpb249dHZQbGF5Y291bnQmbmFtZT0lcyZpbWRiPSVzJnR2ZGI9JXMmcXVlcnk9NiknICUgKHN5c2FkZG9uLCBzeXN0aXRsZSwgaW1kYiwgdHZkYikpKQoKICAgICAgICAgICAgICAgIGlmIHRyYWt0Q3JlZGVudGlhbHMgPT0gVHJ1ZToKICAgICAgICAgICAgICAgICAgICBjbS5hcHBlbmQoKHRyYWt0TWFuYWdlck1lbnUsICdSdW5QbHVnaW4oJXM/YWN0aW9uPXRyYWt0TWFuYWdlciZuYW1lPSVzJnR2ZGI9JXMmY29udGVudD10dnNob3cpJyAlIChzeXNhZGRvbiwgc3lzbmFtZSwgdHZkYikpKQoKICAgICAgICAgICAgICAgIGlmIGlzT2xkID09IFRydWU6CiAgICAgICAgICAgICAgICAgICAgY20uYXBwZW5kKChjb250cm9sLmxhbmcyKDE5MDMzKS5lbmNvZGUoJ3V0Zi04JyksICdBY3Rpb24oSW5mbyknKSkKCiAgICAgICAgICAgICAgICBjbS5hcHBlbmQoKGFkZFRvTGlicmFyeSwgJ1J1blBsdWdpbiglcz9hY3Rpb249dHZzaG93VG9MaWJyYXJ5JnR2c2hvd3RpdGxlPSVzJnllYXI9JXMmaW1kYj0lcyZ0dmRiPSVzKScgJSAoc3lzYWRkb24sIHN5c3RpdGxlLCB5ZWFyLCBpbWRiLCB0dmRiKSkpCgogICAgICAgICAgICAgICAgY20uYXBwZW5kKCgnMTNDbG93bnMgU2V0dGluZ3MnLCAnUnVuUGx1Z2luKCVzP2FjdGlvbj1vcGVuU2V0dGluZ3MmcXVlcnk9KDAsMCkpJyAlIHN5c2FkZG9uKSkKCiAgICAgICAgICAgICAgICBpdGVtID0gY29udHJvbC5pdGVtKGxhYmVsPWxhYmVsKQoKICAgICAgICAgICAgICAgIGFydCA9IHt9CgogICAgICAgICAgICAgICAgaWYgJ3Bvc3RlcicgaW4gaSBhbmQgbm90IGlbJ3Bvc3RlciddID09ICcwJzoKICAgICAgICAgICAgICAgICAgICBhcnQudXBkYXRlKHsnaWNvbic6IGlbJ3Bvc3RlciddLCAndGh1bWInOiBpWydwb3N0ZXInXSwgJ3Bvc3Rlcic6IGlbJ3Bvc3RlciddfSkKICAgICAgICAgICAgICAgICNlbGlmICdwb3N0ZXIyJyBpbiBpIGFuZCBub3QgaVsncG9zdGVyMiddID09ICcwJzoKICAgICAgICAgICAgICAgICAgICAjYXJ0LnVwZGF0ZSh7J2ljb24nOiBpWydwb3N0ZXIyJ10sICd0aHVtYic6IGlbJ3Bvc3RlcjInXSwgJ3Bvc3Rlcic6IGlbJ3Bvc3RlcjInXX0pCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGFydC51cGRhdGUoeydpY29uJzogYWRkb25Qb3N0ZXIsICd0aHVtYic6IGFkZG9uUG9zdGVyLCAncG9zdGVyJzogYWRkb25Qb3N0ZXJ9KQoKICAgICAgICAgICAgICAgIGlmICdiYW5uZXInIGluIGkgYW5kIG5vdCBpWydiYW5uZXInXSA9PSAnMCc6CiAgICAgICAgICAgICAgICAgICAgYXJ0LnVwZGF0ZSh7J2Jhbm5lcic6IGlbJ2Jhbm5lciddfSkKICAgICAgICAgICAgICAgICNlbGlmICdiYW5uZXIyJyBpbiBpIGFuZCBub3QgaVsnYmFubmVyMiddID09ICcwJzoKICAgICAgICAgICAgICAgICAgICAjYXJ0LnVwZGF0ZSh7J2Jhbm5lcic6IGlbJ2Jhbm5lcjInXX0pCiAgICAgICAgICAgICAgICBlbGlmICdmYW5hcnQnIGluIGkgYW5kIG5vdCBpWydmYW5hcnQnXSA9PSAnMCc6CiAgICAgICAgICAgICAgICAgICAgYXJ0LnVwZGF0ZSh7J2Jhbm5lcic6IGlbJ2ZhbmFydCddfSkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgYXJ0LnVwZGF0ZSh7J2Jhbm5lcic6IGFkZG9uQmFubmVyfSkKCiAgICAgICAgICAgICAgICBpZiAnY2xlYXJsb2dvJyBpbiBpIGFuZCBub3QgaVsnY2xlYXJsb2dvJ10gPT0gJzAnOgogICAgICAgICAgICAgICAgICAgIGFydC51cGRhdGUoeydjbGVhcmxvZ28nOiBpWydjbGVhcmxvZ28nXX0pCgogICAgICAgICAgICAgICAgaWYgJ2NsZWFyYXJ0JyBpbiBpIGFuZCBub3QgaVsnY2xlYXJhcnQnXSA9PSAnMCc6CiAgICAgICAgICAgICAgICAgICAgYXJ0LnVwZGF0ZSh7J2NsZWFyYXJ0JzogaVsnY2xlYXJhcnQnXX0pCgogICAgICAgICAgICAgICAgaWYgc2V0dGluZ0ZhbmFydCA9PSAndHJ1ZScgYW5kICdmYW5hcnQnIGluIGkgYW5kIG5vdCBpWydmYW5hcnQnXSA9PSAnMCc6CiAgICAgICAgICAgICAgICAgICAgaXRlbS5zZXRQcm9wZXJ0eSgnRmFuYXJ0X0ltYWdlJywgaVsnZmFuYXJ0J10pCiAgICAgICAgICAgICAgICAjZWxpZiBzZXR0aW5nRmFuYXJ0ID09ICd0cnVlJyBhbmQgJ2ZhbmFydDInIGluIGkgYW5kIG5vdCBpWydmYW5hcnQyJ10gPT0gJzAnOgogICAgICAgICAgICAgICAgICAgICNpdGVtLnNldFByb3BlcnR5KCdGYW5hcnRfSW1hZ2UnLCBpWydmYW5hcnQyJ10pCiAgICAgICAgICAgICAgICBlbGlmIG5vdCBhZGRvbkZhbmFydCA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIGl0ZW0uc2V0UHJvcGVydHkoJ0ZhbmFydF9JbWFnZScsIGFkZG9uRmFuYXJ0KQoKICAgICAgICAgICAgICAgIGl0ZW0uc2V0QXJ0KGFydCkKICAgICAgICAgICAgICAgIGl0ZW0uYWRkQ29udGV4dE1lbnVJdGVtcyhjbSkKICAgICAgICAgICAgICAgIGl0ZW0uc2V0SW5mbyh0eXBlPSdWaWRlbycsIGluZm9MYWJlbHMgPSBtZXRhKQoKICAgICAgICAgICAgICAgIHZpZGVvX3N0cmVhbWluZm8gPSB7J2NvZGVjJzogJ2gyNjQnfQogICAgICAgICAgICAgICAgaXRlbS5hZGRTdHJlYW1JbmZvKCd2aWRlbycsIHZpZGVvX3N0cmVhbWluZm8pCgogICAgICAgICAgICAgICAgY29udHJvbC5hZGRJdGVtKGhhbmRsZT1zeXNoYW5kbGUsIHVybD11cmwsIGxpc3RpdGVtPWl0ZW0sIGlzRm9sZGVyPVRydWUpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKCiAgICAgICAgdHJ5OgogICAgICAgICAgICB1cmwgPSBpdGVtc1swXVsnbmV4dCddCiAgICAgICAgICAgIGlmIHVybCA9PSAnJzogcmFpc2UgRXhjZXB0aW9uKCkKCiAgICAgICAgICAgIGljb24gPSBjb250cm9sLmFkZG9uTmV4dCgpCiAgICAgICAgICAgIHVybCA9ICclcz9hY3Rpb249dHZzaG93UGFnZSZ1cmw9JXMnICUgKHN5c2FkZG9uLCB1cmxsaWIucXVvdGVfcGx1cyh1cmwpKQoKICAgICAgICAgICAgaXRlbSA9IGNvbnRyb2wuaXRlbShsYWJlbD1uZXh0TWVudSkKCiAgICAgICAgICAgIGl0ZW0uc2V0QXJ0KHsnaWNvbic6IGljb24sICd0aHVtYic6IGljb24sICdwb3N0ZXInOiBpY29uLCAnYmFubmVyJzogaWNvbn0pCiAgICAgICAgICAgIGlmIG5vdCBhZGRvbkZhbmFydCA9PSBOb25lOiBpdGVtLnNldFByb3BlcnR5KCdGYW5hcnRfSW1hZ2UnLCBhZGRvbkZhbmFydCkKCiAgICAgICAgICAgIGNvbnRyb2wuYWRkSXRlbShoYW5kbGU9c3lzaGFuZGxlLCB1cmw9dXJsLCBsaXN0aXRlbT1pdGVtLCBpc0ZvbGRlcj1UcnVlKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwoKICAgICAgICBjb250cm9sLmNvbnRlbnQoc3lzaGFuZGxlLCAndHZzaG93cycpCiAgICAgICAgY29udHJvbC5kaXJlY3Rvcnkoc3lzaGFuZGxlLCBjYWNoZVRvRGlzYz1UcnVlKQogICAgICAgIHZpZXdzLnNldFZpZXcoJ3R2c2hvd3MnLCB7J3NraW4uZXN0dWFyeSc6IDU1LCAnc2tpbi5jb25mbHVlbmNlJzogNTAwfSkKCgogICAgZGVmIGFkZERpcmVjdG9yeShzZWxmLCBpdGVtcywgcXVldWU9RmFsc2UpOgogICAgICAgIGlmIGl0ZW1zID09IE5vbmUgb3IgbGVuKGl0ZW1zKSA9PSAwOiBjb250cm9sLmlkbGUoKSA7IHN5cy5leGl0KCkKCiAgICAgICAgc3lzYWRkb24gPSBzeXMuYXJndlswXQoKICAgICAgICBzeXNoYW5kbGUgPSBpbnQoc3lzLmFyZ3ZbMV0pCgogICAgICAgIGFkZG9uRmFuYXJ0LCBhZGRvblRodW1iLCBhcnRQYXRoID0gY29udHJvbC5hZGRvbkZhbmFydCgpLCBjb250cm9sLmFkZG9uVGh1bWIoKSwgY29udHJvbC5hcnRQYXRoKCkKCiAgICAgICAgcXVldWVNZW51ID0gY29udHJvbC5sYW5nKDMyMDY1KS5lbmNvZGUoJ3V0Zi04JykKCiAgICAgICAgcGxheVJhbmRvbSA9IGNvbnRyb2wubGFuZygzMjUzNSkuZW5jb2RlKCd1dGYtOCcpCgogICAgICAgIGFkZFRvTGlicmFyeSA9IGNvbnRyb2wubGFuZygzMjU1MSkuZW5jb2RlKCd1dGYtOCcpCgogICAgICAgIGZvciBpIGluIGl0ZW1zOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBuYW1lID0gaVsnbmFtZSddCgogICAgICAgICAgICAgICAgaWYgaVsnaW1hZ2UnXS5zdGFydHN3aXRoKCdodHRwJyk6IHRodW1iID0gaVsnaW1hZ2UnXQogICAgICAgICAgICAgICAgZWxpZiBub3QgYXJ0UGF0aCA9PSBOb25lOiB0aHVtYiA9IG9zLnBhdGguam9pbihhcnRQYXRoLCBpWydpbWFnZSddKQogICAgICAgICAgICAgICAgZWxzZTogdGh1bWIgPSBhZGRvblRodW1iCgogICAgICAgICAgICAgICAgdXJsID0gJyVzP2FjdGlvbj0lcycgJSAoc3lzYWRkb24sIGlbJ2FjdGlvbiddKQogICAgICAgICAgICAgICAgdHJ5OiB1cmwgKz0gJyZ1cmw9JXMnICUgdXJsbGliLnF1b3RlX3BsdXMoaVsndXJsJ10pCiAgICAgICAgICAgICAgICBleGNlcHQ6IHBhc3MKCiAgICAgICAgICAgICAgICBjbSA9IFtdCgogICAgICAgICAgICAgICAgY20uYXBwZW5kKChwbGF5UmFuZG9tLCAnUnVuUGx1Z2luKCVzP2FjdGlvbj1yYW5kb20mcnR5cGU9c2hvdyZ1cmw9JXMpJyAlIChzeXNhZGRvbiwgdXJsbGliLnF1b3RlX3BsdXMoaVsndXJsJ10pKSkpCgogICAgICAgICAgICAgICAgaWYgcXVldWUgPT0gVHJ1ZToKICAgICAgICAgICAgICAgICAgICBjbS5hcHBlbmQoKHF1ZXVlTWVudSwgJ1J1blBsdWdpbiglcz9hY3Rpb249cXVldWVJdGVtKScgJSBzeXNhZGRvbikpCgogICAgICAgICAgICAgICAgdHJ5OiBjbS5hcHBlbmQoKGFkZFRvTGlicmFyeSwgJ1J1blBsdWdpbiglcz9hY3Rpb249dHZzaG93c1RvTGlicmFyeSZ1cmw9JXMpJyAlIChzeXNhZGRvbiwgdXJsbGliLnF1b3RlX3BsdXMoaVsnY29udGV4dCddKSkpKQogICAgICAgICAgICAgICAgZXhjZXB0OiBwYXNzCgogICAgICAgICAgICAgICAgaXRlbSA9IGNvbnRyb2wuaXRlbShsYWJlbD1uYW1lKQoKICAgICAgICAgICAgICAgIGl0ZW0uc2V0QXJ0KHsnaWNvbic6IHRodW1iLCAndGh1bWInOiB0aHVtYn0pCiAgICAgICAgICAgICAgICBpZiBub3QgYWRkb25GYW5hcnQgPT0gTm9uZTogaXRlbS5zZXRQcm9wZXJ0eSgnRmFuYXJ0X0ltYWdlJywgYWRkb25GYW5hcnQpCgogICAgICAgICAgICAgICAgaXRlbS5hZGRDb250ZXh0TWVudUl0ZW1zKGNtKQoKICAgICAgICAgICAgICAgIGNvbnRyb2wuYWRkSXRlbShoYW5kbGU9c3lzaGFuZGxlLCB1cmw9dXJsLCBsaXN0aXRlbT1pdGVtLCBpc0ZvbGRlcj1UcnVlKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCgogICAgICAgIGNvbnRyb2wuY29udGVudChzeXNoYW5kbGUsICdhZGRvbnMnKQogICAgICAgIGNvbnRyb2wuZGlyZWN0b3J5KHN5c2hhbmRsZSwgY2FjaGVUb0Rpc2M9VHJ1ZSkK')