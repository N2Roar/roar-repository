# -*- coding: utf-8 -*-

'''
#:::'##::::'#######:::'######::'##::::::::'#######::'##:::::'##:'##::: ##::'######::
#:'####:::'##.... ##:'##... ##: ##:::::::'##.... ##: ##:'##: ##: ###:: ##:'##... ##:
#:.. ##:::..::::: ##: ##:::..:: ##::::::: ##:::: ##: ##: ##: ##: ####: ##: ##:::..::
#::: ##::::'#######:: ##::::::: ##::::::: ##:::: ##: ##: ##: ##: ## ## ##:. ######::
#::: ##::::...... ##: ##::::::: ##::::::: ##:::: ##: ##: ##: ##: ##. ####::..... ##:
#::: ##:::'##:::: ##: ##::: ##: ##::::::: ##:::: ##: ##: ##: ##: ##:. ###:'##::: ##:
#:'######:. #######::. ######:: ########:. #######::. ###. ###:: ##::. ##:. ######::
#:......:::.......::::......:::........:::.......::::...::...:::..::::..:::......:::

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
'''

import base64;exec base64.b64decode('ZnJvbSByZXNvdXJjZXMubGliLm1vZHVsZXMgaW1wb3J0IHRyYWt0CmZyb20gcmVzb3VyY2VzLmxpYi5tb2R1bGVzIGltcG9ydCBjbGVhbmdlbnJlCmZyb20gcmVzb3VyY2VzLmxpYi5tb2R1bGVzIGltcG9ydCBjbGVhbnRpdGxlCmZyb20gcmVzb3VyY2VzLmxpYi5tb2R1bGVzIGltcG9ydCBjb250cm9sCmZyb20gcmVzb3VyY2VzLmxpYi5tb2R1bGVzIGltcG9ydCBjbGllbnQKZnJvbSByZXNvdXJjZXMubGliLm1vZHVsZXMgaW1wb3J0IGNhY2hlCmZyb20gcmVzb3VyY2VzLmxpYi5tb2R1bGVzIGltcG9ydCBtZXRhY2FjaGUKZnJvbSByZXNvdXJjZXMubGliLm1vZHVsZXMgaW1wb3J0IHBsYXljb3VudApmcm9tIHJlc291cmNlcy5saWIubW9kdWxlcyBpbXBvcnQgd29ya2Vycwpmcm9tIHJlc291cmNlcy5saWIubW9kdWxlcyBpbXBvcnQgdmlld3MKZnJvbSByZXNvdXJjZXMubGliLm1vZHVsZXMgaW1wb3J0IHV0aWxzCmZyb20gcmVzb3VyY2VzLmxpYi5pbmRleGVycyBpbXBvcnQgbmF2aWdhdG9yCgppbXBvcnQgb3Msc3lzLHJlLGpzb24sdXJsbGliLHVybHBhcnNlLGRhdGV0aW1lLHhibWMKCnBhcmFtcyA9IGRpY3QodXJscGFyc2UucGFyc2VfcXNsKHN5cy5hcmd2WzJdLnJlcGxhY2UoJz8nLCcnKSkpIGlmIGxlbihzeXMuYXJndikgPiAxIGVsc2UgZGljdCgpCgphY3Rpb24gPSBwYXJhbXMuZ2V0KCdhY3Rpb24nKQoKY2xhc3MgbW92aWVzOgogICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIHNlbGYubGlzdCA9IFtdCgogICAgICAgIHNlbGYuaW1kYl9saW5rID0gJ2h0dHA6Ly93d3cuaW1kYi5jb20nCiAgICAgICAgc2VsZi50cmFrdF9saW5rID0gJ2h0dHA6Ly9hcGkudHJha3QudHYnCiAgICAgICAgc2VsZi5kYXRldGltZSA9IChkYXRldGltZS5kYXRldGltZS51dGNub3coKSAtIGRhdGV0aW1lLnRpbWVkZWx0YShob3VycyA9IDUpKQogICAgICAgIHNlbGYuc3lzdGltZSA9IChzZWxmLmRhdGV0aW1lKS5zdHJmdGltZSgnJVklbSVkJUglTSVTJWYnKQogICAgICAgIHNlbGYueWVhcl9kYXRlID0gKHNlbGYuZGF0ZXRpbWUgLSBkYXRldGltZS50aW1lZGVsdGEoZGF5cyA9IDM2NSkpLnN0cmZ0aW1lKCclWS0lbS0lZCcpCiAgICAgICAgc2VsZi50b2RheV9kYXRlID0gKHNlbGYuZGF0ZXRpbWUpLnN0cmZ0aW1lKCclWS0lbS0lZCcpCiAgICAgICAgc2VsZi50cmFrdF91c2VyID0gY29udHJvbC5zZXR0aW5nKCd0cmFrdC51c2VyJykuc3RyaXAoKQogICAgICAgIHNlbGYuaW1kYl91c2VyID0gY29udHJvbC5zZXR0aW5nKCdpbWRiLnVzZXInKS5yZXBsYWNlKCd1cicsICcnKQogICAgICAgIHNlbGYudG1fdXNlciA9IGNvbnRyb2wuc2V0dGluZygndG0udXNlcicpCiAgICAgICAgc2VsZi5mYW5hcnRfdHZfdXNlciA9IGNvbnRyb2wuc2V0dGluZygnZmFuYXJ0LnR2LnVzZXInKQogICAgICAgIHNlbGYudXNlciA9IHN0cihjb250cm9sLnNldHRpbmcoJ2ZhbmFydC50di51c2VyJykpICsgc3RyKGNvbnRyb2wuc2V0dGluZygndG0udXNlcicpKQogICAgICAgIHNlbGYubGFuZyA9IGNvbnRyb2wuYXBpTGFuZ3VhZ2UoKVsndHJha3QnXQogICAgICAgIHNlbGYuaGlkZWNpbmVtYSA9IGNvbnRyb2wuc2V0dGluZygnaGlkZWNpbmVtYScpCgogICAgICAgIHNlbGYuc2VhcmNoX2xpbmsgPSAnaHR0cDovL2FwaS50cmFrdC50di9zZWFyY2gvbW92aWU/bGltaXQ9MjAmcGFnZT0xJnF1ZXJ5PScKICAgICAgICBzZWxmLmZhbmFydF90dl9hcnRfbGluayA9ICdodHRwOi8vd2Vic2VydmljZS5mYW5hcnQudHYvdjMvbW92aWVzLyVzJwogICAgICAgIHNlbGYuZmFuYXJ0X3R2X2xldmVsX2xpbmsgPSAnaHR0cDovL3dlYnNlcnZpY2UuZmFuYXJ0LnR2L3YzL2xldmVsJwogICAgICAgIHNlbGYudG1fYXJ0X2xpbmsgPSAnaHR0cDovL2FwaS50aGVtb3ZpZWRiLm9yZy8zL21vdmllLyVzL2ltYWdlcz9hcGlfa2V5PSVzJmxhbmd1YWdlPWVuLVVTJmluY2x1ZGVfaW1hZ2VfbGFuZ3VhZ2U9ZW4sJXMsbnVsbCcgJSAoJyVzJywgc2VsZi50bV91c2VyLCBzZWxmLmxhbmcpCiAgICAgICAgc2VsZi50bV9pbWdfbGluayA9ICdodHRwczovL2ltYWdlLnRtZGIub3JnL3QvcC93JXMlcycKCiAgICAgICAgc2VsZi5wZXJzb25zX2xpbmsgPSAnaHR0cDovL3d3dy5pbWRiLmNvbS9zZWFyY2gvbmFtZT9jb3VudD0xMDAmbmFtZT0nCiAgICAgICAgc2VsZi5wZXJzb25saXN0X2xpbmsgPSAnaHR0cDovL3d3dy5pbWRiLmNvbS9zZWFyY2gvbmFtZT9jb3VudD0xMDAmZ2VuZGVyPW1hbGUsZmVtYWxlJwogICAgICAgIHNlbGYucGVyc29uX2xpbmsgPSAnaHR0cDovL3d3dy5pbWRiLmNvbS9zZWFyY2gvdGl0bGU/dGl0bGVfdHlwZT1mZWF0dXJlLHR2X21vdmllJnByb2R1Y3Rpb25fc3RhdHVzPXJlbGVhc2VkJnJvbGU9JXMmc29ydD15ZWFyLGRlc2MmY291bnQ9NDAmc3RhcnQ9MScKICAgICAgICBzZWxmLmtleXdvcmRfbGluayA9ICdodHRwOi8vd3d3LmltZGIuY29tL3NlYXJjaC90aXRsZT90aXRsZV90eXBlPWZlYXR1cmUsdHZfbW92aWUsZG9jdW1lbnRhcnkmbnVtX3ZvdGVzPTEwMCwmcmVsZWFzZV9kYXRlPSxkYXRlWzBdJmtleXdvcmRzPSVzJnNvcnQ9bW92aWVtZXRlcixhc2MmY291bnQ9NDAmc3RhcnQ9MScKICAgICAgICBzZWxmLm9zY2Fyc19saW5rID0gJ2h0dHA6Ly93d3cuaW1kYi5jb20vc2VhcmNoL3RpdGxlP3RpdGxlX3R5cGU9ZmVhdHVyZSx0dl9tb3ZpZSZwcm9kdWN0aW9uX3N0YXR1cz1yZWxlYXNlZCZncm91cHM9b3NjYXJfYmVzdF9waWN0dXJlX3dpbm5lcnMmc29ydD15ZWFyLGRlc2MmY291bnQ9NDAmc3RhcnQ9MScKICAgICAgICBzZWxmLnRoZWF0ZXJzX2xpbmsgPSAnaHR0cDovL3d3dy5pbWRiLmNvbS9zZWFyY2gvdGl0bGU/dGl0bGVfdHlwZT1mZWF0dXJlJm51bV92b3Rlcz0xMDAwLCZyZWxlYXNlX2RhdGU9ZGF0ZVsxMjBdLGRhdGVbMF0mc29ydD1tb3ZpZW1ldGVyLGFzYyZjb3VudD00MCZzdGFydD0xJwogICAgICAgIHNlbGYueWVhcl9saW5rID0gJ2h0dHA6Ly93d3cuaW1kYi5jb20vc2VhcmNoL3RpdGxlP3RpdGxlX3R5cGU9ZmVhdHVyZSx0dl9tb3ZpZSZudW1fdm90ZXM9MTAwLCZwcm9kdWN0aW9uX3N0YXR1cz1yZWxlYXNlZCZ5ZWFyPSVzLCVzJnNvcnQ9bW92aWVtZXRlcixhc2MmY291bnQ9NDAmc3RhcnQ9MScKICAgICAgICBzZWxmLmZpZnR5c19saW5rID0gJ2h0dHBzOi8vd3d3LmltZGIuY29tL3NlYXJjaC90aXRsZT90aXRsZV90eXBlPWZlYXR1cmUmcmVsZWFzZV9kYXRlPTE5NTAtMDEtMDEsMTk1OS0xMi0zMSZ1c2VyX3JhdGluZz01LjAsMTAuMCcKICAgICAgICBzZWxmLnNpeHR5c19saW5rID0gJ2h0dHBzOi8vd3d3LmltZGIuY29tL3NlYXJjaC90aXRsZT90aXRsZV90eXBlPWZlYXR1cmUmcmVsZWFzZV9kYXRlPTE5NjAtMDEtMDEsMTk2OS0xMi0zMSZ1c2VyX3JhdGluZz01LjAsMTAuMCcKICAgICAgICBzZWxmLnNldmVudHlzX2xpbmsgPSAnaHR0cHM6Ly93d3cuaW1kYi5jb20vc2VhcmNoL3RpdGxlP3RpdGxlX3R5cGU9ZmVhdHVyZSZyZWxlYXNlX2RhdGU9MTk3MC0wMS0wMSwxOTc5LTEyLTMxJnVzZXJfcmF0aW5nPTUuMCwxMC4wJwogICAgICAgIHNlbGYuZWlnaHR5c19saW5rID0gJ2h0dHBzOi8vd3d3LmltZGIuY29tL3NlYXJjaC90aXRsZT90aXRsZV90eXBlPWZlYXR1cmUmcmVsZWFzZV9kYXRlPTE5ODAtMDEtMDEsMTk4OS0xMi0zMSZ1c2VyX3JhdGluZz01LjAsMTAuMCcKICAgICAgICBzZWxmLm5pbmV0eXNfbGluayA9ICdodHRwczovL3d3dy5pbWRiLmNvbS9zZWFyY2gvdGl0bGU/dGl0bGVfdHlwZT1mZWF0dXJlJnJlbGVhc2VfZGF0ZT0xOTkwLTAxLTAxLDE5OTktMTItMzEmdXNlcl9yYXRpbmc9NS4wLDEwLjAnCiAgICAgICAgc2VsZi5qdl9saW5rID0gJ2h0dHBzOi8vd3d3LmltZGIuY29tL3NlYXJjaC90aXRsZT90aXRsZV90eXBlPWZlYXR1cmUmcm9sZT1ubTAwMDE4MTUnCgogICAgICAgIGlmIHNlbGYuaGlkZWNpbmVtYSA9PSAndHJ1ZSc6CiAgICAgICAgICAgIHNlbGYucG9wdWxhcl9saW5rID0gJ2h0dHA6Ly93d3cuaW1kYi5jb20vc2VhcmNoL3RpdGxlP3RpdGxlX3R5cGU9ZmVhdHVyZSx0dl9tb3ZpZSZudW1fdm90ZXM9MTAwMCwmcHJvZHVjdGlvbl9zdGF0dXM9cmVsZWFzZWQmZ3JvdXBzPXRvcF8xMDAwJnJlbGVhc2VfZGF0ZT0sZGF0ZVs5MF0mc29ydD1tb3ZpZW1ldGVyLGFzYyZjb3VudD00MCZzdGFydD0xJwogICAgICAgICAgICBzZWxmLnZpZXdzX2xpbmsgPSAnaHR0cDovL3d3dy5pbWRiLmNvbS9zZWFyY2gvdGl0bGU/dGl0bGVfdHlwZT1mZWF0dXJlLHR2X21vdmllJm51bV92b3Rlcz0xMDAwLCZwcm9kdWN0aW9uX3N0YXR1cz1yZWxlYXNlZCZzb3J0PW51bV92b3RlcyxkZXNjJnJlbGVhc2VfZGF0ZT0sZGF0ZVs5MF0mY291bnQ9NDAmc3RhcnQ9MScKICAgICAgICAgICAgc2VsZi5mZWF0dXJlZF9saW5rID0gJ2h0dHA6Ly93d3cuaW1kYi5jb20vc2VhcmNoL3RpdGxlP3RpdGxlX3R5cGU9ZmVhdHVyZSx0dl9tb3ZpZSZudW1fdm90ZXM9MTAwMCwmcHJvZHVjdGlvbl9zdGF0dXM9cmVsZWFzZWQmcmVsZWFzZV9kYXRlPWRhdGVbMzY1XSxkYXRlWzkwXSZzb3J0PW1vdmllbWV0ZXIsYXNjJmNvdW50PTQwJnN0YXJ0PTEnCiAgICAgICAgICAgIHNlbGYuZ2VucmVfbGluayA9ICdodHRwOi8vd3d3LmltZGIuY29tL3NlYXJjaC90aXRsZT90aXRsZV90eXBlPWZlYXR1cmUsdHZfbW92aWUsZG9jdW1lbnRhcnkmbnVtX3ZvdGVzPTEwMCwmcmVsZWFzZV9kYXRlPSxkYXRlWzkwXSZnZW5yZXM9JXMmc29ydD1tb3ZpZW1ldGVyLGFzYyZjb3VudD00MCZzdGFydD0xJwogICAgICAgICAgICBzZWxmLmxhbmd1YWdlX2xpbmsgPSAnaHR0cDovL3d3dy5pbWRiLmNvbS9zZWFyY2gvdGl0bGU/dGl0bGVfdHlwZT1mZWF0dXJlLHR2X21vdmllJm51bV92b3Rlcz0xMDAsJnByb2R1Y3Rpb25fc3RhdHVzPXJlbGVhc2VkJnByaW1hcnlfbGFuZ3VhZ2U9JXMmc29ydD1tb3ZpZW1ldGVyLGFzYyZyZWxlYXNlX2RhdGU9LGRhdGVbOTBdJmNvdW50PTQwJnN0YXJ0PTEnCiAgICAgICAgICAgIHNlbGYuY2VydGlmaWNhdGlvbl9saW5rID0gJ2h0dHA6Ly93d3cuaW1kYi5jb20vc2VhcmNoL3RpdGxlP3RpdGxlX3R5cGU9ZmVhdHVyZSx0dl9tb3ZpZSZudW1fdm90ZXM9MTAwLCZwcm9kdWN0aW9uX3N0YXR1cz1yZWxlYXNlZCZjZXJ0aWZpY2F0ZXM9dXM6JXMmc29ydD1tb3ZpZW1ldGVyLGFzYyZyZWxlYXNlX2RhdGU9LGRhdGVbOTBdJmNvdW50PTQwJnN0YXJ0PTEnCiAgICAgICAgICAgIHNlbGYuYm94b2ZmaWNlX2xpbmsgPSAnaHR0cDovL3d3dy5pbWRiLmNvbS9zZWFyY2gvdGl0bGU/dGl0bGVfdHlwZT1mZWF0dXJlLHR2X21vdmllJnByb2R1Y3Rpb25fc3RhdHVzPXJlbGVhc2VkJnNvcnQ9Ym94b2ZmaWNlX2dyb3NzX3VzLGRlc2MmcmVsZWFzZV9kYXRlPSxkYXRlWzkwXSZjb3VudD00MCZzdGFydD0xJwogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNlbGYucG9wdWxhcl9saW5rID0gJ2h0dHA6Ly93d3cuaW1kYi5jb20vc2VhcmNoL3RpdGxlP3RpdGxlX3R5cGU9ZmVhdHVyZSx0dl9tb3ZpZSZudW1fdm90ZXM9MTAwMCwmcHJvZHVjdGlvbl9zdGF0dXM9cmVsZWFzZWQmZ3JvdXBzPXRvcF8xMDAwJnNvcnQ9bW92aWVtZXRlcixhc2MmY291bnQ9NDAmc3RhcnQ9MScKICAgICAgICAgICAgc2VsZi52aWV3c19saW5rID0gJ2h0dHA6Ly93d3cuaW1kYi5jb20vc2VhcmNoL3RpdGxlP3RpdGxlX3R5cGU9ZmVhdHVyZSx0dl9tb3ZpZSZudW1fdm90ZXM9MTAwMCwmcHJvZHVjdGlvbl9zdGF0dXM9cmVsZWFzZWQmc29ydD1udW1fdm90ZXMsZGVzYyZjb3VudD00MCZzdGFydD0xJwogICAgICAgICAgICBzZWxmLmZlYXR1cmVkX2xpbmsgPSAnaHR0cDovL3d3dy5pbWRiLmNvbS9zZWFyY2gvdGl0bGU/dGl0bGVfdHlwZT1mZWF0dXJlLHR2X21vdmllJm51bV92b3Rlcz0xMDAwLCZwcm9kdWN0aW9uX3N0YXR1cz1yZWxlYXNlZCZyZWxlYXNlX2RhdGU9ZGF0ZVszNjVdLGRhdGVbNjBdJnNvcnQ9bW92aWVtZXRlcixhc2MmY291bnQ9NDAmc3RhcnQ9MScKICAgICAgICAgICAgc2VsZi5nZW5yZV9saW5rID0gJ2h0dHA6Ly93d3cuaW1kYi5jb20vc2VhcmNoL3RpdGxlP3RpdGxlX3R5cGU9ZmVhdHVyZSx0dl9tb3ZpZSxkb2N1bWVudGFyeSZudW1fdm90ZXM9MTAwLCZyZWxlYXNlX2RhdGU9LGRhdGVbMF0mZ2VucmVzPSVzJnNvcnQ9bW92aWVtZXRlcixhc2MmY291bnQ9NDAmc3RhcnQ9MScKICAgICAgICAgICAgc2VsZi5sYW5ndWFnZV9saW5rID0gJ2h0dHA6Ly93d3cuaW1kYi5jb20vc2VhcmNoL3RpdGxlP3RpdGxlX3R5cGU9ZmVhdHVyZSx0dl9tb3ZpZSZudW1fdm90ZXM9MTAwLCZwcm9kdWN0aW9uX3N0YXR1cz1yZWxlYXNlZCZwcmltYXJ5X2xhbmd1YWdlPSVzJnNvcnQ9bW92aWVtZXRlcixhc2MmY291bnQ9NDAmc3RhcnQ9MScKICAgICAgICAgICAgc2VsZi5jZXJ0aWZpY2F0aW9uX2xpbmsgPSAnaHR0cDovL3d3dy5pbWRiLmNvbS9zZWFyY2gvdGl0bGU/dGl0bGVfdHlwZT1mZWF0dXJlLHR2X21vdmllJm51bV92b3Rlcz0xMDAsJnByb2R1Y3Rpb25fc3RhdHVzPXJlbGVhc2VkJmNlcnRpZmljYXRlcz11czolcyZzb3J0PW1vdmllbWV0ZXIsYXNjJmNvdW50PTQwJnN0YXJ0PTEnCiAgICAgICAgICAgIHNlbGYuYm94b2ZmaWNlX2xpbmsgPSAnaHR0cDovL3d3dy5pbWRiLmNvbS9zZWFyY2gvdGl0bGU/dGl0bGVfdHlwZT1mZWF0dXJlLHR2X21vdmllJnByb2R1Y3Rpb25fc3RhdHVzPXJlbGVhc2VkJnNvcnQ9Ym94b2ZmaWNlX2dyb3NzX3VzLGRlc2MmY291bnQ9NDAmc3RhcnQ9MScKCiAgICAgICAgc2VsZi5hZGRlZF9saW5rICA9ICdodHRwOi8vd3d3LmltZGIuY29tL3NlYXJjaC90aXRsZT90aXRsZV90eXBlPWZlYXR1cmUsdHZfbW92aWUmbGFuZ3VhZ2VzPWVuJm51bV92b3Rlcz01MDAsJnByb2R1Y3Rpb25fc3RhdHVzPXJlbGVhc2VkJnJlbGVhc2VfZGF0ZT0lcywlcyZzb3J0PXJlbGVhc2VfZGF0ZSxkZXNjJmNvdW50PTIwJnN0YXJ0PTEnICUgKHNlbGYueWVhcl9kYXRlLCBzZWxmLnRvZGF5X2RhdGUpCiAgICAgICAgc2VsZi50cmVuZGluZ19saW5rID0gJ2h0dHA6Ly9hcGkudHJha3QudHYvbW92aWVzL3RyZW5kaW5nP2xpbWl0PTQwJnBhZ2U9MScKICAgICAgICBzZWxmLnRyYWt0bGlzdHNfbGluayA9ICdodHRwOi8vYXBpLnRyYWt0LnR2L3VzZXJzL21lL2xpc3RzJwogICAgICAgIHNlbGYudHJha3RsaWtlZGxpc3RzX2xpbmsgPSAnaHR0cDovL2FwaS50cmFrdC50di91c2Vycy9saWtlcy9saXN0cz9saW1pdD0xMDAwMDAwJwogICAgICAgIHNlbGYudHJha3RsaXN0X2xpbmsgPSAnaHR0cDovL2FwaS50cmFrdC50di91c2Vycy8lcy9saXN0cy8lcy9pdGVtcycKICAgICAgICBzZWxmLnRyYWt0Y29sbGVjdGlvbl9saW5rID0gJ2h0dHA6Ly9hcGkudHJha3QudHYvdXNlcnMvbWUvY29sbGVjdGlvbi9tb3ZpZXMnCiAgICAgICAgc2VsZi50cmFrdHdhdGNobGlzdF9saW5rID0gJ2h0dHA6Ly9hcGkudHJha3QudHYvdXNlcnMvbWUvd2F0Y2hsaXN0L21vdmllcycKICAgICAgICBzZWxmLnRyYWt0ZmVhdHVyZWRfbGluayA9ICdodHRwOi8vYXBpLnRyYWt0LnR2L3JlY29tbWVuZGF0aW9ucy9tb3ZpZXM/bGltaXQ9NDAnCiAgICAgICAgc2VsZi50cmFrdGhpc3RvcnlfbGluayA9ICdodHRwOi8vYXBpLnRyYWt0LnR2L3VzZXJzL21lL2hpc3RvcnkvbW92aWVzP2xpbWl0PTQwJnBhZ2U9MScKICAgICAgICBzZWxmLmltZGJsaXN0c19saW5rID0gJ2h0dHA6Ly93d3cuaW1kYi5jb20vdXNlci91ciVzL2xpc3RzP3RhYj1hbGwmc29ydD1tZGZkJm9yZGVyPWRlc2MmZmlsdGVyPXRpdGxlcycgJSBzZWxmLmltZGJfdXNlcgogICAgICAgIHNlbGYuaW1kYmxpc3RfbGluayA9ICdodHRwOi8vd3d3LmltZGIuY29tL2xpc3QvJXMvP3ZpZXc9ZGV0YWlsJnNvcnQ9YWxwaGEsYXNjJnRpdGxlX3R5cGU9bW92aWUsc2hvcnQsdHZNb3ZpZSx0dlNwZWNpYWwsdmlkZW8mc3RhcnQ9MScKICAgICAgICBzZWxmLmltZGJsaXN0Ml9saW5rID0gJ2h0dHA6Ly93d3cuaW1kYi5jb20vbGlzdC8lcy8/dmlldz1kZXRhaWwmc29ydD1kYXRlX2FkZGVkLGRlc2MmdGl0bGVfdHlwZT1tb3ZpZSxzaG9ydCx0dk1vdmllLHR2U3BlY2lhbCx2aWRlbyZzdGFydD0xJwogICAgICAgIHNlbGYuaW1kYndhdGNobGlzdF9saW5rID0gJ2h0dHA6Ly93d3cuaW1kYi5jb20vdXNlci91ciVzL3dhdGNobGlzdD9zb3J0PWFscGhhLGFzYycgJSBzZWxmLmltZGJfdXNlcgogICAgICAgIHNlbGYuaW1kYndhdGNobGlzdDJfbGluayA9ICdodHRwOi8vd3d3LmltZGIuY29tL3VzZXIvdXIlcy93YXRjaGxpc3Q/c29ydD1kYXRlX2FkZGVkLGRlc2MnICUgc2VsZi5pbWRiX3VzZXIKCgogICAgZGVmIGdldChzZWxmLCB1cmwsIGlkeD1UcnVlLCBjcmVhdGVfZGlyZWN0b3J5PVRydWUpOgogICAgICAgIHRyeToKICAgICAgICAgICAgdHJ5OiB1cmwgPSBnZXRhdHRyKHNlbGYsIHVybCArICdfbGluaycpCiAgICAgICAgICAgIGV4Y2VwdDogcGFzcwoKICAgICAgICAgICAgdHJ5OiB1ID0gdXJscGFyc2UudXJscGFyc2UodXJsKS5uZXRsb2MubG93ZXIoKQogICAgICAgICAgICBleGNlcHQ6IHBhc3MKCgogICAgICAgICAgICBpZiB1IGluIHNlbGYudHJha3RfbGluayBhbmQgJy91c2Vycy8nIGluIHVybDoKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBpZiB1cmwgPT0gc2VsZi50cmFrdGhpc3RvcnlfbGluazogcmFpc2UgRXhjZXB0aW9uKCkKICAgICAgICAgICAgICAgICAgICBpZiBub3QgJy91c2Vycy9tZS8nIGluIHVybDogcmFpc2UgRXhjZXB0aW9uKCkKICAgICAgICAgICAgICAgICAgICBpZiB0cmFrdC5nZXRBY3Rpdml0eSgpID4gY2FjaGUudGltZW91dChzZWxmLnRyYWt0X2xpc3QsIHVybCwgc2VsZi50cmFrdF91c2VyKTogcmFpc2UgRXhjZXB0aW9uKCkKICAgICAgICAgICAgICAgICAgICBzZWxmLmxpc3QgPSBjYWNoZS5nZXQoc2VsZi50cmFrdF9saXN0LCA3MjAsIHVybCwgc2VsZi50cmFrdF91c2VyKQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHNlbGYubGlzdCA9IGNhY2hlLmdldChzZWxmLnRyYWt0X2xpc3QsIDAsIHVybCwgc2VsZi50cmFrdF91c2VyKQoKICAgICAgICAgICAgICAgIGlmICcvdXNlcnMvbWUvJyBpbiB1cmwgYW5kICcvY29sbGVjdGlvbi8nIGluIHVybDoKICAgICAgICAgICAgICAgICAgICBzZWxmLmxpc3QgPSBzb3J0ZWQoc2VsZi5saXN0LCBrZXk9bGFtYmRhIGs6IHV0aWxzLnRpdGxlX2tleShrWyd0aXRsZSddKSkKCiAgICAgICAgICAgICAgICBpZiBpZHggPT0gVHJ1ZTogc2VsZi53b3JrZXIoKQoKICAgICAgICAgICAgZWxpZiB1IGluIHNlbGYudHJha3RfbGluayBhbmQgc2VsZi5zZWFyY2hfbGluayBpbiB1cmw6CiAgICAgICAgICAgICAgICBzZWxmLmxpc3QgPSBjYWNoZS5nZXQoc2VsZi50cmFrdF9saXN0LCAxLCB1cmwsIHNlbGYudHJha3RfdXNlcikKICAgICAgICAgICAgICAgIGlmIGlkeCA9PSBUcnVlOiBzZWxmLndvcmtlcihsZXZlbD0wKQoKICAgICAgICAgICAgZWxpZiB1IGluIHNlbGYudHJha3RfbGluazoKICAgICAgICAgICAgICAgIHNlbGYubGlzdCA9IGNhY2hlLmdldChzZWxmLnRyYWt0X2xpc3QsIDI0LCB1cmwsIHNlbGYudHJha3RfdXNlcikKICAgICAgICAgICAgICAgIGlmIGlkeCA9PSBUcnVlOiBzZWxmLndvcmtlcigpCgoKICAgICAgICAgICAgZWxpZiB1IGluIHNlbGYuaW1kYl9saW5rIGFuZCAoJy91c2VyLycgaW4gdXJsIG9yICcvbGlzdC8nIGluIHVybCk6CiAgICAgICAgICAgICAgICBzZWxmLmxpc3QgPSBjYWNoZS5nZXQoc2VsZi5pbWRiX2xpc3QsIDAsIHVybCkKICAgICAgICAgICAgICAgIGlmIGlkeCA9PSBUcnVlOiBzZWxmLndvcmtlcigpCgogICAgICAgICAgICBlbGlmIHUgaW4gc2VsZi5pbWRiX2xpbms6CiAgICAgICAgICAgICAgICBzZWxmLmxpc3QgPSBjYWNoZS5nZXQoc2VsZi5pbWRiX2xpc3QsIDI0LCB1cmwpCiAgICAgICAgICAgICAgICBpZiBpZHggPT0gVHJ1ZTogc2VsZi53b3JrZXIoKQoKCiAgICAgICAgICAgIGlmIGlkeCA9PSBUcnVlIGFuZCBjcmVhdGVfZGlyZWN0b3J5ID09IFRydWU6IHNlbGYubW92aWVEaXJlY3Rvcnkoc2VsZi5saXN0KQogICAgICAgICAgICByZXR1cm4gc2VsZi5saXN0CiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCgoKICAgIGRlZiB3aWRnZXQoc2VsZik6CiAgICAgICAgc2V0dGluZyA9IGNvbnRyb2wuc2V0dGluZygnbW92aWUud2lkZ2V0JykKCiAgICAgICAgaWYgc2V0dGluZyA9PSAnMic6CiAgICAgICAgICAgIHNlbGYuZ2V0KHNlbGYudHJlbmRpbmdfbGluaykKICAgICAgICBlbGlmIHNldHRpbmcgPT0gJzMnOgogICAgICAgICAgICBzZWxmLmdldChzZWxmLnBvcHVsYXJfbGluaykKICAgICAgICBlbGlmIHNldHRpbmcgPT0gJzQnOgogICAgICAgICAgICBzZWxmLmdldChzZWxmLnRoZWF0ZXJzX2xpbmspCiAgICAgICAgZWxpZiBzZXR0aW5nID09ICc1JzoKICAgICAgICAgICAgc2VsZi5nZXQoc2VsZi5hZGRlZF9saW5rKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHNlbGYuZ2V0KHNlbGYuZmVhdHVyZWRfbGluaykKCiAgICBkZWYgc2VhcmNoKHNlbGYpOgogICAgICAgIG5hdmlnYXRvci5uYXZpZ2F0b3IoKS5hZGREaXJlY3RvcnlJdGVtKDMyNjAzLCAnbW92aWVTZWFyY2huZXcnLCAnc2VhcmNoLnBuZycsICdEZWZhdWx0TW92aWVzLnBuZycpCiAgICAgICAgc2VhcmNoX2hpc3RvcnkgPSBjb250cm9sLnNldHRpbmcoJ21vdmllc2VhcmNoJykKICAgICAgICBpZiBzZWFyY2hfaGlzdG9yeToKICAgICAgICAgICAgZm9yIHRlcm0gaW4gc2VhcmNoX2hpc3Rvcnkuc3BsaXQoJ1xuJyk6CiAgICAgICAgICAgICAgICBpZiB0ZXJtOgogICAgICAgICAgICAgICAgICAgIG5hdmlnYXRvci5uYXZpZ2F0b3IoKS5hZGREaXJlY3RvcnlJdGVtKHRlcm0sICdtb3ZpZVNlYXJjaHRlcm0mbmFtZT0lcycgJSB0ZXJtLCAnc2VhcmNoLnBuZycsICdEZWZhdWx0TW92aWVzLnBuZycpCiAgICAgICAgICAgIG5hdmlnYXRvci5uYXZpZ2F0b3IoKS5hZGREaXJlY3RvcnlJdGVtKDMyNjA1LCAnY2xlYXJDYWNoZVNlYXJjaCcsICd0b29scy5wbmcnLCAnRGVmYXVsdEFkZG9uUHJvZ3JhbS5wbmcnKQogICAgICAgIG5hdmlnYXRvci5uYXZpZ2F0b3IoKS5lbmREaXJlY3RvcnkoKSAgICAgICAgCiAgICAgICAgCiAgICAgICAgCiAgICBkZWYgc2VhcmNoX25ldyhzZWxmKToKICAgICAgICB0ID0gY29udHJvbC5sYW5nKDMyMDEwKS5lbmNvZGUoJ3V0Zi04JykKICAgICAgICBrID0gY29udHJvbC5rZXlib2FyZCgnJywgdCkgOyBrLmRvTW9kYWwoKQogICAgICAgIHEgPSBrLmdldFRleHQoKS5zdHJpcCgpIGlmIGsuaXNDb25maXJtZWQoKSBlbHNlIE5vbmUKICAgICAgICBpZiBub3QgcTogcmV0dXJuCgoKICAgICAgICBzZWFyY2hfaGlzdG9yeSA9IGNvbnRyb2wuc2V0dGluZygnbW92aWVzZWFyY2gnKQogICAgICAgIGlmIHEgbm90IGluIHNlYXJjaF9oaXN0b3J5LnNwbGl0KCdcbicpOgogICAgICAgICAgICBjb250cm9sLnNldFNldHRpbmcoJ21vdmllc2VhcmNoJywgcSArICdcbicgKyBzZWFyY2hfaGlzdG9yeSkKCgogICAgICAgIHVybCA9IHNlbGYuc2VhcmNoX2xpbmsgKyB1cmxsaWIucXVvdGVfcGx1cyhxKQogICAgICAgIHNlbGYuZ2V0KHVybCkKICAgICAgICAgICAgCiAgICAgICAgICAgIAogICAgZGVmIHNlYXJjaF90ZXJtKHNlbGYsIG5hbWUpOgogICAgICAgIHVybCA9IHNlbGYuc2VhcmNoX2xpbmsgKyB1cmxsaWIucXVvdGVfcGx1cyhuYW1lKQogICAgICAgIHNlbGYuZ2V0KHVybCkKICAgICAgICAKICAgICAgICAKICAgIGRlZiBwZXJzb24oc2VsZik6CiAgICAgICAgdCA9IGNvbnRyb2wubGFuZygzMjAxMCkuZW5jb2RlKCd1dGYtOCcpCiAgICAgICAgayA9IGNvbnRyb2wua2V5Ym9hcmQoJycsIHQpIDsgay5kb01vZGFsKCkKICAgICAgICBxID0gay5nZXRUZXh0KCkuc3RyaXAoKSBpZiBrLmlzQ29uZmlybWVkKCkgZWxzZSBOb25lCiAgICAgICAgaWYgbm90IHE6IHJldHVybgoKCiAgICAgICAgdXJsID0gc2VsZi5wZXJzb25zX2xpbmsgKyB1cmxsaWIucXVvdGVfcGx1cyhxKQogICAgICAgIHNlbGYucGVyc29ucyh1cmwpCgoKICAgIGRlZiBnZW5yZXMoc2VsZik6CiAgICAgICAgZ2VucmVzID0gWwogICAgICAgICAgICAoJ0FjdGlvbicsICdhY3Rpb24nLCBUcnVlKSwKICAgICAgICAgICAgKCdBZHZlbnR1cmUnLCAnYWR2ZW50dXJlJywgVHJ1ZSksCiAgICAgICAgICAgICgnQW5pbWF0aW9uJywgJ2FuaW1hdGlvbicsIFRydWUpLAogICAgICAgICAgICAoJ0FuaW1lJywgJ2FuaW1lJywgRmFsc2UpLAogICAgICAgICAgICAoJ0Jpb2dyYXBoeScsICdiaW9ncmFwaHknLCBUcnVlKSwKICAgICAgICAgICAgKCdDb21lZHknLCAnY29tZWR5JywgVHJ1ZSksCiAgICAgICAgICAgICgnQ3JpbWUnLCAnY3JpbWUnLCBUcnVlKSwKICAgICAgICAgICAgKCdEb2N1bWVudGFyeScsICdkb2N1bWVudGFyeScsIFRydWUpLAogICAgICAgICAgICAoJ0RyYW1hJywgJ2RyYW1hJywgVHJ1ZSksCiAgICAgICAgICAgICgnRmFtaWx5JywgJ2ZhbWlseScsIFRydWUpLAogICAgICAgICAgICAoJ0ZhbnRhc3knLCAnZmFudGFzeScsIFRydWUpLAogICAgICAgICAgICAoJ0hpc3RvcnknLCAnaGlzdG9yeScsIFRydWUpLAogICAgICAgICAgICAoJ0hvcnJvcicsICdob3Jyb3InLCBUcnVlKSwKICAgICAgICAgICAgKCdNdXNpYyAnLCAnbXVzaWMnLCBUcnVlKSwKICAgICAgICAgICAgKCdNdXNpY2FsJywgJ211c2ljYWwnLCBUcnVlKSwKICAgICAgICAgICAgKCdNeXN0ZXJ5JywgJ215c3RlcnknLCBUcnVlKSwKICAgICAgICAgICAgKCdSb21hbmNlJywgJ3JvbWFuY2UnLCBUcnVlKSwKICAgICAgICAgICAgKCdTY2llbmNlIEZpY3Rpb24nLCAnc2NpX2ZpJywgVHJ1ZSksCiAgICAgICAgICAgICgnU3BvcnQnLCAnc3BvcnQnLCBUcnVlKSwKICAgICAgICAgICAgKCdUaHJpbGxlcicsICd0aHJpbGxlcicsIFRydWUpLAogICAgICAgICAgICAoJ1dhcicsICd3YXInLCBUcnVlKSwKICAgICAgICAgICAgKCdXZXN0ZXJuJywgJ3dlc3Rlcm4nLCBUcnVlKQogICAgICAgIF0KCiAgICAgICAgZm9yIGkgaW4gZ2VucmVzOiBzZWxmLmxpc3QuYXBwZW5kKAogICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAnbmFtZSc6IGNsZWFuZ2VucmUubGFuZyhpWzBdLCBzZWxmLmxhbmcpLAogICAgICAgICAgICAgICAgJ3VybCc6IHNlbGYuZ2VucmVfbGluayAlIGlbMV0gaWYgaVsyXSBlbHNlIHNlbGYua2V5d29yZF9saW5rICUgaVsxXSwKICAgICAgICAgICAgICAgICdpbWFnZSc6ICdnZW5yZXMucG5nJywKICAgICAgICAgICAgICAgICdhY3Rpb24nOiAnbW92aWVzJwogICAgICAgICAgICB9KQoKICAgICAgICBzZWxmLmFkZERpcmVjdG9yeShzZWxmLmxpc3QpCiAgICAgICAgcmV0dXJuIHNlbGYubGlzdAoKCiAgICBkZWYgbGFuZ3VhZ2VzKHNlbGYpOgogICAgICAgIGxhbmd1YWdlcyA9IFsKICAgICAgICAgICAgKCdBcmFiaWMnLCAnYXInKSwKICAgICAgICAgICAgKCdCb3NuaWFuJywgJ2JzJyksCiAgICAgICAgICAgICgnQnVsZ2FyaWFuJywgJ2JnJyksCiAgICAgICAgICAgICgnQ2hpbmVzZScsICd6aCcpLAogICAgICAgICAgICAoJ0Nyb2F0aWFuJywgJ2hyJyksCiAgICAgICAgICAgICgnRHV0Y2gnLCAnbmwnKSwKICAgICAgICAgICAgKCdFbmdsaXNoJywgJ2VuJyksCiAgICAgICAgICAgICgnRmlubmlzaCcsICdmaScpLAogICAgICAgICAgICAoJ0ZyZW5jaCcsICdmcicpLAogICAgICAgICAgICAoJ0dlcm1hbicsICdkZScpLAogICAgICAgICAgICAoJ0dyZWVrJywgJ2VsJyksCiAgICAgICAgICAgICgnSGVicmV3JywgJ2hlJyksCiAgICAgICAgICAgICgnSGluZGkgJywgJ2hpJyksCiAgICAgICAgICAgICgnSHVuZ2FyaWFuJywgJ2h1JyksCiAgICAgICAgICAgICgnSWNlbGFuZGljJywgJ2lzJyksCiAgICAgICAgICAgICgnSXRhbGlhbicsICdpdCcpLAogICAgICAgICAgICAoJ0phcGFuZXNlJywgJ2phJyksCiAgICAgICAgICAgICgnS29yZWFuJywgJ2tvJyksCiAgICAgICAgICAgICgnTWFjZWRvbmlhbicsICdtaycpLAogICAgICAgICAgICAoJ05vcndlZ2lhbicsICdubycpLAogICAgICAgICAgICAoJ1BlcnNpYW4nLCAnZmEnKSwKICAgICAgICAgICAgKCdQb2xpc2gnLCAncGwnKSwKICAgICAgICAgICAgKCdQb3J0dWd1ZXNlJywgJ3B0JyksCiAgICAgICAgICAgICgnUHVuamFiaScsICdwYScpLAogICAgICAgICAgICAoJ1JvbWFuaWFuJywgJ3JvJyksCiAgICAgICAgICAgICgnUnVzc2lhbicsICdydScpLAogICAgICAgICAgICAoJ1NlcmJpYW4nLCAnc3InKSwKICAgICAgICAgICAgKCdTbG92ZW5pYW4nLCAnc2wnKSwKICAgICAgICAgICAgKCdTcGFuaXNoJywgJ2VzJyksCiAgICAgICAgICAgICgnU3dlZGlzaCcsICdzdicpLAogICAgICAgICAgICAoJ1R1cmtpc2gnLCAndHInKSwKICAgICAgICAgICAgKCdVa3JhaW5pYW4nLCAndWsnKQogICAgICAgIF0KCiAgICAgICAgZm9yIGkgaW4gbGFuZ3VhZ2VzOiBzZWxmLmxpc3QuYXBwZW5kKHsnbmFtZSc6IHN0cihpWzBdKSwgJ3VybCc6IHNlbGYubGFuZ3VhZ2VfbGluayAlIGlbMV0sICdpbWFnZSc6ICdsYW5ndWFnZXMucG5nJywgJ2FjdGlvbic6ICdtb3ZpZXMnfSkKICAgICAgICBzZWxmLmFkZERpcmVjdG9yeShzZWxmLmxpc3QpCiAgICAgICAgcmV0dXJuIHNlbGYubGlzdAoKCiAgICBkZWYgY2VydGlmaWNhdGlvbnMoc2VsZik6CiAgICAgICAgY2VydGlmaWNhdGVzID0gWydHJywgJ1BHJywgJ1BHLTEzJywgJ1InLCAnTkMtMTcnXQoKICAgICAgICBmb3IgaSBpbiBjZXJ0aWZpY2F0ZXM6IHNlbGYubGlzdC5hcHBlbmQoeyduYW1lJzogc3RyKGkpLCAndXJsJzogc2VsZi5jZXJ0aWZpY2F0aW9uX2xpbmsgJSBzdHIoaSkucmVwbGFjZSgnLScsICdfJykubG93ZXIoKSwgJ2ltYWdlJzogJ2NlcnRpZmljYXRlcy5wbmcnLCAnYWN0aW9uJzogJ21vdmllcyd9KQogICAgICAgIHNlbGYuYWRkRGlyZWN0b3J5KHNlbGYubGlzdCkKICAgICAgICByZXR1cm4gc2VsZi5saXN0CgoKICAgIGRlZiB5ZWFycyhzZWxmKToKICAgICAgICB5ZWFyID0gKHNlbGYuZGF0ZXRpbWUuc3RyZnRpbWUoJyVZJykpCgogICAgICAgIGZvciBpIGluIHJhbmdlKGludCh5ZWFyKS0wLCAxOTAwLCAtMSk6IHNlbGYubGlzdC5hcHBlbmQoeyduYW1lJzogc3RyKGkpLCAndXJsJzogc2VsZi55ZWFyX2xpbmsgJSAoc3RyKGkpLCBzdHIoaSkpLCAnaW1hZ2UnOiAneWVhcnMucG5nJywgJ2FjdGlvbic6ICdtb3ZpZXMnfSkKICAgICAgICBzZWxmLmFkZERpcmVjdG9yeShzZWxmLmxpc3QpCiAgICAgICAgcmV0dXJuIHNlbGYubGlzdAoKCiAgICBkZWYgcGVyc29ucyhzZWxmLCB1cmwpOgogICAgICAgIGlmIHVybCA9PSBOb25lOgogICAgICAgICAgICBzZWxmLmxpc3QgPSBjYWNoZS5nZXQoc2VsZi5pbWRiX3BlcnNvbl9saXN0LCAyNCwgc2VsZi5wZXJzb25saXN0X2xpbmspCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VsZi5saXN0ID0gY2FjaGUuZ2V0KHNlbGYuaW1kYl9wZXJzb25fbGlzdCwgMSwgdXJsKQoKICAgICAgICBmb3IgaSBpbiByYW5nZSgwLCBsZW4oc2VsZi5saXN0KSk6IHNlbGYubGlzdFtpXS51cGRhdGUoeydhY3Rpb24nOiAnbW92aWVzJ30pCiAgICAgICAgc2VsZi5hZGREaXJlY3Rvcnkoc2VsZi5saXN0KQogICAgICAgIHJldHVybiBzZWxmLmxpc3QKCgogICAgZGVmIHVzZXJsaXN0cyhzZWxmKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHVzZXJsaXN0cyA9IFtdCiAgICAgICAgICAgIGlmIHRyYWt0LmdldFRyYWt0Q3JlZGVudGlhbHNJbmZvKCkgPT0gRmFsc2U6IHJhaXNlIEV4Y2VwdGlvbigpCiAgICAgICAgICAgIGFjdGl2aXR5ID0gdHJha3QuZ2V0QWN0aXZpdHkoKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwoKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIHRyYWt0LmdldFRyYWt0Q3JlZGVudGlhbHNJbmZvKCkgPT0gRmFsc2U6IHJhaXNlIEV4Y2VwdGlvbigpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlmIGFjdGl2aXR5ID4gY2FjaGUudGltZW91dChzZWxmLnRyYWt0X3VzZXJfbGlzdCwgc2VsZi50cmFrdGxpc3RzX2xpbmssIHNlbGYudHJha3RfdXNlcik6IHJhaXNlIEV4Y2VwdGlvbigpCiAgICAgICAgICAgICAgICB1c2VybGlzdHMgKz0gY2FjaGUuZ2V0KHNlbGYudHJha3RfdXNlcl9saXN0LCA3MjAsIHNlbGYudHJha3RsaXN0c19saW5rLCBzZWxmLnRyYWt0X3VzZXIpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHVzZXJsaXN0cyArPSBjYWNoZS5nZXQoc2VsZi50cmFrdF91c2VyX2xpc3QsIDAsIHNlbGYudHJha3RsaXN0c19saW5rLCBzZWxmLnRyYWt0X3VzZXIpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzZWxmLmxpc3QgPSBbXQogICAgICAgICAgICBpZiBzZWxmLmltZGJfdXNlciA9PSAnJzogcmFpc2UgRXhjZXB0aW9uKCkKICAgICAgICAgICAgdXNlcmxpc3RzICs9IGNhY2hlLmdldChzZWxmLmltZGJfdXNlcl9saXN0LCAwLCBzZWxmLmltZGJsaXN0c19saW5rKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwogICAgICAgIHRyeToKICAgICAgICAgICAgc2VsZi5saXN0ID0gW10KICAgICAgICAgICAgaWYgdHJha3QuZ2V0VHJha3RDcmVkZW50aWFsc0luZm8oKSA9PSBGYWxzZTogcmFpc2UgRXhjZXB0aW9uKCkKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaWYgYWN0aXZpdHkgPiBjYWNoZS50aW1lb3V0KHNlbGYudHJha3RfdXNlcl9saXN0LCBzZWxmLnRyYWt0bGlrZWRsaXN0c19saW5rLCBzZWxmLnRyYWt0X3VzZXIpOiByYWlzZSBFeGNlcHRpb24oKQogICAgICAgICAgICAgICAgdXNlcmxpc3RzICs9IGNhY2hlLmdldChzZWxmLnRyYWt0X3VzZXJfbGlzdCwgNzIwLCBzZWxmLnRyYWt0bGlrZWRsaXN0c19saW5rLCBzZWxmLnRyYWt0X3VzZXIpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHVzZXJsaXN0cyArPSBjYWNoZS5nZXQoc2VsZi50cmFrdF91c2VyX2xpc3QsIDAsIHNlbGYudHJha3RsaWtlZGxpc3RzX2xpbmssIHNlbGYudHJha3RfdXNlcikKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHBhc3MKCiAgICAgICAgc2VsZi5saXN0ID0gdXNlcmxpc3RzCiAgICAgICAgZm9yIGkgaW4gcmFuZ2UoMCwgbGVuKHNlbGYubGlzdCkpOiBzZWxmLmxpc3RbaV0udXBkYXRlKHsnaW1hZ2UnOiAndXNlcmxpc3RzLnBuZycsICdhY3Rpb24nOiAnbW92aWVzJ30pCiAgICAgICAgc2VsZi5hZGREaXJlY3Rvcnkoc2VsZi5saXN0LCBxdWV1ZT1UcnVlKQogICAgICAgIHJldHVybiBzZWxmLmxpc3QKCgogICAgZGVmIHRyYWt0X2xpc3Qoc2VsZiwgdXJsLCB1c2VyKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHEgPSBkaWN0KHVybHBhcnNlLnBhcnNlX3FzbCh1cmxwYXJzZS51cmxzcGxpdCh1cmwpLnF1ZXJ5KSkKICAgICAgICAgICAgcS51cGRhdGUoeydleHRlbmRlZCc6ICdmdWxsJ30pCiAgICAgICAgICAgIHEgPSAodXJsbGliLnVybGVuY29kZShxKSkucmVwbGFjZSgnJTJDJywgJywnKQogICAgICAgICAgICB1ID0gdXJsLnJlcGxhY2UoJz8nICsgdXJscGFyc2UudXJscGFyc2UodXJsKS5xdWVyeSwgJycpICsgJz8nICsgcQoKICAgICAgICAgICAgcmVzdWx0ID0gdHJha3QuZ2V0VHJha3RBc0pzb24odSkKCiAgICAgICAgICAgIGl0ZW1zID0gW10KICAgICAgICAgICAgZm9yIGkgaW4gcmVzdWx0OgogICAgICAgICAgICAgICAgdHJ5OiBpdGVtcy5hcHBlbmQoaVsnbW92aWUnXSkKICAgICAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICBpZiBsZW4oaXRlbXMpID09IDA6CiAgICAgICAgICAgICAgICBpdGVtcyA9IHJlc3VsdAogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIHRyeToKICAgICAgICAgICAgcSA9IGRpY3QodXJscGFyc2UucGFyc2VfcXNsKHVybHBhcnNlLnVybHNwbGl0KHVybCkucXVlcnkpKQogICAgICAgICAgICBpZiBub3QgaW50KHFbJ2xpbWl0J10pID09IGxlbihpdGVtcyk6IHJhaXNlIEV4Y2VwdGlvbigpCiAgICAgICAgICAgIHEudXBkYXRlKHsncGFnZSc6IHN0cihpbnQocVsncGFnZSddKSArIDEpfSkKICAgICAgICAgICAgcSA9ICh1cmxsaWIudXJsZW5jb2RlKHEpKS5yZXBsYWNlKCclMkMnLCAnLCcpCiAgICAgICAgICAgIG5leHQgPSB1cmwucmVwbGFjZSgnPycgKyB1cmxwYXJzZS51cmxwYXJzZSh1cmwpLnF1ZXJ5LCAnJykgKyAnPycgKyBxCiAgICAgICAgICAgIG5leHQgPSBuZXh0LmVuY29kZSgndXRmLTgnKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgbmV4dCA9ICcnCgogICAgICAgIGZvciBpdGVtIGluIGl0ZW1zOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB0aXRsZSA9IGl0ZW1bJ3RpdGxlJ10KICAgICAgICAgICAgICAgIHRpdGxlID0gY2xpZW50LnJlcGxhY2VIVE1MQ29kZXModGl0bGUpCgogICAgICAgICAgICAgICAgeWVhciA9IGl0ZW1bJ3llYXInXQogICAgICAgICAgICAgICAgeWVhciA9IHJlLnN1YignW14wLTldJywgJycsIHN0cih5ZWFyKSkKCiAgICAgICAgICAgICAgICBpZiBpbnQoeWVhcikgPiBpbnQoKHNlbGYuZGF0ZXRpbWUpLnN0cmZ0aW1lKCclWScpKTogcmFpc2UgRXhjZXB0aW9uKCkKCiAgICAgICAgICAgICAgICBpbWRiID0gaXRlbVsnaWRzJ11bJ2ltZGInXQogICAgICAgICAgICAgICAgaWYgaW1kYiA9PSBOb25lIG9yIGltZGIgPT0gJyc6IHJhaXNlIEV4Y2VwdGlvbigpCiAgICAgICAgICAgICAgICBpbWRiID0gJ3R0JyArIHJlLnN1YignW14wLTldJywgJycsIHN0cihpbWRiKSkKCiAgICAgICAgICAgICAgICB0bWRiID0gc3RyKGl0ZW0uZ2V0KCdpZHMnLCB7fSkuZ2V0KCd0bWRiJywgMCkpCgogICAgICAgICAgICAgICAgdHJ5OiBwcmVtaWVyZWQgPSBpdGVtWydyZWxlYXNlZCddCiAgICAgICAgICAgICAgICBleGNlcHQ6IHByZW1pZXJlZCA9ICcwJwogICAgICAgICAgICAgICAgdHJ5OiBwcmVtaWVyZWQgPSByZS5jb21waWxlKCcoXGR7NH0tXGR7Mn0tXGR7Mn0pJykuZmluZGFsbChwcmVtaWVyZWQpWzBdCiAgICAgICAgICAgICAgICBleGNlcHQ6IHByZW1pZXJlZCA9ICcwJwoKICAgICAgICAgICAgICAgIHRyeTogZ2VucmUgPSBpdGVtWydnZW5yZXMnXQogICAgICAgICAgICAgICAgZXhjZXB0OiBnZW5yZSA9ICcwJwogICAgICAgICAgICAgICAgZ2VucmUgPSBbaS50aXRsZSgpIGZvciBpIGluIGdlbnJlXQogICAgICAgICAgICAgICAgaWYgZ2VucmUgPT0gW106IGdlbnJlID0gJzAnCiAgICAgICAgICAgICAgICBnZW5yZSA9ICcgLyAnLmpvaW4oZ2VucmUpCgogICAgICAgICAgICAgICAgdHJ5OiBkdXJhdGlvbiA9IHN0cihpdGVtWydydW50aW1lJ10pCiAgICAgICAgICAgICAgICBleGNlcHQ6IGR1cmF0aW9uID0gJzAnCiAgICAgICAgICAgICAgICBpZiBkdXJhdGlvbiA9PSBOb25lOiBkdXJhdGlvbiA9ICcwJwoKICAgICAgICAgICAgICAgIHRyeTogcmF0aW5nID0gc3RyKGl0ZW1bJ3JhdGluZyddKQogICAgICAgICAgICAgICAgZXhjZXB0OiByYXRpbmcgPSAnMCcKICAgICAgICAgICAgICAgIGlmIHJhdGluZyA9PSBOb25lIG9yIHJhdGluZyA9PSAnMC4wJzogcmF0aW5nID0gJzAnCgogICAgICAgICAgICAgICAgdHJ5OiB2b3RlcyA9IHN0cihpdGVtWyd2b3RlcyddKQogICAgICAgICAgICAgICAgZXhjZXB0OiB2b3RlcyA9ICcwJwogICAgICAgICAgICAgICAgdHJ5OiB2b3RlcyA9IHN0cihmb3JtYXQoaW50KHZvdGVzKSwnLGQnKSkKICAgICAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICAgICAgaWYgdm90ZXMgPT0gTm9uZTogdm90ZXMgPSAnMCcKCiAgICAgICAgICAgICAgICB0cnk6IG1wYWEgPSBpdGVtWydjZXJ0aWZpY2F0aW9uJ10KICAgICAgICAgICAgICAgIGV4Y2VwdDogbXBhYSA9ICcwJwogICAgICAgICAgICAgICAgaWYgbXBhYSA9PSBOb25lOiBtcGFhID0gJzAnCgogICAgICAgICAgICAgICAgdHJ5OiBwbG90ID0gaXRlbVsnb3ZlcnZpZXcnXQogICAgICAgICAgICAgICAgZXhjZXB0OiBwbG90ID0gJzAnCiAgICAgICAgICAgICAgICBpZiBwbG90ID09IE5vbmU6IHBsb3QgPSAnMCcKICAgICAgICAgICAgICAgIHBsb3QgPSBjbGllbnQucmVwbGFjZUhUTUxDb2RlcyhwbG90KQoKICAgICAgICAgICAgICAgIHRyeTogdGFnbGluZSA9IGl0ZW1bJ3RhZ2xpbmUnXQogICAgICAgICAgICAgICAgZXhjZXB0OiB0YWdsaW5lID0gJzAnCiAgICAgICAgICAgICAgICBpZiB0YWdsaW5lID09IE5vbmU6IHRhZ2xpbmUgPSAnMCcKICAgICAgICAgICAgICAgIHRhZ2xpbmUgPSBjbGllbnQucmVwbGFjZUhUTUxDb2Rlcyh0YWdsaW5lKQoKICAgICAgICAgICAgICAgIHNlbGYubGlzdC5hcHBlbmQoeyd0aXRsZSc6IHRpdGxlLCAnb3JpZ2luYWx0aXRsZSc6IHRpdGxlLCAneWVhcic6IHllYXIsICdwcmVtaWVyZWQnOiBwcmVtaWVyZWQsICdnZW5yZSc6IGdlbnJlLCAnZHVyYXRpb24nOiBkdXJhdGlvbiwgJ3JhdGluZyc6IHJhdGluZywgJ3ZvdGVzJzogdm90ZXMsICdtcGFhJzogbXBhYSwgJ3Bsb3QnOiBwbG90LCAndGFnbGluZSc6IHRhZ2xpbmUsICdpbWRiJzogaW1kYiwgJ3RtZGInOiB0bWRiLCAndHZkYic6ICcwJywgJ3Bvc3Rlcic6ICcwJywgJ25leHQnOiBuZXh0fSkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwoKICAgICAgICByZXR1cm4gc2VsZi5saXN0CgoKICAgIGRlZiB0cmFrdF91c2VyX2xpc3Qoc2VsZiwgdXJsLCB1c2VyKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGl0ZW1zID0gdHJha3QuZ2V0VHJha3RBc0pzb24odXJsKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwoKICAgICAgICBmb3IgaXRlbSBpbiBpdGVtczoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgdHJ5OiBuYW1lID0gaXRlbVsnbGlzdCddWyduYW1lJ10KICAgICAgICAgICAgICAgIGV4Y2VwdDogbmFtZSA9IGl0ZW1bJ25hbWUnXQogICAgICAgICAgICAgICAgbmFtZSA9IGNsaWVudC5yZXBsYWNlSFRNTENvZGVzKG5hbWUpCgogICAgICAgICAgICAgICAgdHJ5OiB1cmwgPSAodHJha3Quc2x1ZyhpdGVtWydsaXN0J11bJ3VzZXInXVsndXNlcm5hbWUnXSksIGl0ZW1bJ2xpc3QnXVsnaWRzJ11bJ3NsdWcnXSkKICAgICAgICAgICAgICAgIGV4Y2VwdDogdXJsID0gKCdtZScsIGl0ZW1bJ2lkcyddWydzbHVnJ10pCiAgICAgICAgICAgICAgICB1cmwgPSBzZWxmLnRyYWt0bGlzdF9saW5rICUgdXJsCiAgICAgICAgICAgICAgICB1cmwgPSB1cmwuZW5jb2RlKCd1dGYtOCcpCgogICAgICAgICAgICAgICAgc2VsZi5saXN0LmFwcGVuZCh7J25hbWUnOiBuYW1lLCAndXJsJzogdXJsLCAnY29udGV4dCc6IHVybH0pCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKCiAgICAgICAgc2VsZi5saXN0ID0gc29ydGVkKHNlbGYubGlzdCwga2V5PWxhbWJkYSBrOiB1dGlscy50aXRsZV9rZXkoa1snbmFtZSddKSkKICAgICAgICByZXR1cm4gc2VsZi5saXN0CgoKICAgIGRlZiBpbWRiX2xpc3Qoc2VsZiwgdXJsKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGZvciBpIGluIHJlLmZpbmRhbGwoJ2RhdGVcWyhcZCspXF0nLCB1cmwpOgogICAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UoJ2RhdGVbJXNdJyAlIGksIChzZWxmLmRhdGV0aW1lIC0gZGF0ZXRpbWUudGltZWRlbHRhKGRheXMgPSBpbnQoaSkpKS5zdHJmdGltZSgnJVktJW0tJWQnKSkKCiAgICAgICAgICAgIGRlZiBpbWRiX3dhdGNobGlzdF9pZCh1cmwpOgogICAgICAgICAgICAgICAgcmV0dXJuIGNsaWVudC5wYXJzZURPTShjbGllbnQucmVxdWVzdCh1cmwpLCAnbWV0YScsIHJldD0nY29udGVudCcsIGF0dHJzID0geydwcm9wZXJ0eSc6ICdwYWdlSWQnfSlbMF0KCiAgICAgICAgICAgIGlmIHVybCA9PSBzZWxmLmltZGJ3YXRjaGxpc3RfbGluazoKICAgICAgICAgICAgICAgIHVybCA9IGNhY2hlLmdldChpbWRiX3dhdGNobGlzdF9pZCwgODY0MCwgdXJsKQogICAgICAgICAgICAgICAgdXJsID0gc2VsZi5pbWRibGlzdF9saW5rICUgdXJsCgogICAgICAgICAgICBlbGlmIHVybCA9PSBzZWxmLmltZGJ3YXRjaGxpc3QyX2xpbms6CiAgICAgICAgICAgICAgICB1cmwgPSBjYWNoZS5nZXQoaW1kYl93YXRjaGxpc3RfaWQsIDg2NDAsIHVybCkKICAgICAgICAgICAgICAgIHVybCA9IHNlbGYuaW1kYmxpc3QyX2xpbmsgJSB1cmwKCiAgICAgICAgICAgIHJlc3VsdCA9IGNsaWVudC5yZXF1ZXN0KHVybCkKCiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdC5yZXBsYWNlKCdcbicsICcgJykKCiAgICAgICAgICAgIGl0ZW1zID0gY2xpZW50LnBhcnNlRE9NKHJlc3VsdCwgJ2RpdicsIGF0dHJzID0geydjbGFzcyc6ICdsaXN0ZXItaXRlbSAuKz8nfSkKICAgICAgICAgICAgaXRlbXMgKz0gY2xpZW50LnBhcnNlRE9NKHJlc3VsdCwgJ2RpdicsIGF0dHJzID0geydjbGFzcyc6ICdsaXN0X2l0ZW0uKz8nfSkKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHJldHVybgoKICAgICAgICB0cnk6CiAgICAgICAgICAgIG5leHQgPSBjbGllbnQucGFyc2VET00ocmVzdWx0LCAnYScsIHJldD0naHJlZicsIGF0dHJzID0geydjbGFzcyc6ICcuKz9pc3Rlci1wYWdlLW5leC4rPyd9KQoKICAgICAgICAgICAgaWYgbGVuKG5leHQpID09IDA6CiAgICAgICAgICAgICAgICBuZXh0ID0gY2xpZW50LnBhcnNlRE9NKHJlc3VsdCwgJ2RpdicsIGF0dHJzID0geydjbGFzcyc6ICdwYWdpbmF0aW9uJ30pWzBdCiAgICAgICAgICAgICAgICBuZXh0ID0gemlwKGNsaWVudC5wYXJzZURPTShuZXh0LCAnYScsIHJldD0naHJlZicpLCBjbGllbnQucGFyc2VET00obmV4dCwgJ2EnKSkKICAgICAgICAgICAgICAgIG5leHQgPSBbaVswXSBmb3IgaSBpbiBuZXh0IGlmICdOZXh0JyBpbiBpWzFdXQoKICAgICAgICAgICAgbmV4dCA9IHVybC5yZXBsYWNlKHVybHBhcnNlLnVybHBhcnNlKHVybCkucXVlcnksIHVybHBhcnNlLnVybHBhcnNlKG5leHRbMF0pLnF1ZXJ5KQogICAgICAgICAgICBuZXh0ID0gY2xpZW50LnJlcGxhY2VIVE1MQ29kZXMobmV4dCkKICAgICAgICAgICAgbmV4dCA9IG5leHQuZW5jb2RlKCd1dGYtOCcpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBuZXh0ID0gJycKCiAgICAgICAgZm9yIGl0ZW0gaW4gaXRlbXM6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHRpdGxlID0gY2xpZW50LnBhcnNlRE9NKGl0ZW0sICdhJylbMV0KICAgICAgICAgICAgICAgIHRpdGxlID0gY2xpZW50LnJlcGxhY2VIVE1MQ29kZXModGl0bGUpCiAgICAgICAgICAgICAgICB0aXRsZSA9IHRpdGxlLmVuY29kZSgndXRmLTgnKQoKICAgICAgICAgICAgICAgIHllYXIgPSBjbGllbnQucGFyc2VET00oaXRlbSwgJ3NwYW4nLCBhdHRycyA9IHsnY2xhc3MnOiAnbGlzdGVyLWl0ZW0teWVhci4rPyd9KQogICAgICAgICAgICAgICAgeWVhciArPSBjbGllbnQucGFyc2VET00oaXRlbSwgJ3NwYW4nLCBhdHRycyA9IHsnY2xhc3MnOiAneWVhcl90eXBlJ30pCiAgICAgICAgICAgICAgICB0cnk6IHllYXIgPSByZS5jb21waWxlKCcoXGR7NH0pJykuZmluZGFsbCh5ZWFyKVswXQogICAgICAgICAgICAgICAgZXhjZXB0OiB5ZWFyID0gJzAnCiAgICAgICAgICAgICAgICB5ZWFyID0geWVhci5lbmNvZGUoJ3V0Zi04JykKCiAgICAgICAgICAgICAgICBpZiBpbnQoeWVhcikgPiBpbnQoKHNlbGYuZGF0ZXRpbWUpLnN0cmZ0aW1lKCclWScpKTogcmFpc2UgRXhjZXB0aW9uKCkKCiAgICAgICAgICAgICAgICBpbWRiID0gY2xpZW50LnBhcnNlRE9NKGl0ZW0sICdhJywgcmV0PSdocmVmJylbMF0KICAgICAgICAgICAgICAgIGltZGIgPSByZS5maW5kYWxsKCcodHRcZCopJywgaW1kYilbMF0KICAgICAgICAgICAgICAgIGltZGIgPSBpbWRiLmVuY29kZSgndXRmLTgnKQoKICAgICAgICAgICAgICAgIHRyeTogcG9zdGVyID0gY2xpZW50LnBhcnNlRE9NKGl0ZW0sICdpbWcnLCByZXQ9J2xvYWRsYXRlJylbMF0KICAgICAgICAgICAgICAgIGV4Y2VwdDogcG9zdGVyID0gJzAnCiAgICAgICAgICAgICAgICBpZiAnL25vcGljdHVyZS8nIGluIHBvc3RlcjogcG9zdGVyID0gJzAnCiAgICAgICAgICAgICAgICBwb3N0ZXIgPSByZS5zdWIoJyg/Ol9TWHxfU1l8X1VYfF9VWXxfQ1J8X0FMKSg/OlxkK3xfKS4rP1wuJywgJ19TWDUwMC4nLCBwb3N0ZXIpCiAgICAgICAgICAgICAgICBwb3N0ZXIgPSBjbGllbnQucmVwbGFjZUhUTUxDb2Rlcyhwb3N0ZXIpCiAgICAgICAgICAgICAgICBwb3N0ZXIgPSBwb3N0ZXIuZW5jb2RlKCd1dGYtOCcpCgogICAgICAgICAgICAgICAgdHJ5OiBnZW5yZSA9IGNsaWVudC5wYXJzZURPTShpdGVtLCAnc3BhbicsIGF0dHJzID0geydjbGFzcyc6ICdnZW5yZSd9KVswXQogICAgICAgICAgICAgICAgZXhjZXB0OiBnZW5yZSA9ICcwJwogICAgICAgICAgICAgICAgZ2VucmUgPSAnIC8gJy5qb2luKFtpLnN0cmlwKCkgZm9yIGkgaW4gZ2VucmUuc3BsaXQoJywnKV0pCiAgICAgICAgICAgICAgICBpZiBnZW5yZSA9PSAnJzogZ2VucmUgPSAnMCcKICAgICAgICAgICAgICAgIGdlbnJlID0gY2xpZW50LnJlcGxhY2VIVE1MQ29kZXMoZ2VucmUpCiAgICAgICAgICAgICAgICBnZW5yZSA9IGdlbnJlLmVuY29kZSgndXRmLTgnKQoKICAgICAgICAgICAgICAgIHRyeTogZHVyYXRpb24gPSByZS5maW5kYWxsKCcoXGQrPykgbWluKD86c3wpJywgaXRlbSlbLTFdCiAgICAgICAgICAgICAgICBleGNlcHQ6IGR1cmF0aW9uID0gJzAnCiAgICAgICAgICAgICAgICBkdXJhdGlvbiA9IGR1cmF0aW9uLmVuY29kZSgndXRmLTgnKQoKICAgICAgICAgICAgICAgIHJhdGluZyA9ICcwJwogICAgICAgICAgICAgICAgdHJ5OiByYXRpbmcgPSBjbGllbnQucGFyc2VET00oaXRlbSwgJ3NwYW4nLCBhdHRycyA9IHsnY2xhc3MnOiAncmF0aW5nLXJhdGluZyd9KVswXQogICAgICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgICAgICAgICB0cnk6IHJhdGluZyA9IGNsaWVudC5wYXJzZURPTShyYXRpbmcsICdzcGFuJywgYXR0cnMgPSB7J2NsYXNzJzogJ3ZhbHVlJ30pWzBdCiAgICAgICAgICAgICAgICBleGNlcHQ6IHJhdGluZyA9ICcwJwogICAgICAgICAgICAgICAgdHJ5OiByYXRpbmcgPSBjbGllbnQucGFyc2VET00oaXRlbSwgJ2RpdicsIHJldD0nZGF0YS12YWx1ZScsIGF0dHJzID0geydjbGFzcyc6ICcuKj9pbWRiLXJhdGluZyd9KVswXQogICAgICAgICAgICAgICAgZXhjZXB0OiBwYXNzCiAgICAgICAgICAgICAgICBpZiByYXRpbmcgPT0gJycgb3IgcmF0aW5nID09ICctJzogcmF0aW5nID0gJzAnCiAgICAgICAgICAgICAgICByYXRpbmcgPSBjbGllbnQucmVwbGFjZUhUTUxDb2RlcyhyYXRpbmcpCiAgICAgICAgICAgICAgICByYXRpbmcgPSByYXRpbmcuZW5jb2RlKCd1dGYtOCcpCgogICAgICAgICAgICAgICAgdHJ5OiB2b3RlcyA9IGNsaWVudC5wYXJzZURPTShpdGVtLCAnZGl2JywgcmV0PSd0aXRsZScsIGF0dHJzID0geydjbGFzcyc6ICcuKj9yYXRpbmctbGlzdCd9KVswXQogICAgICAgICAgICAgICAgZXhjZXB0OiB2b3RlcyA9ICcwJwogICAgICAgICAgICAgICAgdHJ5OiB2b3RlcyA9IHJlLmZpbmRhbGwoJ1woKC4rPykgdm90ZSg/OnN8KVwpJywgdm90ZXMpWzBdCiAgICAgICAgICAgICAgICBleGNlcHQ6IHZvdGVzID0gJzAnCiAgICAgICAgICAgICAgICBpZiB2b3RlcyA9PSAnJzogdm90ZXMgPSAnMCcKICAgICAgICAgICAgICAgIHZvdGVzID0gY2xpZW50LnJlcGxhY2VIVE1MQ29kZXModm90ZXMpCiAgICAgICAgICAgICAgICB2b3RlcyA9IHZvdGVzLmVuY29kZSgndXRmLTgnKQoKICAgICAgICAgICAgICAgIHRyeTogbXBhYSA9IGNsaWVudC5wYXJzZURPTShpdGVtLCAnc3BhbicsIGF0dHJzID0geydjbGFzcyc6ICdjZXJ0aWZpY2F0ZSd9KVswXQogICAgICAgICAgICAgICAgZXhjZXB0OiBtcGFhID0gJzAnCiAgICAgICAgICAgICAgICBpZiBtcGFhID09ICcnIG9yIG1wYWEgPT0gJ05PVF9SQVRFRCc6IG1wYWEgPSAnMCcKICAgICAgICAgICAgICAgIG1wYWEgPSBtcGFhLnJlcGxhY2UoJ18nLCAnLScpCiAgICAgICAgICAgICAgICBtcGFhID0gY2xpZW50LnJlcGxhY2VIVE1MQ29kZXMobXBhYSkKICAgICAgICAgICAgICAgIG1wYWEgPSBtcGFhLmVuY29kZSgndXRmLTgnKQoKICAgICAgICAgICAgICAgIHRyeTogZGlyZWN0b3IgPSByZS5maW5kYWxsKCdEaXJlY3Rvcig/OnN8KTooLis/KSg/Olx8fDwvZGl2PiknLCBpdGVtKVswXQogICAgICAgICAgICAgICAgZXhjZXB0OiBkaXJlY3RvciA9ICcwJwogICAgICAgICAgICAgICAgZGlyZWN0b3IgPSBjbGllbnQucGFyc2VET00oZGlyZWN0b3IsICdhJykKICAgICAgICAgICAgICAgIGRpcmVjdG9yID0gJyAvICcuam9pbihkaXJlY3RvcikKICAgICAgICAgICAgICAgIGlmIGRpcmVjdG9yID09ICcnOiBkaXJlY3RvciA9ICcwJwogICAgICAgICAgICAgICAgZGlyZWN0b3IgPSBjbGllbnQucmVwbGFjZUhUTUxDb2RlcyhkaXJlY3RvcikKICAgICAgICAgICAgICAgIGRpcmVjdG9yID0gZGlyZWN0b3IuZW5jb2RlKCd1dGYtOCcpCgogICAgICAgICAgICAgICAgdHJ5OiBjYXN0ID0gcmUuZmluZGFsbCgnU3RhcnMoPzpzfCk6KC4rPykoPzpcfHw8L2Rpdj4pJywgaXRlbSlbMF0KICAgICAgICAgICAgICAgIGV4Y2VwdDogY2FzdCA9ICcwJwogICAgICAgICAgICAgICAgY2FzdCA9IGNsaWVudC5yZXBsYWNlSFRNTENvZGVzKGNhc3QpCiAgICAgICAgICAgICAgICBjYXN0ID0gY2FzdC5lbmNvZGUoJ3V0Zi04JykKICAgICAgICAgICAgICAgIGNhc3QgPSBjbGllbnQucGFyc2VET00oY2FzdCwgJ2EnKQogICAgICAgICAgICAgICAgaWYgY2FzdCA9PSBbXTogY2FzdCA9ICcwJwoKICAgICAgICAgICAgICAgIHBsb3QgPSAnMCcKICAgICAgICAgICAgICAgIHRyeTogcGxvdCA9IGNsaWVudC5wYXJzZURPTShpdGVtLCAncCcsIGF0dHJzID0geydjbGFzcyc6ICd0ZXh0LW11dGVkJ30pWzBdCiAgICAgICAgICAgICAgICBleGNlcHQ6IHBhc3MKICAgICAgICAgICAgICAgIHRyeTogcGxvdCA9IGNsaWVudC5wYXJzZURPTShpdGVtLCAnZGl2JywgYXR0cnMgPSB7J2NsYXNzJzogJ2l0ZW1fZGVzY3JpcHRpb24nfSlbMF0KICAgICAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICAgICAgcGxvdCA9IHBsb3QucnNwbGl0KCc8c3Bhbj4nLCAxKVswXS5zdHJpcCgpCiAgICAgICAgICAgICAgICBwbG90ID0gcmUuc3ViKCc8Lis/Pnw8Ly4rPz4nLCAnJywgcGxvdCkKICAgICAgICAgICAgICAgIGlmIHBsb3QgPT0gJyc6IHBsb3QgPSAnMCcKICAgICAgICAgICAgICAgIHBsb3QgPSBjbGllbnQucmVwbGFjZUhUTUxDb2RlcyhwbG90KQogICAgICAgICAgICAgICAgcGxvdCA9IHBsb3QuZW5jb2RlKCd1dGYtOCcpCgogICAgICAgICAgICAgICAgc2VsZi5saXN0LmFwcGVuZCh7J3RpdGxlJzogdGl0bGUsICdvcmlnaW5hbHRpdGxlJzogdGl0bGUsICd5ZWFyJzogeWVhciwgJ2dlbnJlJzogZ2VucmUsICdkdXJhdGlvbic6IGR1cmF0aW9uLCAncmF0aW5nJzogcmF0aW5nLCAndm90ZXMnOiB2b3RlcywgJ21wYWEnOiBtcGFhLCAnZGlyZWN0b3InOiBkaXJlY3RvciwgJ2Nhc3QnOiBjYXN0LCAncGxvdCc6IHBsb3QsICd0YWdsaW5lJzogJzAnLCAnaW1kYic6IGltZGIsICd0bWRiJzogJzAnLCAndHZkYic6ICcwJywgJ3Bvc3Rlcic6IHBvc3RlciwgJ25leHQnOiBuZXh0fSkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwoKICAgICAgICByZXR1cm4gc2VsZi5saXN0CgoKICAgIGRlZiBpbWRiX3BlcnNvbl9saXN0KHNlbGYsIHVybCk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXN1bHQgPSBjbGllbnQucmVxdWVzdCh1cmwpCiAgICAgICAgICAgIGl0ZW1zID0gY2xpZW50LnBhcnNlRE9NKHJlc3VsdCwgJ2RpdicsIGF0dHJzID0geydjbGFzcyc6ICcuKz9ldGFpbCd9KQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIGZvciBpdGVtIGluIGl0ZW1zOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBuYW1lID0gY2xpZW50LnBhcnNlRE9NKGl0ZW0sICdpbWcnLCByZXQ9J2FsdCcpWzBdCiAgICAgICAgICAgICAgICBuYW1lID0gbmFtZS5lbmNvZGUoJ3V0Zi04JykKCiAgICAgICAgICAgICAgICB1cmwgPSBjbGllbnQucGFyc2VET00oaXRlbSwgJ2EnLCByZXQ9J2hyZWYnKVswXQogICAgICAgICAgICAgICAgdXJsID0gcmUuZmluZGFsbCgnKG5tXGQqKScsIHVybCwgcmUuSSlbMF0KICAgICAgICAgICAgICAgIHVybCA9IHNlbGYucGVyc29uX2xpbmsgJSB1cmwKICAgICAgICAgICAgICAgIHVybCA9IGNsaWVudC5yZXBsYWNlSFRNTENvZGVzKHVybCkKICAgICAgICAgICAgICAgIHVybCA9IHVybC5lbmNvZGUoJ3V0Zi04JykKCiAgICAgICAgICAgICAgICBpbWFnZSA9IGNsaWVudC5wYXJzZURPTShpdGVtLCAnaW1nJywgcmV0PSdzcmMnKVswXQogICAgICAgICAgICAgICAgIyBpZiBub3QgKCcuX1NYJyBpbiBpbWFnZSBvciAnLl9TWScgaW4gaW1hZ2UpOiByYWlzZSBFeGNlcHRpb24oKQogICAgICAgICAgICAgICAgaW1hZ2UgPSByZS5zdWIoJyg/Ol9TWHxfU1l8X1VYfF9VWXxfQ1J8X0FMKSg/OlxkK3xfKS4rP1wuJywgJ19TWDUwMC4nLCBpbWFnZSkKICAgICAgICAgICAgICAgIGltYWdlID0gY2xpZW50LnJlcGxhY2VIVE1MQ29kZXMoaW1hZ2UpCiAgICAgICAgICAgICAgICBpbWFnZSA9IGltYWdlLmVuY29kZSgndXRmLTgnKQoKICAgICAgICAgICAgICAgIHNlbGYubGlzdC5hcHBlbmQoeyduYW1lJzogbmFtZSwgJ3VybCc6IHVybCwgJ2ltYWdlJzogaW1hZ2V9KQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCgogICAgICAgIHJldHVybiBzZWxmLmxpc3QKCgogICAgZGVmIGltZGJfdXNlcl9saXN0KHNlbGYsIHVybCk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXN1bHQgPSBjbGllbnQucmVxdWVzdCh1cmwpCiAgICAgICAgICAgIGl0ZW1zID0gY2xpZW50LnBhcnNlRE9NKHJlc3VsdCwgJ2xpJywgYXR0cnMgPSB7J2NsYXNzJzogJ2lwbC16ZWJyYS1saXN0X19pdGVtIHVzZXItbGlzdCd9KQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwoKICAgICAgICBmb3IgaXRlbSBpbiBpdGVtczoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgbmFtZSA9IGNsaWVudC5wYXJzZURPTShpdGVtLCAnYScpWzBdCiAgICAgICAgICAgICAgICBuYW1lID0gY2xpZW50LnJlcGxhY2VIVE1MQ29kZXMobmFtZSkKICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lLmVuY29kZSgndXRmLTgnKQoKICAgICAgICAgICAgICAgIHVybCA9IGNsaWVudC5wYXJzZURPTShpdGVtLCAnYScsIHJldD0naHJlZicpWzBdCiAgICAgICAgICAgICAgICB1cmwgPSB1cmwuc3BsaXQoJy9saXN0LycsIDEpWy0xXS5zdHJpcCgnLycpCiAgICAgICAgICAgICAgICB1cmwgPSBzZWxmLmltZGJsaXN0X2xpbmsgJSB1cmwKICAgICAgICAgICAgICAgIHVybCA9IGNsaWVudC5yZXBsYWNlSFRNTENvZGVzKHVybCkKICAgICAgICAgICAgICAgIHVybCA9IHVybC5lbmNvZGUoJ3V0Zi04JykKCiAgICAgICAgICAgICAgICBzZWxmLmxpc3QuYXBwZW5kKHsnbmFtZSc6IG5hbWUsICd1cmwnOiB1cmwsICdjb250ZXh0JzogdXJsfSkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwoKICAgICAgICBzZWxmLmxpc3QgPSBzb3J0ZWQoc2VsZi5saXN0LCBrZXk9bGFtYmRhIGs6IHV0aWxzLnRpdGxlX2tleShrWyduYW1lJ10pKQogICAgICAgIHJldHVybiBzZWxmLmxpc3QKCgogICAgZGVmIHdvcmtlcihzZWxmLCBsZXZlbD0xKToKICAgICAgICBzZWxmLm1ldGEgPSBbXQogICAgICAgIHRvdGFsID0gbGVuKHNlbGYubGlzdCkKCiAgICAgICAgc2VsZi5mYW5hcnRfdHZfaGVhZGVycyA9IHsnYXBpLWtleSc6ICdaRFk1TlRSa1lUazJZemc0T0RGbE16ZGpZMlJrTW1ReU5UbG1ZamsxTXpRPScuZGVjb2RlKCdiYXNlNjQnKX0KICAgICAgICBpZiBub3Qgc2VsZi5mYW5hcnRfdHZfdXNlciA9PSAnJzoKICAgICAgICAgICAgc2VsZi5mYW5hcnRfdHZfaGVhZGVycy51cGRhdGUoeydjbGllbnQta2V5Jzogc2VsZi5mYW5hcnRfdHZfdXNlcn0pCgogICAgICAgIGZvciBpIGluIHJhbmdlKDAsIHRvdGFsKTogc2VsZi5saXN0W2ldLnVwZGF0ZSh7J21ldGFjYWNoZSc6IEZhbHNlfSkKCiAgICAgICAgc2VsZi5saXN0ID0gbWV0YWNhY2hlLmZldGNoKHNlbGYubGlzdCwgc2VsZi5sYW5nLCBzZWxmLnVzZXIpCgogICAgICAgIGZvciByIGluIHJhbmdlKDAsIHRvdGFsLCA0MCk6CiAgICAgICAgICAgIHRocmVhZHMgPSBbXQogICAgICAgICAgICBmb3IgaSBpbiByYW5nZShyLCByKzQwKToKICAgICAgICAgICAgICAgIGlmIGkgPD0gdG90YWw6IHRocmVhZHMuYXBwZW5kKHdvcmtlcnMuVGhyZWFkKHNlbGYuc3VwZXJfaW5mbywgaSkpCiAgICAgICAgICAgIFtpLnN0YXJ0KCkgZm9yIGkgaW4gdGhyZWFkc10KICAgICAgICAgICAgW2kuam9pbigpIGZvciBpIGluIHRocmVhZHNdCgogICAgICAgICAgICBpZiBzZWxmLm1ldGE6IG1ldGFjYWNoZS5pbnNlcnQoc2VsZi5tZXRhKQoKICAgICAgICBzZWxmLmxpc3QgPSBbaSBmb3IgaSBpbiBzZWxmLmxpc3QgaWYgbm90IGlbJ2ltZGInXSA9PSAnMCddCgogICAgICAgIHNlbGYubGlzdCA9IG1ldGFjYWNoZS5sb2NhbChzZWxmLmxpc3QsIHNlbGYudG1faW1nX2xpbmssICdwb3N0ZXIzJywgJ2ZhbmFydDInKQoKICAgICAgICBpZiBzZWxmLmZhbmFydF90dl91c2VyID09ICcnOgogICAgICAgICAgICBmb3IgaSBpbiBzZWxmLmxpc3Q6IGkudXBkYXRlKHsnY2xlYXJsb2dvJzogJzAnLCAnY2xlYXJhcnQnOiAnMCd9KQoKCiAgICBkZWYgc3VwZXJfaW5mbyhzZWxmLCBpKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGlmIHNlbGYubGlzdFtpXVsnbWV0YWNhY2hlJ10gPT0gVHJ1ZTogcmFpc2UgRXhjZXB0aW9uKCkKCiAgICAgICAgICAgIGltZGIgPSBzZWxmLmxpc3RbaV1bJ2ltZGInXQoKICAgICAgICAgICAgaXRlbSA9IHRyYWt0LmdldE1vdmllU3VtbWFyeShpbWRiKQoKICAgICAgICAgICAgdGl0bGUgPSBpdGVtLmdldCgndGl0bGUnKQogICAgICAgICAgICB0aXRsZSA9IGNsaWVudC5yZXBsYWNlSFRNTENvZGVzKHRpdGxlKQoKICAgICAgICAgICAgb3JpZ2luYWx0aXRsZSA9IHRpdGxlCgogICAgICAgICAgICB5ZWFyID0gaXRlbS5nZXQoJ3llYXInLCAwKQogICAgICAgICAgICB5ZWFyID0gcmUuc3ViKCdbXjAtOV0nLCAnJywgc3RyKHllYXIpKQoKICAgICAgICAgICAgaW1kYiA9IGl0ZW0uZ2V0KCdpZHMnLCB7fSkuZ2V0KCdpbWRiJywgJzAnKQogICAgICAgICAgICBpbWRiID0gJ3R0JyArIHJlLnN1YignW14wLTldJywgJycsIHN0cihpbWRiKSkKCiAgICAgICAgICAgIHRtZGIgPSBzdHIoaXRlbS5nZXQoJ2lkcycsIHt9KS5nZXQoJ3RtZGInLCAwKSkKCiAgICAgICAgICAgIHByZW1pZXJlZCA9IGl0ZW0uZ2V0KCdyZWxlYXNlZCcsICcwJykKICAgICAgICAgICAgdHJ5OiBwcmVtaWVyZWQgPSByZS5jb21waWxlKCcoXGR7NH0tXGR7Mn0tXGR7Mn0pJykuZmluZGFsbChwcmVtaWVyZWQpWzBdCiAgICAgICAgICAgIGV4Y2VwdDogcHJlbWllcmVkID0gJzAnCgogICAgICAgICAgICBnZW5yZSA9IGl0ZW0uZ2V0KCdnZW5yZXMnLCBbXSkKICAgICAgICAgICAgZ2VucmUgPSBbeC50aXRsZSgpIGZvciB4IGluIGdlbnJlXQogICAgICAgICAgICBnZW5yZSA9ICcgLyAnLmpvaW4oZ2VucmUpLnN0cmlwKCkKICAgICAgICAgICAgaWYgbm90IGdlbnJlOiBnZW5yZSA9ICcwJwoKICAgICAgICAgICAgZHVyYXRpb24gPSBzdHIoaXRlbS5nZXQoJ1J1bnRpbWUnLCAwKSkKCiAgICAgICAgICAgIHJhdGluZyA9IGl0ZW0uZ2V0KCdyYXRpbmcnLCAnMCcpCiAgICAgICAgICAgIGlmIG5vdCByYXRpbmcgb3IgcmF0aW5nID09ICcwLjAnOiByYXRpbmcgPSAnMCcKCiAgICAgICAgICAgIHZvdGVzID0gaXRlbS5nZXQoJ3ZvdGVzJywgJzAnKQogICAgICAgICAgICB0cnk6IHZvdGVzID0gc3RyKGZvcm1hdChpbnQodm90ZXMpLCAnLGQnKSkKICAgICAgICAgICAgZXhjZXB0OiBwYXNzCgogICAgICAgICAgICBtcGFhID0gaXRlbS5nZXQoJ2NlcnRpZmljYXRpb24nLCAnMCcpCiAgICAgICAgICAgIGlmIG5vdCBtcGFhOiBtcGFhID0gJzAnCgogICAgICAgICAgICB0YWdsaW5lID0gaXRlbS5nZXQoJ3RhZ2xpbmUnLCAnMCcpCgogICAgICAgICAgICBwbG90ID0gaXRlbS5nZXQoJ292ZXJ2aWV3JywgJzAnKQoKICAgICAgICAgICAgcGVvcGxlID0gdHJha3QuZ2V0UGVvcGxlKGltZGIsICdtb3ZpZXMnKQoKICAgICAgICAgICAgZGlyZWN0b3IgPSB3cml0ZXIgPSAnJwogICAgICAgICAgICBpZiAnY3JldycgaW4gcGVvcGxlIGFuZCAnZGlyZWN0aW5nJyBpbiBwZW9wbGVbJ2NyZXcnXToKICAgICAgICAgICAgICAgIGRpcmVjdG9yID0gJywgJy5qb2luKFtkaXJlY3RvclsncGVyc29uJ11bJ25hbWUnXSBmb3IgZGlyZWN0b3IgaW4gcGVvcGxlWydjcmV3J11bJ2RpcmVjdGluZyddIGlmIGRpcmVjdG9yWydqb2InXS5sb3dlcigpID09ICdkaXJlY3RvciddKQogICAgICAgICAgICBpZiAnY3JldycgaW4gcGVvcGxlIGFuZCAnd3JpdGluZycgaW4gcGVvcGxlWydjcmV3J106CiAgICAgICAgICAgICAgICB3cml0ZXIgPSAnLCAnLmpvaW4oW3dyaXRlclsncGVyc29uJ11bJ25hbWUnXSBmb3Igd3JpdGVyIGluIHBlb3BsZVsnY3JldyddWyd3cml0aW5nJ10gaWYgd3JpdGVyWydqb2InXS5sb3dlcigpIGluIFsnd3JpdGVyJywgJ3NjcmVlbnBsYXknLCAnYXV0aG9yJ11dKQoKICAgICAgICAgICAgY2FzdCA9IFtdCiAgICAgICAgICAgIGZvciBwZXJzb24gaW4gcGVvcGxlLmdldCgnY2FzdCcsIFtdKToKICAgICAgICAgICAgICAgIGNhc3QuYXBwZW5kKHsnbmFtZSc6IHBlcnNvblsncGVyc29uJ11bJ25hbWUnXSwgJ3JvbGUnOiBwZXJzb25bJ2NoYXJhY3RlciddfSkKICAgICAgICAgICAgY2FzdCA9IFsocGVyc29uWyduYW1lJ10sIHBlcnNvblsncm9sZSddKSBmb3IgcGVyc29uIGluIGNhc3RdCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpZiBzZWxmLmxhbmcgPT0gJ2VuJyBvciBzZWxmLmxhbmcgbm90IGluIGl0ZW0uZ2V0KCdhdmFpbGFibGVfdHJhbnNsYXRpb25zJywgW3NlbGYubGFuZ10pOiByYWlzZSBFeGNlcHRpb24oKQoKICAgICAgICAgICAgICAgIHRyYW5zX2l0ZW0gPSB0cmFrdC5nZXRNb3ZpZVRyYW5zbGF0aW9uKGltZGIsIHNlbGYubGFuZywgZnVsbD1UcnVlKQoKICAgICAgICAgICAgICAgIHRpdGxlID0gdHJhbnNfaXRlbS5nZXQoJ3RpdGxlJykgb3IgdGl0bGUKICAgICAgICAgICAgICAgIHRhZ2xpbmUgPSB0cmFuc19pdGVtLmdldCgndGFnbGluZScpIG9yIHRhZ2xpbmUKICAgICAgICAgICAgICAgIHBsb3QgPSB0cmFuc19pdGVtLmdldCgnb3ZlcnZpZXcnKSBvciBwbG90CiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGFydG1ldGEgPSBUcnVlCiAgICAgICAgICAgICAgICAjaWYgc2VsZi5mYW5hcnRfdHZfdXNlciA9PSAnJzogcmFpc2UgRXhjZXB0aW9uKCkKICAgICAgICAgICAgICAgIGFydCA9IGNsaWVudC5yZXF1ZXN0KHNlbGYuZmFuYXJ0X3R2X2FydF9saW5rICUgaW1kYiwgaGVhZGVycz1zZWxmLmZhbmFydF90dl9oZWFkZXJzLCB0aW1lb3V0PScxMCcsIGVycm9yPVRydWUpCiAgICAgICAgICAgICAgICB0cnk6IGFydCA9IGpzb24ubG9hZHMoYXJ0KQogICAgICAgICAgICAgICAgZXhjZXB0OiBhcnRtZXRhID0gRmFsc2UKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcG9zdGVyMiA9IGFydFsnbW92aWVwb3N0ZXInXQogICAgICAgICAgICAgICAgcG9zdGVyMiA9IFt4IGZvciB4IGluIHBvc3RlcjIgaWYgeC5nZXQoJ2xhbmcnKSA9PSBzZWxmLmxhbmddWzo6LTFdICsgW3ggZm9yIHggaW4gcG9zdGVyMiBpZiB4LmdldCgnbGFuZycpID09ICdlbiddWzo6LTFdICsgW3ggZm9yIHggaW4gcG9zdGVyMiBpZiB4LmdldCgnbGFuZycpIGluIFsnMDAnLCAnJ11dWzo6LTFdCiAgICAgICAgICAgICAgICBwb3N0ZXIyID0gcG9zdGVyMlswXVsndXJsJ10uZW5jb2RlKCd1dGYtOCcpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBvc3RlcjIgPSAnMCcKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlmICdtb3ZpZWJhY2tncm91bmQnIGluIGFydDogZmFuYXJ0ID0gYXJ0Wydtb3ZpZWJhY2tncm91bmQnXQogICAgICAgICAgICAgICAgZWxzZTogZmFuYXJ0ID0gYXJ0Wydtb3ZpZXRodW1iJ10KICAgICAgICAgICAgICAgIGZhbmFydCA9IFt4IGZvciB4IGluIGZhbmFydCBpZiB4LmdldCgnbGFuZycpID09IHNlbGYubGFuZ11bOjotMV0gKyBbeCBmb3IgeCBpbiBmYW5hcnQgaWYgeC5nZXQoJ2xhbmcnKSA9PSAnZW4nXVs6Oi0xXSArIFt4IGZvciB4IGluIGZhbmFydCBpZiB4LmdldCgnbGFuZycpIGluIFsnMDAnLCAnJ11dWzo6LTFdCiAgICAgICAgICAgICAgICBmYW5hcnQgPSBmYW5hcnRbMF1bJ3VybCddLmVuY29kZSgndXRmLTgnKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBmYW5hcnQgPSAnMCcKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGJhbm5lciA9IGFydFsnbW92aWViYW5uZXInXQogICAgICAgICAgICAgICAgYmFubmVyID0gW3ggZm9yIHggaW4gYmFubmVyIGlmIHguZ2V0KCdsYW5nJykgPT0gc2VsZi5sYW5nXVs6Oi0xXSArIFt4IGZvciB4IGluIGJhbm5lciBpZiB4LmdldCgnbGFuZycpID09ICdlbiddWzo6LTFdICsgW3ggZm9yIHggaW4gYmFubmVyIGlmIHguZ2V0KCdsYW5nJykgaW4gWycwMCcsICcnXV1bOjotMV0KICAgICAgICAgICAgICAgIGJhbm5lciA9IGJhbm5lclswXVsndXJsJ10uZW5jb2RlKCd1dGYtOCcpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGJhbm5lciA9ICcwJwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaWYgJ2hkbW92aWVsb2dvJyBpbiBhcnQ6IGNsZWFybG9nbyA9IGFydFsnaGRtb3ZpZWxvZ28nXQogICAgICAgICAgICAgICAgZWxzZTogY2xlYXJsb2dvID0gYXJ0WydjbGVhcmxvZ28nXQogICAgICAgICAgICAgICAgY2xlYXJsb2dvID0gW3ggZm9yIHggaW4gY2xlYXJsb2dvIGlmIHguZ2V0KCdsYW5nJykgPT0gc2VsZi5sYW5nXVs6Oi0xXSArIFt4IGZvciB4IGluIGNsZWFybG9nbyBpZiB4LmdldCgnbGFuZycpID09ICdlbiddWzo6LTFdICsgW3ggZm9yIHggaW4gY2xlYXJsb2dvIGlmIHguZ2V0KCdsYW5nJykgaW4gWycwMCcsICcnXV1bOjotMV0KICAgICAgICAgICAgICAgIGNsZWFybG9nbyA9IGNsZWFybG9nb1swXVsndXJsJ10uZW5jb2RlKCd1dGYtOCcpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGNsZWFybG9nbyA9ICcwJwoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaWYgJ2hkbW92aWVjbGVhcmFydCcgaW4gYXJ0OiBjbGVhcmFydCA9IGFydFsnaGRtb3ZpZWNsZWFyYXJ0J10KICAgICAgICAgICAgICAgIGVsc2U6IGNsZWFyYXJ0ID0gYXJ0WydjbGVhcmFydCddCiAgICAgICAgICAgICAgICBjbGVhcmFydCA9IFt4IGZvciB4IGluIGNsZWFyYXJ0IGlmIHguZ2V0KCdsYW5nJykgPT0gc2VsZi5sYW5nXVs6Oi0xXSArIFt4IGZvciB4IGluIGNsZWFyYXJ0IGlmIHguZ2V0KCdsYW5nJykgPT0gJ2VuJ11bOjotMV0gKyBbeCBmb3IgeCBpbiBjbGVhcmFydCBpZiB4LmdldCgnbGFuZycpIGluIFsnMDAnLCAnJ11dWzo6LTFdCiAgICAgICAgICAgICAgICBjbGVhcmFydCA9IGNsZWFyYXJ0WzBdWyd1cmwnXS5lbmNvZGUoJ3V0Zi04JykKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgY2xlYXJhcnQgPSAnMCcKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlmIHNlbGYudG1fdXNlciA9PSAnJzogcmFpc2UgRXhjZXB0aW9uKCkKCiAgICAgICAgICAgICAgICBhcnQyID0gY2xpZW50LnJlcXVlc3Qoc2VsZi50bV9hcnRfbGluayAlIGltZGIsIHRpbWVvdXQ9JzEwJywgZXJyb3I9VHJ1ZSkKICAgICAgICAgICAgICAgIGFydDIgPSBqc29uLmxvYWRzKGFydDIpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHBvc3RlcjMgPSBhcnQyWydwb3N0ZXJzJ10KICAgICAgICAgICAgICAgIHBvc3RlcjMgPSBbeCBmb3IgeCBpbiBwb3N0ZXIzIGlmIHguZ2V0KCdpc29fNjM5XzEnKSA9PSBzZWxmLmxhbmddICsgW3ggZm9yIHggaW4gcG9zdGVyMyBpZiB4LmdldCgnaXNvXzYzOV8xJykgPT0gJ2VuJ10gKyBbeCBmb3IgeCBpbiBwb3N0ZXIzIGlmIHguZ2V0KCdpc29fNjM5XzEnKSBub3QgaW4gW3NlbGYubGFuZywgJ2VuJ11dCiAgICAgICAgICAgICAgICBwb3N0ZXIzID0gWyh4Wyd3aWR0aCddLCB4WydmaWxlX3BhdGgnXSkgZm9yIHggaW4gcG9zdGVyM10KICAgICAgICAgICAgICAgIHBvc3RlcjMgPSBbKHhbMF0sIHhbMV0pIGlmIHhbMF0gPCAzMDAgZWxzZSAoJzMwMCcsIHhbMV0pIGZvciB4IGluIHBvc3RlcjNdCiAgICAgICAgICAgICAgICBwb3N0ZXIzID0gc2VsZi50bV9pbWdfbGluayAlIHBvc3RlcjNbMF0KICAgICAgICAgICAgICAgIHBvc3RlcjMgPSBwb3N0ZXIzLmVuY29kZSgndXRmLTgnKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwb3N0ZXIzID0gJzAnCgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBmYW5hcnQyID0gYXJ0MlsnYmFja2Ryb3BzJ10KICAgICAgICAgICAgICAgIGZhbmFydDIgPSBbeCBmb3IgeCBpbiBmYW5hcnQyIGlmIHguZ2V0KCdpc29fNjM5XzEnKSA9PSBzZWxmLmxhbmddICsgW3ggZm9yIHggaW4gZmFuYXJ0MiBpZiB4LmdldCgnaXNvXzYzOV8xJykgPT0gJ2VuJ10gKyBbeCBmb3IgeCBpbiBmYW5hcnQyIGlmIHguZ2V0KCdpc29fNjM5XzEnKSBub3QgaW4gW3NlbGYubGFuZywgJ2VuJ11dCiAgICAgICAgICAgICAgICBmYW5hcnQyID0gW3ggZm9yIHggaW4gZmFuYXJ0MiBpZiB4LmdldCgnd2lkdGgnKSA9PSAxOTIwXSArIFt4IGZvciB4IGluIGZhbmFydDIgaWYgeC5nZXQoJ3dpZHRoJykgPCAxOTIwXQogICAgICAgICAgICAgICAgZmFuYXJ0MiA9IFsoeFsnd2lkdGgnXSwgeFsnZmlsZV9wYXRoJ10pIGZvciB4IGluIGZhbmFydDJdCiAgICAgICAgICAgICAgICBmYW5hcnQyID0gWyh4WzBdLCB4WzFdKSBpZiB4WzBdIDwgMTI4MCBlbHNlICgnMTI4MCcsIHhbMV0pIGZvciB4IGluIGZhbmFydDJdCiAgICAgICAgICAgICAgICBmYW5hcnQyID0gc2VsZi50bV9pbWdfbGluayAlIGZhbmFydDJbMF0KICAgICAgICAgICAgICAgIGZhbmFydDIgPSBmYW5hcnQyLmVuY29kZSgndXRmLTgnKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBmYW5hcnQyID0gJzAnCgogICAgICAgICAgICBpdGVtID0geyd0aXRsZSc6IHRpdGxlLCAnb3JpZ2luYWx0aXRsZSc6IG9yaWdpbmFsdGl0bGUsICd5ZWFyJzogeWVhciwgJ2ltZGInOiBpbWRiLCAndG1kYic6IHRtZGIsICdwb3N0ZXInOiAnMCcsICdwb3N0ZXIyJzogcG9zdGVyMiwgJ3Bvc3RlcjMnOiBwb3N0ZXIzLCAnYmFubmVyJzogYmFubmVyLCAnZmFuYXJ0JzogZmFuYXJ0LCAnZmFuYXJ0Mic6IGZhbmFydDIsICdjbGVhcmxvZ28nOiBjbGVhcmxvZ28sICdjbGVhcmFydCc6IGNsZWFyYXJ0LCAncHJlbWllcmVkJzogcHJlbWllcmVkLCAnZ2VucmUnOiBnZW5yZSwgJ2R1cmF0aW9uJzogZHVyYXRpb24sICdyYXRpbmcnOiByYXRpbmcsICd2b3Rlcyc6IHZvdGVzLCAnbXBhYSc6IG1wYWEsICdkaXJlY3Rvcic6IGRpcmVjdG9yLCAnd3JpdGVyJzogd3JpdGVyLCAnY2FzdCc6IGNhc3QsICdwbG90JzogcGxvdCwgJ3RhZ2xpbmUnOiB0YWdsaW5lfQogICAgICAgICAgICBpdGVtID0gZGljdCgoayx2KSBmb3IgaywgdiBpbiBpdGVtLml0ZXJpdGVtcygpIGlmIG5vdCB2ID09ICcwJykKICAgICAgICAgICAgc2VsZi5saXN0W2ldLnVwZGF0ZShpdGVtKQoKICAgICAgICAgICAgaWYgYXJ0bWV0YSA9PSBGYWxzZTogcmFpc2UgRXhjZXB0aW9uKCkKCiAgICAgICAgICAgIG1ldGEgPSB7J2ltZGInOiBpbWRiLCAndG1kYic6IHRtZGIsICd0dmRiJzogJzAnLCAnbGFuZyc6IHNlbGYubGFuZywgJ3VzZXInOiBzZWxmLnVzZXIsICdpdGVtJzogaXRlbX0KICAgICAgICAgICAgc2VsZi5tZXRhLmFwcGVuZChtZXRhKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwoKCiAgICBkZWYgbW92aWVEaXJlY3Rvcnkoc2VsZiwgaXRlbXMpOgogICAgICAgIGlmIGl0ZW1zID09IE5vbmUgb3IgbGVuKGl0ZW1zKSA9PSAwOiBjb250cm9sLmlkbGUoKSA7IHN5cy5leGl0KCkKCiAgICAgICAgc3lzYWRkb24gPSBzeXMuYXJndlswXQoKICAgICAgICBzeXNoYW5kbGUgPSBpbnQoc3lzLmFyZ3ZbMV0pCgogICAgICAgIGFkZG9uUG9zdGVyLCBhZGRvbkJhbm5lciA9IGNvbnRyb2wuYWRkb25Qb3N0ZXIoKSwgY29udHJvbC5hZGRvbkJhbm5lcigpCgogICAgICAgIGFkZG9uRmFuYXJ0LCBzZXR0aW5nRmFuYXJ0ID0gY29udHJvbC5hZGRvbkZhbmFydCgpLCBjb250cm9sLnNldHRpbmcoJ2ZhbmFydCcpCgogICAgICAgIHRyYWt0Q3JlZGVudGlhbHMgPSB0cmFrdC5nZXRUcmFrdENyZWRlbnRpYWxzSW5mbygpCgogICAgICAgIHRyeTogaXNPbGQgPSBGYWxzZSA7IGNvbnRyb2wuaXRlbSgpLmdldEFydCgndHlwZScpCiAgICAgICAgZXhjZXB0OiBpc09sZCA9IFRydWUKCiAgICAgICAgaXNQbGF5YWJsZSA9ICd0cnVlJyBpZiBub3QgJ3BsdWdpbicgaW4gY29udHJvbC5pbmZvTGFiZWwoJ0NvbnRhaW5lci5QbHVnaW5OYW1lJykgZWxzZSAnZmFsc2UnCgogICAgICAgIGluZGljYXRvcnMgPSBwbGF5Y291bnQuZ2V0TW92aWVJbmRpY2F0b3JzKHJlZnJlc2g9VHJ1ZSkgaWYgYWN0aW9uID09ICdtb3ZpZXMnIGVsc2UgcGxheWNvdW50LmdldE1vdmllSW5kaWNhdG9ycygpCgogICAgICAgIHBsYXliYWNrTWVudSA9IGNvbnRyb2wubGFuZygzMjA2MykuZW5jb2RlKCd1dGYtOCcpIGlmIGNvbnRyb2wuc2V0dGluZygnaG9zdHMubW9kZScpID09ICcyJyBlbHNlIGNvbnRyb2wubGFuZygzMjA2NCkuZW5jb2RlKCd1dGYtOCcpCgogICAgICAgIHdhdGNoZWRNZW51ID0gY29udHJvbC5sYW5nKDMyMDY4KS5lbmNvZGUoJ3V0Zi04JykgaWYgdHJha3QuZ2V0VHJha3RJbmRpY2F0b3JzSW5mbygpID09IFRydWUgZWxzZSBjb250cm9sLmxhbmcoMzIwNjYpLmVuY29kZSgndXRmLTgnKQoKICAgICAgICB1bndhdGNoZWRNZW51ID0gY29udHJvbC5sYW5nKDMyMDY5KS5lbmNvZGUoJ3V0Zi04JykgaWYgdHJha3QuZ2V0VHJha3RJbmRpY2F0b3JzSW5mbygpID09IFRydWUgZWxzZSBjb250cm9sLmxhbmcoMzIwNjcpLmVuY29kZSgndXRmLTgnKQoKICAgICAgICBxdWV1ZU1lbnUgPSBjb250cm9sLmxhbmcoMzIwNjUpLmVuY29kZSgndXRmLTgnKQoKICAgICAgICB0cmFrdE1hbmFnZXJNZW51ID0gY29udHJvbC5sYW5nKDMyMDcwKS5lbmNvZGUoJ3V0Zi04JykKCiAgICAgICAgbmV4dE1lbnUgPSBjb250cm9sLmxhbmcoMzIwNTMpLmVuY29kZSgndXRmLTgnKQoKICAgICAgICBhZGRUb0xpYnJhcnkgPSBjb250cm9sLmxhbmcoMzI1NTEpLmVuY29kZSgndXRmLTgnKQoKICAgICAgICBmb3IgaSBpbiBpdGVtczoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgbGFiZWwgPSAnJXMgKCVzKScgJSAoaVsndGl0bGUnXSwgaVsneWVhciddKQogICAgICAgICAgICAgICAgaW1kYiwgdG1kYiwgdGl0bGUsIHllYXIgPSBpWydpbWRiJ10sIGlbJ3RtZGInXSwgaVsnb3JpZ2luYWx0aXRsZSddLCBpWyd5ZWFyJ10KICAgICAgICAgICAgICAgIHN5c25hbWUgPSB1cmxsaWIucXVvdGVfcGx1cygnJXMgKCVzKScgJSAodGl0bGUsIHllYXIpKQogICAgICAgICAgICAgICAgc3lzdGl0bGUgPSB1cmxsaWIucXVvdGVfcGx1cyh0aXRsZSkKCiAgICAgICAgICAgICAgICBtZXRhID0gZGljdCgoayx2KSBmb3IgaywgdiBpbiBpLml0ZXJpdGVtcygpIGlmIG5vdCB2ID09ICcwJykKICAgICAgICAgICAgICAgIG1ldGEudXBkYXRlKHsnY29kZSc6IGltZGIsICdpbWRibnVtYmVyJzogaW1kYiwgJ2ltZGJfaWQnOiBpbWRifSkKICAgICAgICAgICAgICAgIG1ldGEudXBkYXRlKHsndG1kYl9pZCc6IHRtZGJ9KQogICAgICAgICAgICAgICAgbWV0YS51cGRhdGUoeydtZWRpYXR5cGUnOiAnbW92aWUnfSkKICAgICAgICAgICAgICAgIG1ldGEudXBkYXRlKHsndHJhaWxlcic6ICclcz9hY3Rpb249dHJhaWxlciZuYW1lPSVzJyAlIChzeXNhZGRvbiwgdXJsbGliLnF1b3RlX3BsdXMobGFiZWwpKX0pCiAgICAgICAgICAgICAgICAjbWV0YS51cGRhdGUoeyd0cmFpbGVyJzogJ3BsdWdpbjovL3NjcmlwdC5leHRlbmRlZGluZm8vP2luZm89cGxheXRyYWlsZXImJmlkPSVzJyAlIGltZGJ9KQogICAgICAgICAgICAgICAgaWYgbm90ICdkdXJhdGlvbicgaW4gaTogbWV0YS51cGRhdGUoeydkdXJhdGlvbic6ICcxMjAnfSkKICAgICAgICAgICAgICAgIGVsaWYgaVsnZHVyYXRpb24nXSA9PSAnMCc6IG1ldGEudXBkYXRlKHsnZHVyYXRpb24nOiAnMTIwJ30pCiAgICAgICAgICAgICAgICB0cnk6IG1ldGEudXBkYXRlKHsnZHVyYXRpb24nOiBzdHIoaW50KG1ldGFbJ2R1cmF0aW9uJ10pICogNjApfSkKICAgICAgICAgICAgICAgIGV4Y2VwdDogcGFzcwogICAgICAgICAgICAgICAgdHJ5OiBtZXRhLnVwZGF0ZSh7J2dlbnJlJzogY2xlYW5nZW5yZS5sYW5nKG1ldGFbJ2dlbnJlJ10sIHNlbGYubGFuZyl9KQogICAgICAgICAgICAgICAgZXhjZXB0OiBwYXNzCgogICAgICAgICAgICAgICAgcG9zdGVyID0gW2lbeF0gZm9yIHggaW4gWydwb3N0ZXIzJywgJ3Bvc3RlcicsICdwb3N0ZXIyJ10gaWYgaS5nZXQoeCwgJzAnKSAhPSAnMCddCiAgICAgICAgICAgICAgICBwb3N0ZXIgPSBwb3N0ZXJbMF0gaWYgcG9zdGVyIGVsc2UgYWRkb25Qb3N0ZXIKICAgICAgICAgICAgICAgIG1ldGEudXBkYXRlKHsncG9zdGVyJzogcG9zdGVyfSkKCiAgICAgICAgICAgICAgICBzeXNtZXRhID0gdXJsbGliLnF1b3RlX3BsdXMoanNvbi5kdW1wcyhtZXRhKSkKCiAgICAgICAgICAgICAgICB1cmwgPSAnJXM/YWN0aW9uPXBsYXkmdGl0bGU9JXMmeWVhcj0lcyZpbWRiPSVzJm1ldGE9JXMmdD0lcycgJSAoc3lzYWRkb24sIHN5c3RpdGxlLCB5ZWFyLCBpbWRiLCBzeXNtZXRhLCBzZWxmLnN5c3RpbWUpCiAgICAgICAgICAgICAgICBzeXN1cmwgPSB1cmxsaWIucXVvdGVfcGx1cyh1cmwpCgogICAgICAgICAgICAgICAgcGF0aCA9ICclcz9hY3Rpb249cGxheSZ0aXRsZT0lcyZ5ZWFyPSVzJmltZGI9JXMnICUgKHN5c2FkZG9uLCBzeXN0aXRsZSwgeWVhciwgaW1kYikKCgogICAgICAgICAgICAgICAgY20gPSBbXQoKICAgICAgICAgICAgICAgIGNtLmFwcGVuZCgoJ0ZpbmQgc2ltaWxhcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICdBY3RpdmF0ZVdpbmRvdygxMDAyNSwlcz9hY3Rpb249bW92aWVzJnVybD1odHRwczovL2FwaS50cmFrdC50di9tb3ZpZXMvJXMvcmVsYXRlZCxyZXR1cm4pJyAlICgKICAgICAgICAgICAgICAgICAgICAgICAgICAgc3lzYWRkb24sIGltZGIpKSkKCiAgICAgICAgICAgICAgICBjbS5hcHBlbmQoKHF1ZXVlTWVudSwgJ1J1blBsdWdpbiglcz9hY3Rpb249cXVldWVJdGVtKScgJSBzeXNhZGRvbikpCgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIG92ZXJsYXkgPSBpbnQocGxheWNvdW50LmdldE1vdmllT3ZlcmxheShpbmRpY2F0b3JzLCBpbWRiKSkKICAgICAgICAgICAgICAgICAgICBpZiBvdmVybGF5ID09IDc6CiAgICAgICAgICAgICAgICAgICAgICAgIGNtLmFwcGVuZCgodW53YXRjaGVkTWVudSwgJ1J1blBsdWdpbiglcz9hY3Rpb249bW92aWVQbGF5Y291bnQmaW1kYj0lcyZxdWVyeT02KScgJSAoc3lzYWRkb24sIGltZGIpKSkKICAgICAgICAgICAgICAgICAgICAgICAgbWV0YS51cGRhdGUoeydwbGF5Y291bnQnOiAxLCAnb3ZlcmxheSc6IDd9KQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGNtLmFwcGVuZCgod2F0Y2hlZE1lbnUsICdSdW5QbHVnaW4oJXM/YWN0aW9uPW1vdmllUGxheWNvdW50JmltZGI9JXMmcXVlcnk9NyknICUgKHN5c2FkZG9uLCBpbWRiKSkpCiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGEudXBkYXRlKHsncGxheWNvdW50JzogMCwgJ292ZXJsYXknOiA2fSkKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBwYXNzCgogICAgICAgICAgICAgICAgaWYgdHJha3RDcmVkZW50aWFscyA9PSBUcnVlOgogICAgICAgICAgICAgICAgICAgIGNtLmFwcGVuZCgodHJha3RNYW5hZ2VyTWVudSwgJ1J1blBsdWdpbiglcz9hY3Rpb249dHJha3RNYW5hZ2VyJm5hbWU9JXMmaW1kYj0lcyZjb250ZW50PW1vdmllKScgJSAoc3lzYWRkb24sIHN5c25hbWUsIGltZGIpKSkKCiAgICAgICAgICAgICAgICBjbS5hcHBlbmQoKHBsYXliYWNrTWVudSwgJ1J1blBsdWdpbiglcz9hY3Rpb249YWx0ZXJTb3VyY2VzJnVybD0lcyZtZXRhPSVzKScgJSAoc3lzYWRkb24sIHN5c3VybCwgc3lzbWV0YSkpKQoKICAgICAgICAgICAgICAgIGlmIGlzT2xkID09IFRydWU6CiAgICAgICAgICAgICAgICAgICAgY20uYXBwZW5kKChjb250cm9sLmxhbmcyKDE5MDMzKS5lbmNvZGUoJ3V0Zi04JyksICdBY3Rpb24oSW5mbyknKSkKCiAgICAgICAgICAgICAgICBjbS5hcHBlbmQoKGFkZFRvTGlicmFyeSwgJ1J1blBsdWdpbiglcz9hY3Rpb249bW92aWVUb0xpYnJhcnkmbmFtZT0lcyZ0aXRsZT0lcyZ5ZWFyPSVzJmltZGI9JXMmdG1kYj0lcyknICUgKHN5c2FkZG9uLCBzeXNuYW1lLCBzeXN0aXRsZSwgeWVhciwgaW1kYiwgdG1kYikpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjbS5hcHBlbmQoKCcxM0Nsb3ducyBTZXR0aW5ncycsICdSdW5QbHVnaW4oJXM/YWN0aW9uPW9wZW5TZXR0aW5ncyZxdWVyeT0oMCwwKSknICUgc3lzYWRkb24pKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpdGVtID0gY29udHJvbC5pdGVtKGxhYmVsPWxhYmVsKQoKICAgICAgICAgICAgICAgIGFydCA9IHt9CiAgICAgICAgICAgICAgICBhcnQudXBkYXRlKHsnaWNvbic6IHBvc3RlciwgJ3RodW1iJzogcG9zdGVyLCAncG9zdGVyJzogcG9zdGVyfSkKCiAgICAgICAgICAgICAgICBpZiAnYmFubmVyJyBpbiBpIGFuZCBub3QgaVsnYmFubmVyJ10gPT0gJzAnOgogICAgICAgICAgICAgICAgICAgIGFydC51cGRhdGUoeydiYW5uZXInOiBpWydiYW5uZXInXX0pCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGFydC51cGRhdGUoeydiYW5uZXInOiBhZGRvbkJhbm5lcn0pCgogICAgICAgICAgICAgICAgaWYgJ2NsZWFybG9nbycgaW4gaSBhbmQgbm90IGlbJ2NsZWFybG9nbyddID09ICcwJzoKICAgICAgICAgICAgICAgICAgICBhcnQudXBkYXRlKHsnY2xlYXJsb2dvJzogaVsnY2xlYXJsb2dvJ119KQoKICAgICAgICAgICAgICAgIGlmICdjbGVhcmFydCcgaW4gaSBhbmQgbm90IGlbJ2NsZWFyYXJ0J10gPT0gJzAnOgogICAgICAgICAgICAgICAgICAgIGFydC51cGRhdGUoeydjbGVhcmFydCc6IGlbJ2NsZWFyYXJ0J119KQoKCiAgICAgICAgICAgICAgICBpZiBzZXR0aW5nRmFuYXJ0ID09ICd0cnVlJyBhbmQgJ2ZhbmFydDInIGluIGkgYW5kIG5vdCBpWydmYW5hcnQyJ10gPT0gJzAnOgogICAgICAgICAgICAgICAgICAgIGl0ZW0uc2V0UHJvcGVydHkoJ0ZhbmFydF9JbWFnZScsIGlbJ2ZhbmFydDInXSkKICAgICAgICAgICAgICAgIGVsaWYgc2V0dGluZ0ZhbmFydCA9PSAndHJ1ZScgYW5kICdmYW5hcnQnIGluIGkgYW5kIG5vdCBpWydmYW5hcnQnXSA9PSAnMCc6CiAgICAgICAgICAgICAgICAgICAgaXRlbS5zZXRQcm9wZXJ0eSgnRmFuYXJ0X0ltYWdlJywgaVsnZmFuYXJ0J10pCiAgICAgICAgICAgICAgICBlbGlmIG5vdCBhZGRvbkZhbmFydCA9PSBOb25lOgogICAgICAgICAgICAgICAgICAgIGl0ZW0uc2V0UHJvcGVydHkoJ0ZhbmFydF9JbWFnZScsIGFkZG9uRmFuYXJ0KQoKICAgICAgICAgICAgICAgIGl0ZW0uc2V0QXJ0KGFydCkKICAgICAgICAgICAgICAgIGl0ZW0uYWRkQ29udGV4dE1lbnVJdGVtcyhjbSkKICAgICAgICAgICAgICAgIGl0ZW0uc2V0UHJvcGVydHkoJ0lzUGxheWFibGUnLCBpc1BsYXlhYmxlKQogICAgICAgICAgICAgICAgaXRlbS5zZXRJbmZvKHR5cGU9J1ZpZGVvJywgaW5mb0xhYmVscyA9IG1ldGEpCgogICAgICAgICAgICAgICAgdmlkZW9fc3RyZWFtaW5mbyA9IHsnY29kZWMnOiAnaDI2NCd9CiAgICAgICAgICAgICAgICBpdGVtLmFkZFN0cmVhbUluZm8oJ3ZpZGVvJywgdmlkZW9fc3RyZWFtaW5mbykKCiAgICAgICAgICAgICAgICBjb250cm9sLmFkZEl0ZW0oaGFuZGxlPXN5c2hhbmRsZSwgdXJsPXVybCwgbGlzdGl0ZW09aXRlbSwgaXNGb2xkZXI9RmFsc2UpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKCiAgICAgICAgdHJ5OgogICAgICAgICAgICB1cmwgPSBpdGVtc1swXVsnbmV4dCddCiAgICAgICAgICAgIGlmIHVybCA9PSAnJzogcmFpc2UgRXhjZXB0aW9uKCkKCiAgICAgICAgICAgIGljb24gPSBjb250cm9sLmFkZG9uTmV4dCgpCiAgICAgICAgICAgIHVybCA9ICclcz9hY3Rpb249bW92aWVQYWdlJnVybD0lcycgJSAoc3lzYWRkb24sIHVybGxpYi5xdW90ZV9wbHVzKHVybCkpCgogICAgICAgICAgICBpdGVtID0gY29udHJvbC5pdGVtKGxhYmVsPW5leHRNZW51KQoKICAgICAgICAgICAgaXRlbS5zZXRBcnQoeydpY29uJzogaWNvbiwgJ3RodW1iJzogaWNvbiwgJ3Bvc3Rlcic6IGljb24sICdiYW5uZXInOiBpY29ufSkKICAgICAgICAgICAgaWYgbm90IGFkZG9uRmFuYXJ0ID09IE5vbmU6IGl0ZW0uc2V0UHJvcGVydHkoJ0ZhbmFydF9JbWFnZScsIGFkZG9uRmFuYXJ0KQoKICAgICAgICAgICAgY29udHJvbC5hZGRJdGVtKGhhbmRsZT1zeXNoYW5kbGUsIHVybD11cmwsIGxpc3RpdGVtPWl0ZW0sIGlzRm9sZGVyPVRydWUpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCgogICAgICAgIGNvbnRyb2wuY29udGVudChzeXNoYW5kbGUsICdtb3ZpZXMnKQogICAgICAgIGNvbnRyb2wuZGlyZWN0b3J5KHN5c2hhbmRsZSwgY2FjaGVUb0Rpc2M9VHJ1ZSkKICAgICAgICB2aWV3cy5zZXRWaWV3KCdtb3ZpZXMnLCB7J3NraW4uZXN0dWFyeSc6IDU1LCAnc2tpbi5jb25mbHVlbmNlJzogNTAwfSkKCgogICAgZGVmIGFkZERpcmVjdG9yeShzZWxmLCBpdGVtcywgcXVldWU9RmFsc2UpOgogICAgICAgIGlmIGl0ZW1zID09IE5vbmUgb3IgbGVuKGl0ZW1zKSA9PSAwOiBjb250cm9sLmlkbGUoKSA7IHN5cy5leGl0KCkKCiAgICAgICAgc3lzYWRkb24gPSBzeXMuYXJndlswXQoKICAgICAgICBzeXNoYW5kbGUgPSBpbnQoc3lzLmFyZ3ZbMV0pCgogICAgICAgIGFkZG9uRmFuYXJ0LCBhZGRvblRodW1iLCBhcnRQYXRoID0gY29udHJvbC5hZGRvbkZhbmFydCgpLCBjb250cm9sLmFkZG9uVGh1bWIoKSwgY29udHJvbC5hcnRQYXRoKCkKCiAgICAgICAgcXVldWVNZW51ID0gY29udHJvbC5sYW5nKDMyMDY1KS5lbmNvZGUoJ3V0Zi04JykKCiAgICAgICAgcGxheVJhbmRvbSA9IGNvbnRyb2wubGFuZygzMjUzNSkuZW5jb2RlKCd1dGYtOCcpCgogICAgICAgIGFkZFRvTGlicmFyeSA9IGNvbnRyb2wubGFuZygzMjU1MSkuZW5jb2RlKCd1dGYtOCcpCgogICAgICAgIGZvciBpIGluIGl0ZW1zOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBuYW1lID0gaVsnbmFtZSddCgogICAgICAgICAgICAgICAgaWYgaVsnaW1hZ2UnXS5zdGFydHN3aXRoKCdodHRwJyk6IHRodW1iID0gaVsnaW1hZ2UnXQogICAgICAgICAgICAgICAgZWxpZiBub3QgYXJ0UGF0aCA9PSBOb25lOiB0aHVtYiA9IG9zLnBhdGguam9pbihhcnRQYXRoLCBpWydpbWFnZSddKQogICAgICAgICAgICAgICAgZWxzZTogdGh1bWIgPSBhZGRvblRodW1iCgogICAgICAgICAgICAgICAgdXJsID0gJyVzP2FjdGlvbj0lcycgJSAoc3lzYWRkb24sIGlbJ2FjdGlvbiddKQogICAgICAgICAgICAgICAgdHJ5OiB1cmwgKz0gJyZ1cmw9JXMnICUgdXJsbGliLnF1b3RlX3BsdXMoaVsndXJsJ10pCiAgICAgICAgICAgICAgICBleGNlcHQ6IHBhc3MKCiAgICAgICAgICAgICAgICBjbSA9IFtdCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNtLmFwcGVuZCgoJ1NldHRpbmdzJywgJ1J1blBsdWdpbiglcz9hY3Rpb249b3BlblNldHRpbmdzJnF1ZXJ5PTAuMCknICUgc3lzYWRkb24pKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjbS5hcHBlbmQoKHBsYXlSYW5kb20sICdSdW5QbHVnaW4oJXM/YWN0aW9uPXJhbmRvbSZydHlwZT1tb3ZpZSZ1cmw9JXMpJyAlIChzeXNhZGRvbiwgdXJsbGliLnF1b3RlX3BsdXMoaVsndXJsJ10pKSkpCgogICAgICAgICAgICAgICAgaWYgcXVldWUgPT0gVHJ1ZToKICAgICAgICAgICAgICAgICAgICBjbS5hcHBlbmQoKHF1ZXVlTWVudSwgJ1J1blBsdWdpbiglcz9hY3Rpb249cXVldWVJdGVtKScgJSBzeXNhZGRvbikpCgogICAgICAgICAgICAgICAgdHJ5OiBjbS5hcHBlbmQoKGFkZFRvTGlicmFyeSwgJ1J1blBsdWdpbiglcz9hY3Rpb249bW92aWVzVG9MaWJyYXJ5JnVybD0lcyknICUgKHN5c2FkZG9uLCB1cmxsaWIucXVvdGVfcGx1cyhpWydjb250ZXh0J10pKSkpCiAgICAgICAgICAgICAgICBleGNlcHQ6IHBhc3MKCiAgICAgICAgICAgICAgICBpdGVtID0gY29udHJvbC5pdGVtKGxhYmVsPW5hbWUpCgogICAgICAgICAgICAgICAgaXRlbS5zZXRBcnQoeydpY29uJzogdGh1bWIsICd0aHVtYic6IHRodW1ifSkKICAgICAgICAgICAgICAgIGlmIG5vdCBhZGRvbkZhbmFydCA9PSBOb25lOiBpdGVtLnNldFByb3BlcnR5KCdGYW5hcnRfSW1hZ2UnLCBhZGRvbkZhbmFydCkKCiAgICAgICAgICAgICAgICBpdGVtLmFkZENvbnRleHRNZW51SXRlbXMoY20pCgogICAgICAgICAgICAgICAgY29udHJvbC5hZGRJdGVtKGhhbmRsZT1zeXNoYW5kbGUsIHVybD11cmwsIGxpc3RpdGVtPWl0ZW0sIGlzRm9sZGVyPVRydWUpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKCiAgICAgICAgY29udHJvbC5jb250ZW50KHN5c2hhbmRsZSwgJ2FkZG9ucycpCiAgICAgICAgY29udHJvbC5kaXJlY3Rvcnkoc3lzaGFuZGxlLCBjYWNoZVRvRGlzYz1UcnVlKQ==')